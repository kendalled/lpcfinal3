let isAdded = false;

// Your web app's Firebase configuration
var firebaseConfig = {
    apiKey: "AIzaSyCbcK2d6g1p88qSuKP8NX_IalzEIYUcJ1k",
    authDomain: "lapelpinsandcoins-5f3f1.firebaseapp.com",
    databaseURL: "https://lapelpinsandcoins-5f3f1.firebaseio.com",
    projectId: "lapelpinsandcoins-5f3f1",
    storageBucket: "lapelpinsandcoins-5f3f1.appspot.com",
    messagingSenderId: "796050314078",
    appId: "1:796050314078:web:c5c37ba5e858c8ed"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);
// Required for side-effects

$(function () {
    $('#LapelPin').click(function () {
        document.getElementById('pinformdiv').style.display = "block";
        document.getElementById('coinformdiv').style.display = "none";
        document.getElementById('chainformdiv').style.display = "none";
        document.getElementById('choice').style.display = "none";
        document.getElementById('rstbtn').style.display = "block";

    });
    $('#ChallengeCoin').click(function () {
        document.getElementById('pinformdiv').style.display = "none";
        document.getElementById('coinformdiv').style.display = "block";
        document.getElementById('chainformdiv').style.display = "none";
        document.getElementById('choice').style.display = "none";
        document.getElementById('rstbtn').style.display = "block";
    });
    $('#Keychain').click(function () {
        document.getElementById('pinformdiv').style.display = "none";
        document.getElementById('coinformdiv').style.display = "none";
        document.getElementById('chainformdiv').style.display = "block";
        document.getElementById('choice').style.display = "none";
        document.getElementById('rstbtn').style.display = "block";
    });
    // Reset Button
    $('#rstbtn').click(function () {
        document.getElementById('pinformdiv').style.display = "none";
        document.getElementById('coinformdiv').style.display = "none";
        document.getElementById('chainformdiv').style.display = "none";
        document.getElementById('choice').style.display = "block";
        document.getElementById('rstbtn').style.display = "none";
        $('#choicetext').hide();
        document.getElementById('firebaseui-auth-container').style.display = "none";
    });

    $('#discount20').click(function () {
        document.getElementById('coupon').value = "LPC20";
        $('html, body').animate({
            scrollTop: $("#Pin-message").offset().top
        }, 1000);
    });
    $('#discount5').click(function () {
        document.getElementById('coupon').value = "FIRSTORDER";
        $('html, body').animate({
            scrollTop: $("#Pin-message").offset().top
        }, 1000);
    });
    $('#discount10').click(function () {
        document.getElementById('coupon').value = "REORDER";
        $('html, body').animate({
            scrollTop: $("#Pin-message").offset().top
        }, 1000);
    });
    $('#sameday').click(function () {
        document.getElementById('coupon').value = "SAMEDAY";
        $('html, body').animate({
            scrollTop: $("#Pin-message").offset().top
        }, 1000);
    });
    // Start Challenge Coin Triggers
    $('#noColor, #oneColor, #bothColor').click(function () {
        document.getElementById('coinSizing').style.display = "block";

        if(!isAdded) {
            var head = document.getElementsByTagName('head')[0];
            var js = document.createElement("script");
            var css = document.createElement("link");
            // Conditionally adding script to head
            css.rel = "stylesheet";
            css.href = "assets/css/lightbox.css";
            js.src = "assets/js/lightbox.js";
            head.appendChild(css);
            head.appendChild(js);
            isAdded = true;
        } 
        
        
        $('html, body').animate({
            scrollTop: $("#colorChoice").offset().top
        }, 500);
    });


    // End color choice Triggers
    $('#size175, #size200, #size225, #size250, #size275, #size300').click(function () {
        document.getElementById('coinPlating').style.display = "block";
        $('html, body').animate({
            scrollTop: $("#coinSizing").offset().top
        }, 500);

    });

    // end of size choice triggers
    $('#polishedGold, #antiqueGold, #polishedSilver, #antiqueSilver, #polishedCopper, #antiqueCopper, #polishedBlack, #dual, #polishedNickel, #colorCoated').click(function () {
        document.getElementById('bezelChoice').style.display = "block";
        $('html, body').animate({
            scrollTop: $("#coinPlating").offset().top
        }, 500);
    });

    // Edge triggers
    $('#plain, #rope, #spur, #oblique, #crosscut, #bezeled').click(function () {
        document.getElementById('packaging').style.display = "block";
        $('html, body').animate({
            scrollTop: $("#bezelChoice").offset().top
        }, 500);

    });

    // End Challenge Coin Triggers

    // Start Lapel Pin Triggers
    $('#struck, #softenamel, #silk, #offset, #cloisonne').click(function () {
        document.getElementById('pinSizing').style.display = "block";
        $('html, body').animate({
            scrollTop: $("#styleChoice").offset().top
        }, 500);
    });

    // pin sizing
    $('#size075p, #size100p, #size125p, #size150p, #size175p, #size200p, #size225p, #size250p').click(function () {
        document.getElementById('pinPlating').style.display = "block";
        $('html, body').animate({
            scrollTop: $("#pinSizing").offset().top
        }, 500);
    });


    $('#polishedGoldp, #antiqueGoldp, #polishedSilverp, #antiqueSilverp, #polishedCopperp, #antiqueCopperp, #polishedBlackp, #dualp, #polishedNickelp, #colorCoatedp').click(function () {
        document.getElementById('pinBacking').style.display = "block";
        $('html, body').animate({
            scrollTop: $("#pinPlating").offset().top
        }, 500);
    });

    $('#butterfly, #deluxe, #jewelry, #cufflink, #blackrubber, #yellowrubber').click(function () {
        document.getElementById('pinPackaging').style.display = "block";
        $('html, body').animate({
            scrollTop: $("#pinBacking").offset().top
        }, 500);
    });

    // Start Keychain Triggers

    $('#offsetKeychain, #dieKeychain, #enamelKeychain').click(function () {
        document.getElementById('chainSizing').style.display = "block";
        $('html, body').animate({
            scrollTop: $("#chainStyle").offset().top
        }, 500);
    });

    $('#size175kc, #size075kc, #size200kc, #size225kc, #size250kc').click(function () {
        document.getElementById('chainPlating').style.display = "block";
        $('html, body').animate({
            scrollTop: $("#chainSizing").offset().top
        }, 500);
    });

    $('#polishedGoldkc, #antiqueGoldkc, #polishedSilverkc, #antiqueSilverkc, #polishedCopperkc, #antiqueCopperkc, #polishedBlackkc, #dualkc, #polishedNickelkc, #colorCoatedkc').click(function () {
        document.getElementById('chainPackaging').style.display = "block";
        $('html, body').animate({
            scrollTop: $("#chainPlating").offset().top
        }, 500);
    });








});

const storageRef = firebase.storage().ref();

// FirebaseUI config.
var uiConfig = {
    callbacks: {
        signInSuccessWithAuthResult: function (authResult, redirectUrl) {
            // User successfully signed in.
            // Return type determines whether we continue the redirect automatically
            // or whether we leave that to developer to handle.
            return false;
        },
        uiShown: function () {
            // The widget is rendered.
            // Hide the loader.
            // document.getElementById('loader').style.display = 'none';
        }
    },
    // Will use popup for IDP Providers sign-in flow instead of the default, redirect.
    signInFlow: 'popup',
    signInSuccessUrl: 'https://lapelpinsandcoins.com/quote',
    signInOptions: [
        // Leave the lines as is for the providers you want to offer your users.
        {
            provider: firebase.auth.GoogleAuthProvider.PROVIDER_ID
        },
        {
            provider: firebase.auth.FacebookAuthProvider.PROVIDER_ID
        },
        {
            provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,
            requireDisplayName: false,
            signInMethod: firebase.auth.EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD,
            // signInMethod: firebase.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD,
            forceSameDevice: false
        },
        {
            provider: firebase.auth.PhoneAuthProvider.PROVIDER_ID

        }


    ],
    // Terms of service url.
    tosUrl: 'https://lapelpinsandcoins.com/tos',
    // Privacy policy url.
    privacyPolicyUrl: 'https://lapelpinsandcoins.com/privacy'
};

// Initialize the FirebaseUI Widget using Firebase.
var ui = new firebaseui.auth.AuthUI(firebase.auth());
// The start method will wait until the DOM is loaded.
ui.start('#firebaseui-auth-container', uiConfig);

document.getElementById('filepond1').addEventListener('change', handleFileUploadChange);
document.getElementById('filepond1').addEventListener('change', handleFileUploadSubmit);
document.getElementById('filepond2').addEventListener('change', handleFileUploadChange);
document.getElementById('filepond2').addEventListener('change', handleFileUploadSubmit2);
document.getElementById('filepond3').addEventListener('change', handleFileUploadChange);
document.getElementById('filepond3').addEventListener('change', handleFileUploadSubmit3);
document.getElementById('filepond4').addEventListener('change', handleFileUploadChange);
document.getElementById('filepond4').addEventListener('change', handleFileUploadSubmit4);
document.getElementById('filepond5').addEventListener('change', handleFileUploadChange);
document.getElementById('filepond5').addEventListener('change', handleFileUploadSubmit5);
var username = "User";
let selectedFile;
function handleFileUploadChange(e) {
    selectedFile = e.target.files[0];
}

function handleFileUploadSubmit(e) {
    const uploadTask = storageRef.child(`Quotes/Lapel Pins/${username}/${selectedFile.name}`).put(selectedFile); //create a child directory called images, and place the file inside this directory
    uploadTask.on('state_changed', (snapshot) => {
        // Observe state change events such as progress, pause, and resume
    }, (error) => {
        // Handle unsuccessful uploads
        alert("We only accept image uploads (png, jpeg, etc.) due to security reasons. Thank you for understanding.");
    }, () => {
        // Do something once upload is complete
        console.log('File successfully uploaded (pin)');
            uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {
                    document.getElementById('hiddenlink').value = downloadURL.toString();

                    
                    
            });
    });
}
function handleFileUploadSubmit2(e) {
    const uploadTask = storageRef.child(`Quotes/Challenge Coins/${username}/FRONT-${selectedFile.name}`).put(selectedFile); //create a child directory called images, and place the file inside this directory
    uploadTask.on('state_changed', (snapshot) => {
        // Observe state change events such as progress, pause, and resume
    }, (error) => {
        // Handle unsuccessful uploads
        alert("We only accept image uploads (png, jpeg, etc.) due to security reasons. Thank you for understanding.");
    }, () => {
        // Do something once upload is complete
        console.log('File successfully uploaded (coin front)');
        uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {
            

            document.getElementById('hiddenlink2').value = downloadURL.toString();

        });
    });
}
function handleFileUploadSubmit3(e) {
    const uploadTask = storageRef.child(`Quotes/Challenge Coins/${username}/BACK-${selectedFile.name}`).put(selectedFile); //create a child directory called images, and place the file inside this directory
    uploadTask.on('state_changed', (snapshot) => {
        // Observe state change events such as progress, pause, and resume
    }, (error) => {
        // Handle unsuccessful uploads
        alert("We only accept image uploads (png, jpeg, etc.) due to security reasons. Thank you for understanding.");
    }, () => {
        // Do something once upload is complete
        console.log('File successfully uploaded (coin back)');
        uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {
            

            document.getElementById('hiddenlink3').value = downloadURL.toString();

        });
    });
}
function handleFileUploadSubmit4(e) {
    const uploadTask = storageRef.child(`Quotes/Keychains/${username}/FRONT-${selectedFile.name}`).put(selectedFile); //create a child directory called images, and place the file inside this directory
    uploadTask.on('state_changed', (snapshot) => {
        // Observe state change events such as progress, pause, and resume
    }, (error) => {
        // Handle unsuccessful uploads
        alert("We only accept image uploads (png, jpeg, etc.) due to security reasons. Thank you for understanding.");
    }, () => {
        // Do something once upload is complete
        console.log('File successfully uploaded (keychain front)');
        uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {


            document.getElementById('hiddenlink4').value = downloadURL.toString();

        });
    });
}
function handleFileUploadSubmit5(e) {
    const uploadTask = storageRef.child(`Quotes/Keychains/${username}/BACK-${selectedFile.name}`).put(selectedFile); //create a child directory called images, and place the file inside this directory
    uploadTask.on('state_changed', (snapshot) => {
        // Observe state change events such as progress, pause, and resume
    }, (error) => {
        // Handle unsuccessful uploads
        alert("We only accept image uploads (png, jpeg, etc.) due to security reasons. Thank you for understanding.");
    }, () => {
        // Do something once upload is complete
        console.log('File successfully uploaded (keychain back)');
        uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {


            document.getElementById('hiddenlink5').value = downloadURL.toString();

        });
    });
}

// function googleLogin() {
//     var provider = new firebase.auth.GoogleAuthProvider();

//     firebase.auth().signInWithPopup(provider)

//         .then(result => {
//             const user = result.user;
            
//             document.getElementById('loginmethod').style.display = "none";
            
//             console.log('Successful google login.')
//         })
//         .catch(console.log)
// }

//Interactive elements
$(document).ready(function () {

    var content = $('.contenty');
    var currentItem = content.filter('.activey');
    var steps = $('.card').filter('.steps');
    var inactive1 = $('.inactive-1');
    var inactive2 = $('.inactive-2');

    $('.advance').click(function () {
        var nextItem = currentItem.next();
        var lastItem = content.last();
        var contentFirst = content.first();

        currentItem.removeClass('activey');

        if (currentItem.is(lastItem)) {
            currentItem = contentFirst.addClass('activey');
            currentItem.css({ 'right': '10%', 'opacity': '1' });
            $('.step').animate({ width: '33%' });
            inactive1.animate({ height: '8px', marginLeft: '20px', marginRight: '20px' }, 100);
            inactive2.animate({ height: '8px', marginLeft: '10px', marginRight: '10px' }, 100);

        } else if (currentItem.is(contentFirst)) {
            currentItem.animate({ opacity: 0 }, 1000);
            currentItem = nextItem.addClass('activey');
            $('.step').animate({ width: '66%' });
            inactive2.animate({ height: '0', marginLeft: '0px', marginRight: '0px' }, 100);

        } else {
            currentItem = nextItem.addClass('activey');
            $('.step').animate({ width: '100%' });
            inactive1.animate({ height: '0', marginLeft: '0px', marginRight: '0px' }, 100);
        }
    });

});
$(function () {
    var items = (Math.floor(Math.random() * ($('#testimonials li').length)));
    $('#testimonials li').hide().eq(items).show();

    function next() {
        $('#testimonials li:visible').delay(5000).fadeOut('slow', function () {
            $(this).appendTo('#testimonials ul');
            $('#testimonials li:first').fadeIn('slow', next);
        });
    }
    next();
});



function checkRadios(){
    if (document.getElementById('size225').checked) {
        $('#velvetbagcost').text('Velvet Bag: $0.80')
        $('#velvetcasecost').text('Velvet Case: $4.25')
        $('#acryliccasecost').text('Acrylic Case: $1.25')
    }
    else if (document.getElementById('size250').checked) {
        $('#velvetbagcost').text('Velvet Bag: $1.05')
        $('#velvetcasecost').text('Velvet Case: $4.50')
        $('#acryliccasecost').text('Acrylic Case: $1.50')

    }
    else if (document.getElementById('size275').checked) {
        $('#velvetbagcost').text('Velvet Bag: $1.30')
        $('#velvetcasecost').text('Velvet Case: $4.75')
        $('#acryliccasecost').text('Acrylic Case: $1.75')
    }
    else if (document.getElementById('size300').checked) {
        $('#velvetbagcost').text('Velvet Bag: $1.55')
        $('#velvetcasecost').text('Velvet Case: $5.00')
        $('#acryliccasecost').text('Acrylic Case: $2.00')
    }
    else {
        $('#velvetbagcost').text('Velvet Bag: $0.55')
        $('#velvetcasecost').text('Velvet Case: $4.00')
        $('#acryliccasecost').text('Acrylic Case: $1.00')
    }
    
}

function checkRadiosp() {
    if (document.getElementById('size200p').checked) {
        $('#velvetbagcostp').text('Velvet Bag: $0.80')
        $('#velvetcasecostp').text('Velvet Case: $4.25')
        $('#acryliccasecostp').text('Acrylic Case: $1.25')
    }
    else if (document.getElementById('size225p').checked) {
        $('#velvetbagcostp').text('Velvet Bag: $1.05')
        $('#velvetcasecostp').text('Velvet Case: $4.50')
        $('#acryliccasecostp').text('Acrylic Case: $1.50')
    } else if (document.getElementById('size250p').checked) {
        $('#velvetbagcostp').text('Velvet Bag: $1.30')
        $('#velvetcasecostp').text('Velvet Case: $4.75')
        $('#acryliccasecostp').text('Acrylic Case: $1.75')
    }
    else {
        $('#velvetbagcostp').text('Velvet Bag: $0.55')
        $('#velvetcasecostp').text('Velvet Case: $4.00')
        $('#acryliccasecostp').text('Acrylic Case: $1.00')
    }

}

function anonLogin() {
    firebase.auth().signInAnonymously().catch(function (error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // ...
    });
    console.log("Successful anon login.")
    
   
   
}
var isAnon = false;
firebase.auth().onAuthStateChanged(function (user) {
    if (user) {
        // User is signed in.
            isAnon = user.isAnonymous;
            
            var uid = user.uid;
            document.getElementById('firebaseui-auth-container').style.display = "none";
            $('#choicetext').hide();
            $('.pinContact').show();
            $('.coinContact').show();
            $('.chainContact').show();
        
            document.getElementById('hiddenForm1').style.display = "block";
            document.getElementById('hiddenForm2').style.display = "block";
            document.getElementById('hiddenForm3').style.display = "block";
            document.getElementById('pinsubmit').style.display = "block";
            if (isAnon) {
                $('#pinForm').submit(function () {
                    upgradeUser(1);
                    return true; // return false to cancel form action
                });

                $('#coinForm').submit(function () {
                    upgradeUser(2);
                    return true; // return false to cancel form action
                });

                $('#chainForm').submit(function () {
                    upgradeUser(3);
                    return true; // return false to cancel form action
                });
            } else {
                document.getElementById('Pin-FullName').value = user.displayName.toString();
                document.getElementById('Pin-email').value = user.email.toString();
                document.getElementById('Coin-FullName').value = user.displayName.toString();
                document.getElementById('Coin-email').value = user.email.toString();
                document.getElementById('Chain-FullName').value = user.displayName.toString();
                document.getElementById('Chain-email').value = user.email.toString();
                username = user.displayName.toString();
            }
            
        
            
            
        
        
        
        console.log('User ' + uid + ' is logged in.' )
        
        // ...
    } else {
       
        loginscreen();
        console.log('User is not logged in.');
        // ...
    }
    // ...
});

function loginscreen () {
    

    $('#LapelPin').click(function () {
       
        document.getElementById('firebaseui-auth-container').style.display = "block";
        $('#choicetext').show();

    });
    $('#ChallengeCoin').click(function () {
        
        document.getElementById('firebaseui-auth-container').style.display = "block";
        $('#choicetext').show();

    });
    $('#Keychain').click(function () {

        document.getElementById('firebaseui-auth-container').style.display = "block";
        $('#choicetext').show();

    });
   
    
    

}

function upgradeUser(item){
    var user = firebase.auth().currentUser;

    switch (item) {
        case 1:
            user.updateProfile({
                displayName: document.getElementById('Pin-FullName').value
            }).then(function () {
                username = user.displayName;
                console.log("Display Name Updated")
            }).catch(function (error) {
                // An error happened.
            });
            user.updateEmail(document.getElementById('Pin-email').value).then(function () {
                console.log('Email updated successfully.')
            }).catch(function (error) {
                console.log(error);
            });
            break;
        case 2:
            user.updateProfile({
                displayName: document.getElementById('Coin-FullName').value
            }).then(function () {
                username = user.displayName;
                console.log("Display Name Updated")
            }).catch(function (error) {
                // An error happened.
            });
            user.updateEmail(document.getElementById('Coin-email').value).then(function () {
                console.log('Email updated successfully.')
            }).catch(function (error) {
                console.log(error);
            });
            break;
        case 3:
            user.updateProfile({
                displayName: document.getElementById('Chain-FullName').value
            }).then(function () {
                username = user.displayName;
                console.log("Display Name Updated")
            }).catch(function (error) {
                // An error happened.
            });
            user.updateEmail(document.getElementById('Chain-email').value).then(function () {
                console.log('Email updated successfully.')
            }).catch(function (error) {
                console.log(error);
            });
            break;
        default:
            console.log("ya messed up ken");
            break;
    }
    

    
    // document.getElementById('hiddenForm1').style.display = "block";
    

}

