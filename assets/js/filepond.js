(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?factory(exports):typeof define==='function'&&define.amd?define(['exports'],factory):((global=global||self),factory((global.FilePond={})))})(this,function(exports){'use strict';var isNode=function isNode(value){return value instanceof HTMLElement};var createStore=function createStore(initialState){var queries=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var actions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var state=Object.assign({},initialState);var actionQueue=[];var dispatchQueue=[];var getState=function getState(){return Object.assign({},state)};var processActionQueue=function processActionQueue(){var queue=[].concat(actionQueue);actionQueue.length=0;return queue};var processDispatchQueue=function processDispatchQueue(){var queue=[].concat(dispatchQueue);dispatchQueue.length=0;queue.forEach(function(_ref){var type=_ref.type,data=_ref.data;dispatch(type,data)})};var dispatch=function dispatch(type,data,isBlocking){if(isBlocking){dispatchQueue.push({type:type,data:data});return}
if(actionHandlers[type]){actionHandlers[type](data)}
actionQueue.push({type:type,data:data})};var query=function query(str){var _queryHandles;for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}
return queryHandles[str]?(_queryHandles=queryHandles)[str].apply(_queryHandles,args):null};var api={getState:getState,processActionQueue:processActionQueue,processDispatchQueue:processDispatchQueue,dispatch:dispatch,query:query};var queryHandles={};queries.forEach(function(query){queryHandles=Object.assign({},query(state),queryHandles)});var actionHandlers={};actions.forEach(function(action){actionHandlers=Object.assign({},action(dispatch,query,state),actionHandlers)});return api};var defineProperty=function defineProperty(obj,property,definition){if(typeof definition==='function'){obj[property]=definition;return}
Object.defineProperty(obj,property,Object.assign({},definition))};var forin=function forin(obj,cb){for(var key in obj){if(!obj.hasOwnProperty(key)){continue}
cb(key,obj[key])}};var createObject=function createObject(definition){var obj={};forin(definition,function(property){defineProperty(obj,property,definition[property])});return obj};var attr=function attr(node,name){var value=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(value===null){return node.getAttribute(name)||node.hasAttribute(name)}
node.setAttribute(name,value)};var ns='http://www.w3.org/2000/svg';var svgElements=['svg','path'];var isSVGElement=function isSVGElement(tag){return svgElements.includes(tag)};var createElement=function createElement(tag,className){var attributes=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(typeof className==='object'){attributes=className;className=null}
var element=isSVGElement(tag)?document.createElementNS(ns,tag):document.createElement(tag);if(className){if(isSVGElement(tag)){attr(element,'class',className)}else{element.className=className}}
forin(attributes,function(name,value){attr(element,name,value)});return element};var appendChild=function appendChild(parent){return function(child,index){if(typeof index!=='undefined'&&parent.children[index]){parent.insertBefore(child,parent.children[index])}else{parent.appendChild(child)}}};var appendChildView=function appendChildView(parent,childViews){return function(view,index){if(typeof index!=='undefined'){childViews.splice(index,0,view)}else{childViews.push(view)}
return view}};var removeChildView=function removeChildView(parent,childViews){return function(view){childViews.splice(childViews.indexOf(view),1);if(view.element.parentNode){parent.removeChild(view.element)}
return view}};var getViewRect=function getViewRect(elementRect,childViews,offset,scale){var left=offset[0]||elementRect.left;var top=offset[1]||elementRect.top;var right=left+elementRect.width;var bottom=top+elementRect.height*(scale[1]||1);var rect={element:Object.assign({},elementRect),inner:{left:elementRect.left,top:elementRect.top,right:elementRect.right,bottom:elementRect.bottom},outer:{left:left,top:top,right:right,bottom:bottom}};childViews.filter(function(childView){return!childView.isRectIgnored()}).map(function(childView){return childView.rect}).forEach(function(childViewRect){expandRect(rect.inner,Object.assign({},childViewRect.inner));expandRect(rect.outer,Object.assign({},childViewRect.outer))});calculateRectSize(rect.inner);rect.outer.bottom+=rect.element.marginBottom;rect.outer.right+=rect.element.marginRight;calculateRectSize(rect.outer);return rect};var expandRect=function expandRect(parent,child){child.top+=parent.top;child.right+=parent.left;child.bottom+=parent.top;child.left+=parent.left;if(child.bottom>parent.bottom){parent.bottom=child.bottom}
if(child.right>parent.right){parent.right=child.right}};var calculateRectSize=function calculateRectSize(rect){rect.width=rect.right-rect.left;rect.height=rect.bottom-rect.top};var isNumber=function isNumber(value){return typeof value==='number'};var thereYet=function thereYet(position,destination,velocity){var errorMargin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0.001;return(Math.abs(position-destination)<errorMargin&&Math.abs(velocity)<errorMargin)};var spring=function spring()
{var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$stiffness=_ref.stiffness,stiffness=_ref$stiffness===void 0?0.5:_ref$stiffness,_ref$damping=_ref.damping,damping=_ref$damping===void 0?0.75:_ref$damping,_ref$mass=_ref.mass,mass=_ref$mass===void 0?10:_ref$mass;var target=null;var position=null;var velocity=0;var resting=!1;var interpolate=function interpolate(){if(resting){return}
if(!(isNumber(target)&&isNumber(position))){resting=!0;velocity=0;return}
var f=-(position-target)*stiffness;velocity+=f/mass;position+=velocity;velocity*=damping;if(thereYet(position,target,velocity)){position=target;velocity=0;resting=!0;api.onupdate(position);api.oncomplete(position)}else{api.onupdate(position)}};var setTarget=function setTarget(value){if(isNumber(value)&&!isNumber(position)){position=value}
if(target===null){target=value;position=value}
target=value;if(position===target||typeof target==='undefined'){resting=!0;velocity=0;api.onupdate(position);api.oncomplete(position);return}
resting=!1};var api=createObject({interpolate:interpolate,target:{set:setTarget,get:function get(){return target}},resting:{get:function get(){return resting}},onupdate:function onupdate(value){},oncomplete:function oncomplete(value){}});return api};var easeLinear=function easeLinear(t){return t};var easeInOutQuad=function easeInOutQuad(t){return t<0.5?2*t*t:-1+(4-2*t)*t};var tween=function tween()
{var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$duration=_ref.duration,duration=_ref$duration===void 0?500:_ref$duration,_ref$easing=_ref.easing,easing=_ref$easing===void 0?easeInOutQuad:_ref$easing,_ref$delay=_ref.delay,delay=_ref$delay===void 0?0:_ref$delay;var start=null;var t;var p;var resting=!0;var reverse=!1;var target=null;var interpolate=function interpolate(ts){if(resting||target===null){return}
if(start===null){start=ts}
if(ts-start<delay){return}
t=ts-start-delay;if(t<duration){p=t/duration;api.onupdate((t>=0?easing(reverse?1-p:p):0)*target)}else{t=1;p=reverse?0:1;api.onupdate(p*target);api.oncomplete(p*target);resting=!0}};var api=createObject({interpolate:interpolate,target:{get:function get(){return reverse?0:target},set:function set(value){if(target===null){target=value;api.onupdate(value);api.oncomplete(value);return}
if(value<target){target=1;reverse=!0}else{reverse=!1;target=value}
resting=!1;start=null}},resting:{get:function get(){return resting}},onupdate:function onupdate(value){},oncomplete:function oncomplete(value){}});return api};var animator={spring:spring,tween:tween};var createAnimator=function createAnimator(definition,category,property){var def=definition[category]&&typeof definition[category][property]==='object'?definition[category][property]:definition[category]||definition;var type=typeof def==='string'?def:def.type;var props=typeof def==='object'?Object.assign({},def):{};return animator[type]?animator[type](props):null};var addGetSet=function addGetSet(keys,obj,props){var overwrite=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;obj=Array.isArray(obj)?obj:[obj];obj.forEach(function(o){keys.forEach(function(key){var name=key;var getter=function getter(){return props[key]};var setter=function setter(value){return(props[key]=value)};if(typeof key==='object'){name=key.key;getter=key.getter||getter;setter=key.setter||setter}
if(o[name]&&!overwrite){return}
o[name]={get:getter,set:setter}})})};var isDefined=function isDefined(value){return value!=null};var animations=function animations(_ref){var mixinConfig=_ref.mixinConfig,viewProps=_ref.viewProps,viewInternalAPI=_ref.viewInternalAPI,viewExternalAPI=_ref.viewExternalAPI,viewState=_ref.viewState;var initialProps=Object.assign({},viewProps);var animations=[];forin(mixinConfig,function(property,animation){var animator=createAnimator(animation);if(!animator){return}
animator.onupdate=function(value){viewProps[property]=value};animator.target=initialProps[property];var prop={key:property,setter:function setter(value){if(animator.target===value){return}
animator.target=value},getter:function getter(){return viewProps[property]}};addGetSet([prop],[viewInternalAPI,viewExternalAPI],viewProps,!0);animations.push(animator)});return{write:function write(ts){var resting=!0;animations.forEach(function(animation){if(!animation.resting){resting=!1}
animation.interpolate(ts)});return resting},destroy:function destroy(){}}};var addEvent=function addEvent(element){return function(type,fn){element.addEventListener(type,fn)}};var removeEvent=function removeEvent(element){return function(type,fn){element.removeEventListener(type,fn)}};var listeners=function listeners(_ref){var mixinConfig=_ref.mixinConfig,viewProps=_ref.viewProps,viewInternalAPI=_ref.viewInternalAPI,viewExternalAPI=_ref.viewExternalAPI,viewState=_ref.viewState,view=_ref.view;var events=[];var add=addEvent(view.element);var remove=removeEvent(view.element);viewExternalAPI.on=function(type,fn){events.push({type:type,fn:fn});add(type,fn)};viewExternalAPI.off=function(type,fn){events.splice(events.findIndex(function(event){return event.type===type&&event.fn===fn}),1);remove(type,fn)};return{write:function write(){return!0},destroy:function destroy(){events.forEach(function(event){remove(event.type,event.fn)})}}};var apis=function apis(_ref){var mixinConfig=_ref.mixinConfig,viewProps=_ref.viewProps,viewExternalAPI=_ref.viewExternalAPI;addGetSet(mixinConfig,viewExternalAPI,viewProps)};var defaults={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0};var styles=function styles(_ref){var mixinConfig=_ref.mixinConfig,viewProps=_ref.viewProps,viewInternalAPI=_ref.viewInternalAPI,viewExternalAPI=_ref.viewExternalAPI,view=_ref.view;var initialProps=Object.assign({},viewProps);var currentProps={};addGetSet(mixinConfig,[viewInternalAPI,viewExternalAPI],viewProps);var getOffset=function getOffset(){return[viewProps.translateX||0,viewProps.translateY||0]};var getScale=function getScale(){return[viewProps.scaleX||0,viewProps.scaleY||0]};var getRect=function getRect(){return view.rect?getViewRect(view.rect,view.childViews,getOffset(),getScale()):null};viewInternalAPI.rect={get:getRect};viewExternalAPI.rect={get:getRect};mixinConfig.forEach(function(key){viewProps[key]=typeof initialProps[key]==='undefined'?defaults[key]:initialProps[key]});return{write:function write(){if(!propsHaveChanged(currentProps,viewProps)){return}
applyStyles(view.element,viewProps);Object.assign(currentProps,Object.assign({},viewProps));return!0},destroy:function destroy(){}}};var propsHaveChanged=function propsHaveChanged(currentProps,newProps){if(Object.keys(currentProps).length!==Object.keys(newProps).length){return!0}
for(var prop in newProps){if(newProps[prop]!==currentProps[prop]){return!0}}
return!1};var applyStyles=function applyStyles(element,_ref2){var opacity=_ref2.opacity,perspective=_ref2.perspective,translateX=_ref2.translateX,translateY=_ref2.translateY,scaleX=_ref2.scaleX,scaleY=_ref2.scaleY,rotateX=_ref2.rotateX,rotateY=_ref2.rotateY,rotateZ=_ref2.rotateZ,originX=_ref2.originX,originY=_ref2.originY,width=_ref2.width,height=_ref2.height;var transforms='';var styles='';if(isDefined(originX)||isDefined(originY)){styles+='transform-origin: '+(originX||0)+'px '+(originY||0)+'px;'}
if(isDefined(perspective)){transforms+='perspective('+perspective+'px) '}
if(isDefined(translateX)||isDefined(translateY)){transforms+='translate3d('+(translateX||0)+'px, '+(translateY||0)+'px, 0) '}
if(isDefined(scaleX)||isDefined(scaleY)){transforms+='scale3d('+(isDefined(scaleX)?scaleX:1)+', '+(isDefined(scaleY)?scaleY:1)+', 1) '}
if(isDefined(rotateZ)){transforms+='rotateZ('+rotateZ+'rad) '}
if(isDefined(rotateX)){transforms+='rotateX('+rotateX+'rad) '}
if(isDefined(rotateY)){transforms+='rotateY('+rotateY+'rad) '}
if(transforms.length){styles+='transform:'+transforms+';'}
if(isDefined(opacity)){styles+='opacity:'+opacity+';';if(opacity===0){styles+='visibility:hidden;'}
if(opacity<1){styles+='pointer-events:none;'}}
if(isDefined(height)){styles+='height:'+height+'px;'}
if(isDefined(width)){styles+='width:'+width+'px;'}
var elementCurrentStyle=element.elementCurrentStyle||'';if(styles.length!==elementCurrentStyle.length||styles!==elementCurrentStyle){element.setAttribute('style',styles);element.elementCurrentStyle=styles}};var Mixins={styles:styles,listeners:listeners,animations:animations,apis:apis};var updateRect=function updateRect(){var rect=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var element=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var style=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!element.layoutCalculated){rect.paddingTop=parseInt(style.paddingTop,10)||0;rect.marginTop=parseInt(style.marginTop,10)||0;rect.marginRight=parseInt(style.marginRight,10)||0;rect.marginBottom=parseInt(style.marginBottom,10)||0;rect.marginLeft=parseInt(style.marginLeft,10)||0;element.layoutCalculated=!0}
rect.left=element.offsetLeft||0;rect.top=element.offsetTop||0;rect.width=element.offsetWidth||0;rect.height=element.offsetHeight||0;rect.right=rect.left+rect.width;rect.bottom=rect.top+rect.height;rect.scrollTop=element.scrollTop;rect.hidden=element.offsetParent===null;return rect};var createView=function createView(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$tag=_ref.tag,tag=_ref$tag===void 0?'div':_ref$tag,_ref$name=_ref.name,name=_ref$name===void 0?null:_ref$name,_ref$attributes=_ref.attributes,attributes=_ref$attributes===void 0?{}:_ref$attributes,_ref$read=_ref.read,read=_ref$read===void 0?function(){}:_ref$read,_ref$write=_ref.write,write=_ref$write===void 0?function(){}:_ref$write,_ref$create=_ref.create,create=_ref$create===void 0?function(){}:_ref$create,_ref$destroy=_ref.destroy,destroy=_ref$destroy===void 0?function(){}:_ref$destroy,_ref$filterFrameActio=_ref.filterFrameActionsForChild,filterFrameActionsForChild=_ref$filterFrameActio===void 0?function(child,actions){return actions}:_ref$filterFrameActio,_ref$didCreateView=_ref.didCreateView,didCreateView=_ref$didCreateView===void 0?function(){}:_ref$didCreateView,_ref$didWriteView=_ref.didWriteView,didWriteView=_ref$didWriteView===void 0?function(){}:_ref$didWriteView,_ref$ignoreRect=_ref.ignoreRect,ignoreRect=_ref$ignoreRect===void 0?!1:_ref$ignoreRect,_ref$ignoreRectUpdate=_ref.ignoreRectUpdate,ignoreRectUpdate=_ref$ignoreRectUpdate===void 0?!1:_ref$ignoreRectUpdate,_ref$mixins=_ref.mixins,mixins=_ref$mixins===void 0?[]:_ref$mixins;return function(store){var props=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var element=createElement(tag,'filepond--'+name,attributes);var style=window.getComputedStyle(element,null);var rect=updateRect();var frameRect=null;var isResting=!1;var childViews=[];var activeMixins=[];var ref={};var state={};var writers=[write];var readers=[read];var destroyers=[destroy];var getElement=function getElement(){return element};var getChildViews=function getChildViews(){return childViews.concat()};var getReference=function getReference(){return ref};var createChildView=function createChildView(store){return function(view,props){return view(store,props)}};var getRect=function getRect(){if(frameRect){return frameRect}
frameRect=getViewRect(rect,childViews,[0,0],[1,1]);return frameRect};var getStyle=function getStyle(){return style};var _read=function _read(){frameRect=null;childViews.forEach(function(child){return child._read()});var shouldUpdate=!(ignoreRectUpdate&&rect.width&&rect.height);if(shouldUpdate){updateRect(rect,element,style)}
var api={root:internalAPI,props:props,rect:rect};readers.forEach(function(reader){return reader(api)})};var _write=function _write(ts,frameActions,shouldOptimize){var resting=frameActions.length===0;writers.forEach(function(writer){var writerResting=writer({props:props,root:internalAPI,actions:frameActions,timestamp:ts,shouldOptimize:shouldOptimize});if(writerResting===!1){resting=!1}});activeMixins.forEach(function(mixin){var mixinResting=mixin.write(ts);if(mixinResting===!1){resting=!1}});childViews.filter(function(child){return!!child.element.parentNode}).forEach(function(child){var childResting=child._write(ts,filterFrameActionsForChild(child,frameActions),shouldOptimize);if(!childResting){resting=!1}});childViews.forEach(function(child,index){if(child.element.parentNode){return}
internalAPI.appendChild(child.element,index);child._read();child._write(ts,filterFrameActionsForChild(child,frameActions),shouldOptimize);resting=!1});isResting=resting;didWriteView({props:props,root:internalAPI,actions:frameActions,timestamp:ts});return resting};var _destroy=function _destroy(){activeMixins.forEach(function(mixin){return mixin.destroy()});destroyers.forEach(function(destroyer){destroyer({root:internalAPI,props:props})});childViews.forEach(function(child){return child._destroy()})};var sharedAPIDefinition={element:{get:getElement},style:{get:getStyle},childViews:{get:getChildViews}};var internalAPIDefinition=Object.assign({},sharedAPIDefinition,{rect:{get:getRect},ref:{get:getReference},is:function is(needle){return name===needle},appendChild:appendChild(element),createChildView:createChildView(store),linkView:function linkView(view){childViews.push(view);return view},unlinkView:function unlinkView(view){childViews.splice(childViews.indexOf(view),1)},appendChildView:appendChildView(element,childViews),removeChildView:removeChildView(element,childViews),registerWriter:function registerWriter(writer){return writers.push(writer)},registerReader:function registerReader(reader){return readers.push(reader)},registerDestroyer:function registerDestroyer(destroyer){return destroyers.push(destroyer)},invalidateLayout:function invalidateLayout(){return(element.layoutCalculated=!1)},dispatch:store.dispatch,query:store.query});var externalAPIDefinition={element:{get:getElement},childViews:{get:getChildViews},rect:{get:getRect},resting:{get:function get(){return isResting}},isRectIgnored:function isRectIgnored(){return ignoreRect},_read:_read,_write:_write,_destroy:_destroy};var mixinAPIDefinition=Object.assign({},sharedAPIDefinition,{rect:{get:function get(){return rect}}});Object.keys(mixins).sort(function(a,b){if(a==='styles'){return 1}else if(b==='styles'){return-1}
return 0}).forEach(function(key){var mixinAPI=Mixins[key]({mixinConfig:mixins[key],viewProps:props,viewState:state,viewInternalAPI:internalAPIDefinition,viewExternalAPI:externalAPIDefinition,view:createObject(mixinAPIDefinition)});if(mixinAPI){activeMixins.push(mixinAPI)}});var internalAPI=createObject(internalAPIDefinition);create({root:internalAPI,props:props});var childCount=element.children.length;childViews.forEach(function(child,index){internalAPI.appendChild(child.element,childCount+index)});didCreateView(internalAPI);return createObject(externalAPIDefinition,props)}};var createPainter=function createPainter(read,write){var fps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:60;var name='__framePainter';if(window[name]){window[name].readers.push(read);window[name].writers.push(write);return}
window[name]={readers:[read],writers:[write]};var painter=window[name];var interval=1000/fps;var last=null;var id=null;var requestTick=null;var cancelTick=null;var setTimerType=function setTimerType(){if(document.hidden){requestTick=function requestTick(){return window.setTimeout(function(){return tick(performance.now())},interval)};cancelTick=function cancelTick(){return window.clearTimeout(id)}}else{requestTick=function requestTick(){return window.requestAnimationFrame(tick)};cancelTick=function cancelTick(){return window.cancelAnimationFrame(id)}}};document.addEventListener('visibilitychange',function(){if(cancelTick)cancelTick();setTimerType();tick(performance.now())});var tick=function tick(ts){id=requestTick(tick);if(!last){last=ts}
var delta=ts-last;if(delta<=interval){return}
last=ts-(delta%interval);painter.readers.forEach(function(read){return read()});painter.writers.forEach(function(write){return write(ts)})};setTimerType();tick(performance.now());return{pause:function pause(){cancelTick(id)}}};var createRoute=function createRoute(routes,fn){return function(_ref){var root=_ref.root,props=_ref.props,_ref$actions=_ref.actions,actions=_ref$actions===void 0?[]:_ref$actions,timestamp=_ref.timestamp,shouldOptimize=_ref.shouldOptimize;actions.filter(function(action){return routes[action.type]}).forEach(function(action){return routes[action.type]({root:root,props:props,action:action.data,timestamp:timestamp,shouldOptimize:shouldOptimize})});if(fn){fn({root:root,props:props,actions:actions,timestamp:timestamp,shouldOptimize:shouldOptimize})}}};var insertBefore=function insertBefore(newNode,referenceNode){return referenceNode.parentNode.insertBefore(newNode,referenceNode)};var insertAfter=function insertAfter(newNode,referenceNode){return referenceNode.parentNode.insertBefore(newNode,referenceNode.nextSibling)};var isArray=function isArray(value){return Array.isArray(value)};var isEmpty=function isEmpty(value){return value==null};var trim=function trim(str){return str.trim()};var toString=function toString(value){return''+value};var toArray=function toArray(value){var splitter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:',';if(isEmpty(value)){return[]}
if(isArray(value)){return value}
return toString(value).split(splitter).map(trim).filter(function(str){return str.length})};var isBoolean=function isBoolean(value){return typeof value==='boolean'};var toBoolean=function toBoolean(value){return isBoolean(value)?value:value==='true'};var isString=function isString(value){return typeof value==='string'};var toNumber=function toNumber(value){return isNumber(value)?value:isString(value)?toString(value).replace(/[a-z]+/gi,''):0};var toInt=function toInt(value){return parseInt(toNumber(value),10)};var toFloat=function toFloat(value){return parseFloat(toNumber(value))};var isInt=function isInt(value){return isNumber(value)&&isFinite(value)&&Math.floor(value)===value};var toBytes=function toBytes(value){if(isInt(value)){return value}
var naturalFileSize=toString(value).trim();if(/MB$/i.test(naturalFileSize)){naturalFileSize=naturalFileSize.replace(/MB$i/,'').trim();return toInt(naturalFileSize)*1000*1000}
if(/KB/i.test(naturalFileSize)){naturalFileSize=naturalFileSize.replace(/KB$i/,'').trim();return toInt(naturalFileSize)*1000}
return toInt(naturalFileSize)};var isFunction=function isFunction(value){return typeof value==='function'};var toFunctionReference=function toFunctionReference(string){var ref=self;var levels=string.split('.');var level=null;while((level=levels.shift())){ref=ref[level];if(!ref){return null}}
return ref};var methods={process:'POST',revert:'DELETE',fetch:'GET',restore:'GET',load:'GET'};var createServerAPI=function createServerAPI(outline){var api={};api.url=isString(outline)?outline:outline.url||'';api.timeout=outline.timeout?parseInt(outline.timeout,10):0;forin(methods,function(key){api[key]=createAction(key,outline[key],methods[key],api.timeout)});api.remove=outline.remove||null;return api};var createAction=function createAction(name,outline,method,timeout){if(outline===null){return null}
if(typeof outline==='function'){return outline}
var action={url:method==='GET'?'?'+name+'=':'',method:method,headers:{},withCredentials:!1,timeout:timeout,onload:null,ondata:null,onerror:null};if(isString(outline)){action.url=outline;return action}
Object.assign(action,outline);if(isString(action.headers)){var parts=action.headers.split(/:(.+)/);action.headers={header:parts[0],value:parts[1]}}
action.withCredentials=toBoolean(action.withCredentials);return action};var toServerAPI=function toServerAPI(value){return createServerAPI(value)};var isNull=function isNull(value){return value===null};var isObject=function isObject(value){return typeof value==='object'&&value!==null};var isAPI=function isAPI(value){return(isObject(value)&&isString(value.url)&&isObject(value.process)&&isObject(value.revert)&&isObject(value.restore)&&isObject(value.fetch))};var getType=function getType(value){if(isArray(value)){return'array'}
if(isNull(value)){return'null'}
if(isInt(value)){return'int'}
if(/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(value)){return'bytes'}
if(isAPI(value)){return'api'}
return typeof value};var replaceSingleQuotes=function replaceSingleQuotes(str){return str.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",')};var conversionTable={array:toArray,boolean:toBoolean,int:function int(value){return getType(value)==='bytes'?toBytes(value):toInt(value)},number:toFloat,float:toFloat,bytes:toBytes,string:function string(value){return isFunction(value)?value:toString(value)},function:function _function(value){return toFunctionReference(value)},serverapi:toServerAPI,object:function object(value){try{return JSON.parse(replaceSingleQuotes(value))}catch(e){return null}}};var convertTo=function convertTo(value,type){return conversionTable[type](value)};var getValueByType=function getValueByType(newValue,defaultValue,valueType){if(newValue===defaultValue){return newValue}
var newValueType=getType(newValue);if(newValueType!==valueType){var convertedValue=convertTo(newValue,valueType);newValueType=getType(convertedValue);if(convertedValue===null){throw 'Trying to assign value with incorrect type to "'+option+'", allowed type: "'+valueType+'"'}else{newValue=convertedValue}}
return newValue};var createOption=function createOption(defaultValue,valueType){var currentValue=defaultValue;return{enumerable:!0,get:function get(){return currentValue},set:function set(newValue){currentValue=getValueByType(newValue,defaultValue,valueType)}}};var createOptions=function createOptions(options){var obj={};forin(options,function(prop){var optionDefinition=options[prop];obj[prop]=createOption(optionDefinition[0],optionDefinition[1])});return createObject(obj)};var createInitialState=function createInitialState(options){return{items:[],listUpdateTimeout:null,processingQueue:[],options:createOptions(options)}};var fromCamels=function fromCamels(string){var separator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'-';return string.split(/(?=[A-Z])/).map(function(part){return part.toLowerCase()}).join(separator)};var createOptionAPI=function createOptionAPI(store,options){var obj={};forin(options,function(key){obj[key]={get:function get(){return store.getState().options[key]},set:function set(value){store.dispatch('SET_'+fromCamels(key,'_').toUpperCase(),{value:value})}}});return obj};var createOptionActions=function createOptionActions(options){return function(dispatch,query,state){var obj={};forin(options,function(key){var name=fromCamels(key,'_').toUpperCase();obj['SET_'+name]=function(action){try{state.options[key]=action.value}catch(e){}
dispatch('DID_SET_'+name,{value:state.options[key]})}});return obj}};var createOptionQueries=function createOptionQueries(options){return function(state){var obj={};forin(options,function(key){obj['GET_'+fromCamels(key,'_').toUpperCase()]=function(action){return state.options[key]}});return obj}};var InteractionMethod={API:1,DROP:2,BROWSE:3,PASTE:4,NONE:5};var getUniqueId=function getUniqueId(){return Math.random().toString(36).substr(2,9)};var arrayRemove=function arrayRemove(arr,index){return arr.splice(index,1)};var on=function on(){var listeners=[];var off=function off(event,cb){arrayRemove(listeners,listeners.findIndex(function(listener){return listener.event===event&&(listener.cb===cb||!cb)}))};return{fire:function fire(event){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}
listeners.filter(function(listener){return listener.event===event}).map(function(listener){return listener.cb}).forEach(function(cb){setTimeout(function(){cb.apply(void 0,args)},0)})},on:function on(event,cb){listeners.push({event:event,cb:cb})},onOnce:function onOnce(event,_cb){listeners.push({event:event,cb:function cb(){off(event,_cb);_cb.apply(void 0,arguments)}})},off:off}};var copyObjectPropertiesToObject=function copyObjectPropertiesToObject(src,target,excluded){Object.getOwnPropertyNames(src).filter(function(property){return!excluded.includes(property)}).forEach(function(key){return Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(src,key))})};var PRIVATE=['fire','process','revert','load','on','off','onOnce','retryLoad','extend','archive','archived','release','released','requestProcessing','freeze'];var createItemAPI=function createItemAPI(item){var api={};copyObjectPropertiesToObject(item,api,PRIVATE);return api};var removeReleasedItems=function removeReleasedItems(items){items.forEach(function(item,index){if(item.released){arrayRemove(items,index)}})};var ItemStatus={INIT:1,IDLE:2,PROCESSING_QUEUED:9,PROCESSING:3,PROCESSING_COMPLETE:5,PROCESSING_ERROR:6,PROCESSING_REVERT_ERROR:10,LOADING:7,LOAD_ERROR:8};var FileOrigin={INPUT:1,LIMBO:2,LOCAL:3};var getNonNumeric=function getNonNumeric(str){return/[^0-9]+/.exec(str)};var getDecimalSeparator=function getDecimalSeparator(){return getNonNumeric((1.1).toLocaleString())[0]};var getThousandsSeparator=function getThousandsSeparator(){var decimalSeparator=getDecimalSeparator();var thousandsStringWithSeparator=(1000.0).toLocaleString();var thousandsStringWithoutSeparator=(1000.0).toString();if(thousandsStringWithSeparator!==thousandsStringWithoutSeparator){return getNonNumeric(thousandsStringWithSeparator)[0]}
return decimalSeparator==='.'?',':'.'};var Type={BOOLEAN:'boolean',INT:'int',NUMBER:'number',STRING:'string',ARRAY:'array',OBJECT:'object',FUNCTION:'function',ACTION:'action',SERVER_API:'serverapi',REGEX:'regex'};var filters=[];var applyFilterChain=function applyFilterChain(key,value,utils){return new Promise(function(resolve,reject){var matchingFilters=filters.filter(function(f){return f.key===key}).map(function(f){return f.cb});if(matchingFilters.length===0){resolve(value);return}
var initialFilter=matchingFilters.shift();matchingFilters.reduce(function(current,next){return current.then(function(value){return next(value,utils)})},initialFilter(value,utils)).then(function(value){return resolve(value)}).catch(function(error){return reject(error)})})};var applyFilters=function applyFilters(key,value,utils){return filters.filter(function(f){return f.key===key}).map(function(f){return f.cb(value,utils)})};var addFilter=function addFilter(key,cb){return filters.push({key:key,cb:cb})};var extendDefaultOptions=function extendDefaultOptions(additionalOptions){return Object.assign(defaultOptions,additionalOptions)};var getOptions=function getOptions(){return Object.assign({},defaultOptions)};var setOptions=function setOptions(opts){forin(opts,function(key,value){if(!defaultOptions[key]){return}
defaultOptions[key][0]=getValueByType(value,defaultOptions[key][0],defaultOptions[key][1])})};var defaultOptions={id:[null,Type.STRING],name:['filepond',Type.STRING],disabled:[!1,Type.BOOLEAN],className:[null,Type.STRING],required:[!1,Type.BOOLEAN],captureMethod:[null,Type.STRING],allowDrop:[!0,Type.BOOLEAN],allowBrowse:[!0,Type.BOOLEAN],allowPaste:[!0,Type.BOOLEAN],allowMultiple:[!1,Type.BOOLEAN],allowReplace:[!0,Type.BOOLEAN],allowRevert:[!0,Type.BOOLEAN],forceRevert:[!1,Type.BOOLEAN],maxFiles:[null,Type.INT],checkValidity:[!1,Type.BOOLEAN],itemInsertLocationFreedom:[!0,Type.BOOLEAN],itemInsertLocation:['before',Type.STRING],itemInsertInterval:[75,Type.INT],dropOnPage:[!1,Type.BOOLEAN],dropOnElement:[!0,Type.BOOLEAN],dropValidation:[!1,Type.BOOLEAN],ignoredFiles:[['.ds_store','thumbs.db','desktop.ini'],Type.ARRAY],instantUpload:[!0,Type.BOOLEAN],maxParallelUploads:[2,Type.INT],server:[null,Type.SERVER_API],labelDecimalSeparator:[getDecimalSeparator(),Type.STRING],labelThousandsSeparator:[getThousandsSeparator(),Type.STRING],labelIdle:['Drag & Drop your files or <span class="filepond--label-action">Browse</span>',Type.STRING],labelInvalidField:['Field contains invalid files',Type.STRING],labelFileWaitingForSize:['Waiting for size',Type.STRING],labelFileSizeNotAvailable:['Size not available',Type.STRING],labelFileCountSingular:['file in list',Type.STRING],labelFileCountPlural:['files in list',Type.STRING],labelFileLoading:['Loading',Type.STRING],labelFileAdded:['Added',Type.STRING],labelFileLoadError:['Error during load',Type.STRING],labelFileRemoved:['Removed',Type.STRING],labelFileRemoveError:['Error during remove',Type.STRING],labelFileProcessing:['Uploading',Type.STRING],labelFileProcessingComplete:['Upload complete',Type.STRING],labelFileProcessingAborted:['Upload cancelled',Type.STRING],labelFileProcessingError:['Error during upload',Type.STRING],labelFileProcessingRevertError:['Error during revert',Type.STRING],labelTapToCancel:['tap to cancel',Type.STRING],labelTapToRetry:['tap to retry',Type.STRING],labelTapToUndo:['tap to undo',Type.STRING],labelButtonRemoveItem:['Remove',Type.STRING],labelButtonAbortItemLoad:['Abort',Type.STRING],labelButtonRetryItemLoad:['Retry',Type.STRING],labelButtonAbortItemProcessing:['Cancel',Type.STRING],labelButtonUndoItemProcessing:['Undo',Type.STRING],labelButtonRetryItemProcessing:['Retry',Type.STRING],labelButtonProcessItem:['Upload',Type.STRING],iconRemove:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M11.586 13l-2.293 2.293a1 1 0 0 0 1.414 1.414L13 14.414l2.293 2.293a1 1 0 0 0 1.414-1.414L14.414 13l2.293-2.293a1 1 0 0 0-1.414-1.414L13 11.586l-2.293-2.293a1 1 0 0 0-1.414 1.414L11.586 13z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],iconProcess:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M14 10.414v3.585a1 1 0 0 1-2 0v-3.585l-1.293 1.293a1 1 0 0 1-1.414-1.415l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.415L14 10.414zM9 18a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2H9z" fill="currentColor" fill-rule="evenodd"/></svg>',Type.STRING],iconRetry:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M10.81 9.185l-.038.02A4.997 4.997 0 0 0 8 13.683a5 5 0 0 0 5 5 5 5 0 0 0 5-5 1 1 0 0 1 2 0A7 7 0 1 1 9.722 7.496l-.842-.21a.999.999 0 1 1 .484-1.94l3.23.806c.535.133.86.675.73 1.21l-.804 3.233a.997.997 0 0 1-1.21.73.997.997 0 0 1-.73-1.21l.23-.928v-.002z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],iconUndo:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M9.185 10.81l.02-.038A4.997 4.997 0 0 1 13.683 8a5 5 0 0 1 5 5 5 5 0 0 1-5 5 1 1 0 0 0 0 2A7 7 0 1 0 7.496 9.722l-.21-.842a.999.999 0 1 0-1.94.484l.806 3.23c.133.535.675.86 1.21.73l3.233-.803a.997.997 0 0 0 .73-1.21.997.997 0 0 0-1.21-.73l-.928.23-.002-.001z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],iconDone:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M18.293 9.293a1 1 0 0 1 1.414 1.414l-7.002 7a1 1 0 0 1-1.414 0l-3.998-4a1 1 0 1 1 1.414-1.414L12 15.586l6.294-6.293z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],oninit:[null,Type.FUNCTION],onwarning:[null,Type.FUNCTION],onerror:[null,Type.FUNCTION],onactivatefile:[null,Type.FUNCTION],onaddfilestart:[null,Type.FUNCTION],onaddfileprogress:[null,Type.FUNCTION],onaddfile:[null,Type.FUNCTION],onprocessfilestart:[null,Type.FUNCTION],onprocessfileprogress:[null,Type.FUNCTION],onprocessfileabort:[null,Type.FUNCTION],onprocessfilerevert:[null,Type.FUNCTION],onprocessfile:[null,Type.FUNCTION],onprocessfiles:[null,Type.FUNCTION],onremovefile:[null,Type.FUNCTION],onpreparefile:[null,Type.FUNCTION],onupdatefiles:[null,Type.FUNCTION],beforeDropFile:[null,Type.FUNCTION],beforeAddFile:[null,Type.FUNCTION],beforeRemoveFile:[null,Type.FUNCTION],stylePanelLayout:[null,Type.STRING],stylePanelAspectRatio:[null,Type.STRING],styleItemPanelAspectRatio:[null,Type.STRING],styleButtonRemoveItemPosition:['left',Type.STRING],styleButtonProcessItemPosition:['right',Type.STRING],styleLoadIndicatorPosition:['right',Type.STRING],styleProgressIndicatorPosition:['right',Type.STRING],files:[[],Type.ARRAY]};var getItemByQuery=function getItemByQuery(items,query){if(isEmpty(query)){return items[0]||null}
if(isInt(query)){return items[query]||null}
if(typeof query==='object'){query=query.id}
return(items.find(function(item){return item.id===query})||null)};var getNumericAspectRatioFromString=function getNumericAspectRatioFromString(aspectRatio){if(isEmpty(aspectRatio)){return aspectRatio}
if(/:/.test(aspectRatio)){var parts=aspectRatio.split(':');return parts[1]/parts[0]}
return parseFloat(aspectRatio)};var getActiveItems=function getActiveItems(items){return items.filter(function(item){return!item.archived})};var Status={EMPTY:0,IDLE:1,ERROR:2,BUSY:3,READY:4};var ITEM_ERROR=[ItemStatus.LOAD_ERROR,ItemStatus.PROCESSING_ERROR,ItemStatus.PROCESSING_REVERT_ERROR];var ITEM_BUSY=[ItemStatus.LOADING,ItemStatus.PROCESSING,ItemStatus.PROCESSING_QUEUED,ItemStatus.INIT];var ITEM_READY=[ItemStatus.PROCESSING_COMPLETE];var isItemInErrorState=function isItemInErrorState(item){return ITEM_ERROR.includes(item.status)};var isItemInBusyState=function isItemInBusyState(item){return ITEM_BUSY.includes(item.status)};var isItemInReadyState=function isItemInReadyState(item){return ITEM_READY.includes(item.status)};var queries=function queries(state){return{GET_STATUS:function GET_STATUS(){var items=getActiveItems(state.items);var EMPTY=Status.EMPTY,ERROR=Status.ERROR,BUSY=Status.BUSY,IDLE=Status.IDLE,READY=Status.READY;if(items.length===0)return EMPTY;if(items.some(isItemInErrorState))return ERROR;if(items.some(isItemInBusyState))return BUSY;if(items.some(isItemInReadyState))return READY;return IDLE},GET_ITEM:function GET_ITEM(query){return getItemByQuery(state.items,query)},GET_ACTIVE_ITEM:function GET_ACTIVE_ITEM(query){return getItemByQuery(getActiveItems(state.items),query)},GET_ACTIVE_ITEMS:function GET_ACTIVE_ITEMS(query){return getActiveItems(state.items)},GET_ITEMS:function GET_ITEMS(query){return state.items},GET_ITEM_NAME:function GET_ITEM_NAME(query){var item=getItemByQuery(state.items,query);return item?item.filename:null},GET_ITEM_SIZE:function GET_ITEM_SIZE(query){var item=getItemByQuery(state.items,query);return item?item.fileSize:null},GET_STYLES:function GET_STYLES(){return Object.keys(state.options).filter(function(key){return/^style/.test(key)}).map(function(option){return{name:option,value:state.options[option]}})},GET_PANEL_ASPECT_RATIO:function GET_PANEL_ASPECT_RATIO(){var isShapeCircle=/circle/.test(state.options.stylePanelLayout);var aspectRatio=isShapeCircle?1:getNumericAspectRatioFromString(state.options.stylePanelAspectRatio);return aspectRatio},GET_ITEM_PANEL_ASPECT_RATIO:function GET_ITEM_PANEL_ASPECT_RATIO(){return state.options.styleItemPanelAspectRatio},GET_ITEMS_BY_STATUS:function GET_ITEMS_BY_STATUS(status){return getActiveItems(state.items).filter(function(item){return item.status===status})},GET_TOTAL_ITEMS:function GET_TOTAL_ITEMS(){return getActiveItems(state.items).length},IS_ASYNC:function IS_ASYNC(){return(isObject(state.options.server)&&(isObject(state.options.server.process)||isFunction(state.options.server.process)))}}};var hasRoomForItem=function hasRoomForItem(state){var count=getActiveItems(state.items).length;if(!state.options.allowMultiple){return count===0}
var maxFileCount=state.options.maxFiles;if(maxFileCount===null){return!0}
if(count<maxFileCount){return!0}
return!1};var limit=function limit(value,min,max){return Math.max(Math.min(max,value),min)};var arrayInsert=function arrayInsert(arr,index,item){return arr.splice(index,0,item)};var insertItem=function insertItem(items,item,index){if(isEmpty(item)){return null}
if(typeof index==='undefined'){items.push(item);return item}
index=limit(index,0,items.length);arrayInsert(items,index,item);return item};var isBase64DataURI=function isBase64DataURI(str){return/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*)\s*$/i.test(str)};var getFilenameFromURL=function getFilenameFromURL(url){return url.split('/').pop().split('?').shift()};var getExtensionFromFilename=function getExtensionFromFilename(name){return name.split('.').pop()};var guesstimateExtension=function guesstimateExtension(type){if(typeof type!=='string'){return''}
var subtype=type.split('/').pop();if(/svg/.test(subtype)){return'svg'}
if(/zip|compressed/.test(subtype)){return'zip'}
if(/plain/.test(subtype)){return'txt'}
if(/msword/.test(subtype)){return'doc'}
if(/[a-z]+/.test(subtype)){if(subtype==='jpeg'){return'jpg'}
return subtype}
return''};var leftPad=function leftPad(value){var padding=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';return(padding+value).slice(-padding.length)};var getDateString=function getDateString(){var date=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Date();return(date.getFullYear()+'-'+leftPad(date.getMonth()+1,'00')+'-'+leftPad(date.getDate(),'00')+'_'+leftPad(date.getHours(),'00')+'-'+leftPad(date.getMinutes(),'00')+'-'+leftPad(date.getSeconds(),'00'))};var getFileFromBlob=function getFileFromBlob(blob,filename){var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var extension=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var file=typeof type==='string'?blob.slice(0,blob.size,type):blob.slice(0,blob.size,blob.type);file.lastModifiedDate=new Date();if(!isString(filename)){filename=getDateString()}
if(filename&&extension===null&&getExtensionFromFilename(filename)){file.name=filename}else{extension=extension||guesstimateExtension(file.type);file.name=filename+(extension?'.'+extension:'')}
return file};var getBlobBuilder=function getBlobBuilder(){return(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)};var createBlob=function createBlob(arrayBuffer,mimeType){var BB=getBlobBuilder();if(BB){var bb=new BB();bb.append(arrayBuffer);return bb.getBlob(mimeType)}
return new Blob([arrayBuffer],{type:mimeType})};var getBlobFromByteStringWithMimeType=function getBlobFromByteStringWithMimeType(byteString,mimeType){var ab=new ArrayBuffer(byteString.length);var ia=new Uint8Array(ab);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i)}
return createBlob(ab,mimeType)};var getMimeTypeFromBase64DataURI=function getMimeTypeFromBase64DataURI(dataURI){return(/^data:(.+);/.exec(dataURI)||[])[1]||null};var getBase64DataFromBase64DataURI=function getBase64DataFromBase64DataURI(dataURI){var data=dataURI.split(',')[1];return data.replace(/\s/g,'')};var getByteStringFromBase64DataURI=function getByteStringFromBase64DataURI(dataURI){return atob(getBase64DataFromBase64DataURI(dataURI))};var getBlobFromBase64DataURI=function getBlobFromBase64DataURI(dataURI){var mimeType=getMimeTypeFromBase64DataURI(dataURI);var byteString=getByteStringFromBase64DataURI(dataURI);return getBlobFromByteStringWithMimeType(byteString,mimeType)};var getFileFromBase64DataURI=function getFileFromBase64DataURI(dataURI,filename,extension){return getFileFromBlob(getBlobFromBase64DataURI(dataURI),filename,null,extension)};var getFileNameFromHeader=function getFileNameFromHeader(header){if(!/^content-disposition:/i.test(header))return null;var matches=header.split(/filename=|filename\*=.+''/).splice(1).map(function(name){return name.trim().replace(/^["']|[;"']{0,2}$/g,'')}).filter(function(name){return name.length});return matches.length?decodeURI(matches[matches.length-1]):null};var getFileSizeFromHeader=function getFileSizeFromHeader(header){if(/content-length:/i.test(header)){var size=header.match(/[0-9]+/)[0];return size?parseInt(size,10):null}
return null};var getTranfserIdFromHeader=function getTranfserIdFromHeader(header){if(/x-content-transfer-id:/i.test(header)){var id=(header.split(':')[1]||'').trim();return id||null}
return null};var getFileInfoFromHeaders=function getFileInfoFromHeaders(headers){var info={source:null,name:null,size:null};var rows=headers.split('\n');var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=undefined;try{for(var _iterator=rows[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var header=_step.value;var name=getFileNameFromHeader(header);if(name){info.name=name;continue}
var size=getFileSizeFromHeader(header);if(size){info.size=size;continue}
var source=getTranfserIdFromHeader(header);if(source){info.source=source;continue}}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}
return info};var createFileLoader=function createFileLoader(fetchFn){var state={source:null,complete:!1,progress:0,size:null,timestamp:null,duration:0,request:null};var getProgress=function getProgress(){return state.progress};var abort=function abort(){if(!state.request){return}
state.request.abort()};var load=function load(){var source=state.source;api.fire('init',source);if(source instanceof File){api.fire('load',source)}else if(source instanceof Blob){api.fire('load',getFileFromBlob(source,source.name))}else if(isBase64DataURI(source)){api.fire('load',getFileFromBase64DataURI(source))}else{loadURL(source)}};var loadURL=function loadURL(url){if(!fetchFn){api.fire('error',{type:'error',body:"Can't load URL",code:400});return}
state.timestamp=Date.now();state.request=fetchFn(url,function(response){state.duration=Date.now()-state.timestamp;state.complete=!0;if(response instanceof Blob){response=getFileFromBlob(response,getFilenameFromURL(url))}
api.fire('load',response instanceof Blob?response:response.body)},function(error){api.fire('error',typeof error==='string'?{type:'error',code:0,body:error}:error)},function(computable,current,total){if(total){state.size=total}
state.duration=Date.now()-state.timestamp;if(!computable){state.progress=null;return}
state.progress=current/total;api.fire('progress',state.progress)},function(){api.fire('abort')},function(response){var fileinfo=getFileInfoFromHeaders(typeof response==='string'?response:response.headers);api.fire('meta',{size:state.size||fileinfo.size,filename:fileinfo.name,source:fileinfo.source})})};var api=Object.assign({},on(),{setSource:function setSource(source){return(state.source=source)},getProgress:getProgress,abort:abort,load:load});return api};var isGet=function isGet(method){return/GET|HEAD/.test(method)};var sendRequest=function sendRequest(data,url,options){var api={onheaders:function onheaders(){},onprogress:function onprogress(){},onload:function onload(){},ontimeout:function ontimeout(){},onerror:function onerror(){},onabort:function onabort(){},abort:function abort(){aborted=!0;xhr.abort()}};var aborted=!1;var headersReceived=!1;options=Object.assign({method:'POST',headers:{},withCredentials:!1},options);url=encodeURI(url);if(isGet(options.method)&&data){url=''+url+encodeURIComponent(typeof data==='string'?data:JSON.stringify(data))}
var xhr=new XMLHttpRequest();var process=isGet(options.method)?xhr:xhr.upload;process.onprogress=function(e){if(aborted){return}
api.onprogress(e.lengthComputable,e.loaded,e.total)};xhr.onreadystatechange=function(){if(xhr.readyState<2){return}
if(xhr.readyState===4&&xhr.status===0){return}
if(headersReceived){return}
headersReceived=!0;api.onheaders(xhr)};xhr.onload=function(){if(xhr.status>=200&&xhr.status<300){api.onload(xhr)}else{api.onerror(xhr)}};xhr.onerror=function(){return api.onerror(xhr)};xhr.onabort=function(){aborted=!0;api.onabort()};xhr.ontimeout=function(){return api.ontimeout(xhr)};xhr.open(options.method,url,!0);if(isInt(options.timeout)){xhr.timeout=options.timeout}
Object.keys(options.headers).forEach(function(key){xhr.setRequestHeader(key,options.headers[key])});if(options.responseType){xhr.responseType=options.responseType}
if(options.withCredentials){xhr.withCredentials=!0}
xhr.send(data);return api};var createResponse=function createResponse(type,code,body,headers){return{type:type,code:code,body:body,headers:headers}};var createTimeoutResponse=function createTimeoutResponse(cb){return function(xhr){cb(createResponse('error',0,'Timeout',xhr.getAllResponseHeaders()))}};var createFetchFunction=function createFetchFunction(){var apiUrl=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var action=arguments.length>1?arguments[1]:undefined;if(typeof action==='function'){return action}
if(!action||!isString(action.url)){return null}
var onload=action.onload||function(res){return res};var onerror=action.onerror||function(res){return null};return function(url,load,error,progress,abort,headers){var request=sendRequest(url,apiUrl+action.url,Object.assign({},action,{responseType:'blob'}));request.onload=function(xhr){var headers=xhr.getAllResponseHeaders();var filename=getFileInfoFromHeaders(headers).name||getFilenameFromURL(url);load(createResponse('load',xhr.status,getFileFromBlob(onload(xhr.response),filename),headers))};request.onerror=function(xhr){error(createResponse('error',xhr.status,onerror(xhr.response)||xhr.statusText,xhr.getAllResponseHeaders()))};request.onheaders=function(xhr){headers(createResponse('headers',xhr.status,null,xhr.getAllResponseHeaders()))};request.ontimeout=createTimeoutResponse(error);request.onprogress=progress;request.onabort=abort;return request}};var createProcessorFunction=function createProcessorFunction(){var apiUrl=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var action=arguments.length>1?arguments[1]:undefined;var name=arguments.length>2?arguments[2]:undefined;if(typeof action==='function'){return function(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++){params[_key]=arguments[_key]}
return action.apply(void 0,[name].concat(params))}}
if(!action||!isString(action.url)){return null}
return function(file,metadata,load,error,progress,abort){var ondata=action.ondata||function(fd){return fd};var onload=action.onload||function(res){return res};var onerror=action.onerror||function(res){return null};if(!file)return;var formData=new FormData();if(isObject(metadata)){formData.append(name,JSON.stringify(metadata))}(file instanceof Blob?[{name:null,file:file}]:file).forEach(function(item){formData.append(name,item.file,item.name===null?item.file.name:''+item.name+item.file.name)});var request=sendRequest(ondata(formData),apiUrl+action.url,action);request.onload=function(xhr){load(createResponse('load',xhr.status,onload(xhr.response),xhr.getAllResponseHeaders()))};request.onerror=function(xhr){error(createResponse('error',xhr.status,onerror(xhr.response)||xhr.statusText,xhr.getAllResponseHeaders()))};request.ontimeout=createTimeoutResponse(error);request.onprogress=progress;request.onabort=abort;return request}};var createRevertFunction=function createRevertFunction(){var apiUrl=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var action=arguments.length>1?arguments[1]:undefined;if(typeof action==='function'){return action}
if(!action||!isString(action.url)){return function(uniqueFileId,load){return load()}}
var onload=action.onload||function(res){return res};var onerror=action.onerror||function(res){return null};return function(uniqueFileId,load,error){var request=sendRequest(uniqueFileId,apiUrl+action.url,action);request.onload=function(xhr){load(createResponse('load',xhr.status,onload(xhr.response),xhr.getAllResponseHeaders()))};request.onerror=function(xhr){error(createResponse('error',xhr.status,onerror(xhr.response)||xhr.statusText,xhr.getAllResponseHeaders()))};request.ontimeout=createTimeoutResponse(error);return request}};var getRandomNumber=function getRandomNumber(){var min=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var max=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return min+Math.random()*(max-min)};var createPerceivedPerformanceUpdater=function createPerceivedPerformanceUpdater(cb){var duration=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1000;var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var tickMin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:25;var tickMax=arguments.length>4&&arguments[4]!==undefined?arguments[4]:250;var timeout=null;var start=Date.now();var tick=function tick(){var runtime=Date.now()-start;var delay=getRandomNumber(tickMin,tickMax);if(runtime+delay>duration){delay=runtime+delay-duration}
var progress=runtime/duration;if(progress>=1){cb(1);return}
cb(progress);timeout=setTimeout(tick,delay)};tick();return{clear:function clear(){clearTimeout(timeout)}}};var createFileProcessor=function createFileProcessor(processFn){var state={complete:!1,perceivedProgress:0,perceivedPerformanceUpdater:null,progress:null,timestamp:null,perceivedDuration:0,duration:0,request:null,response:null};var process=function process(file,metadata){var progressFn=function progressFn(){if(state.duration===0||state.progress===null){return}
api.fire('progress',api.getProgress())};var completeFn=function completeFn(){state.complete=!0;api.fire('load-perceived',state.response.body)};api.fire('start');state.timestamp=Date.now();state.perceivedPerformanceUpdater=createPerceivedPerformanceUpdater(function(progress){state.perceivedProgress=progress;state.perceivedDuration=Date.now()-state.timestamp;progressFn();if(state.response&&state.perceivedProgress===1&&!state.complete){completeFn()}},getRandomNumber(750,1500));state.request=processFn(file,metadata,function(response){state.response=isObject(response)?response:{type:'load',code:200,body:''+response,headers:{}};state.duration=Date.now()-state.timestamp;state.progress=1;api.fire('load',state.response.body);if(state.perceivedProgress===1){completeFn()}},function(error){state.perceivedPerformanceUpdater.clear();api.fire('error',isObject(error)?error:{type:'error',code:0,body:''+error})},function(computable,current,total){state.duration=Date.now()-state.timestamp;state.progress=computable?current/total:null;progressFn()},function(){state.perceivedPerformanceUpdater.clear();api.fire('abort',state.response?state.response.body:null)})};var abort=function abort(){if(!state.request)return;state.perceivedPerformanceUpdater.clear();state.request.abort();state.complete=!0};var reset=function reset(){abort();state.complete=!1;state.perceivedProgress=0;state.progress=0;state.timestamp=null;state.perceivedDuration=0;state.duration=0;state.request=null;state.response=null};var getProgress=function getProgress(){return state.progress?Math.min(state.progress,state.perceivedProgress):null};var getDuration=function getDuration(){return Math.min(state.duration,state.perceivedDuration)};var api=Object.assign({},on(),{process:process,abort:abort,getProgress:getProgress,getDuration:getDuration,reset:reset});return api};var getFilenameWithoutExtension=function getFilenameWithoutExtension(name){return name.substr(0,name.lastIndexOf('.'))||name};var createFileStub=function createFileStub(source){var data=[source.name,source.size,source.type];if(source instanceof Blob||isBase64DataURI(source)){data[0]=source.name||getDateString()}else if(isBase64DataURI(source)){data[1]=source.length;data[2]=getMimeTypeFromBase64DataURI(source)}else if(isString(source)){data[0]=getFilenameFromURL(source);data[1]=0;data[2]='application/octet-stream'}
return{name:data[0],size:data[1],type:data[2]}};var isFile=function isFile(value){return!!(value instanceof File||(value instanceof Blob&&value.name))};var deepCloneObject=function deepCloneObject(src){if(!isObject(src))return src;var target=isArray(src)?[]:{};for(var key in src){if(!src.hasOwnProperty(key))continue;var v=src[key];target[key]=v&&isObject(v)?deepCloneObject(v):v}
return target};var createItem=function createItem(){var origin=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var serverFileReference=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var file=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var id=getUniqueId();var state={archived:!1,frozen:!1,released:!1,source:null,file:file,serverFileReference:serverFileReference,status:serverFileReference?ItemStatus.PROCESSING_COMPLETE:ItemStatus.INIT,activeLoader:null,activeProcessor:null};var abortProcessingRequestComplete=null;var metadata={};var setStatus=function setStatus(status){return(state.status=status)};var fire=function fire(event){if(state.released||state.frozen)return;for(var _len=arguments.length,params=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){params[_key-1]=arguments[_key]}
api.fire.apply(api,[event].concat(params))};var getFileExtension=function getFileExtension(){return getExtensionFromFilename(state.file.name)};var getFileType=function getFileType(){return state.file.type};var getFileSize=function getFileSize(){return state.file.size};var getFile=function getFile(){return state.file};var load=function load(source,loader,onload){state.source=source;if(state.file){fire('load-skip');return}
state.file=createFileStub(source);loader.on('init',function(){fire('load-init')});loader.on('meta',function(meta){state.file.size=meta.size;state.file.filename=meta.filename;if(meta.source){origin=FileOrigin.LIMBO;state.serverFileReference=meta.source;state.status=ItemStatus.PROCESSING_COMPLETE}
fire('load-meta')});loader.on('progress',function(progress){setStatus(ItemStatus.LOADING);fire('load-progress',progress)});loader.on('error',function(error){setStatus(ItemStatus.LOAD_ERROR);fire('load-request-error',error)});loader.on('abort',function(){setStatus(ItemStatus.INIT);fire('load-abort')});loader.on('load',function(file){state.activeLoader=null;var success=function success(result){state.file=isFile(result)?result:state.file;if(origin===FileOrigin.LIMBO&&state.serverFileReference){setStatus(ItemStatus.PROCESSING_COMPLETE)}else{setStatus(ItemStatus.IDLE)}
fire('load')};var error=function error(result){state.file=file;fire('load-meta');setStatus(ItemStatus.LOAD_ERROR);fire('load-file-error',result)};if(state.serverFileReference){success(file);return}
onload(file,success,error)});loader.setSource(source);state.activeLoader=loader;loader.load()};var retryLoad=function retryLoad(){if(!state.activeLoader){return}
state.activeLoader.load()};var abortLoad=function abortLoad(){if(state.activeLoader){state.activeLoader.abort();return}
setStatus(ItemStatus.INIT);fire('load-abort')};var process=function process(processor,onprocess){setStatus(ItemStatus.PROCESSING);abortProcessingRequestComplete=null;if(!(state.file instanceof Blob)){api.on('load',function(){process(processor,onprocess)});return}
processor.on('load',function(serverFileReference){state.serverFileReference=serverFileReference});processor.on('load-perceived',function(serverFileReference){state.activeProcessor=null;state.serverFileReference=serverFileReference;setStatus(ItemStatus.PROCESSING_COMPLETE);fire('process-complete',serverFileReference)});processor.on('start',function(){fire('process-start')});processor.on('error',function(error){state.activeProcessor=null;setStatus(ItemStatus.PROCESSING_ERROR);fire('process-error',error)});processor.on('abort',function(serverFileReference){state.activeProcessor=null;state.serverFileReference=serverFileReference;setStatus(ItemStatus.IDLE);fire('process-abort');if(abortProcessingRequestComplete){abortProcessingRequestComplete()}});processor.on('progress',function(progress){fire('process-progress',progress)});var success=function success(file){if(state.archived)return;processor.process(file,Object.assign({},metadata))};var error=function error(result){};onprocess(state.file,success,error);state.activeProcessor=processor};var requestProcessing=function requestProcessing(){setStatus(ItemStatus.PROCESSING_QUEUED)};var abortProcessing=function abortProcessing(){return new Promise(function(resolve){if(!state.activeProcessor){setStatus(ItemStatus.IDLE);fire('process-abort');resolve();return}
abortProcessingRequestComplete=function abortProcessingRequestComplete(){resolve()};state.activeProcessor.abort()})};var revert=function revert(revertFileUpload,forceRevert){return new Promise(function(resolve,reject){if(state.serverFileReference===null){resolve();return}
revertFileUpload(state.serverFileReference,function(){state.serverFileReference=null;resolve()},function(error){if(!forceRevert){resolve();return}
setStatus(ItemStatus.PROCESSING_REVERT_ERROR);fire('process-revert-error');reject(error)});setStatus(ItemStatus.IDLE);fire('process-revert')})};var _setMetadata=function setMetadata(key,value,silent){var keys=key.split('.');var root=keys[0];var last=keys.pop();var data=metadata;keys.forEach(function(key){return(data=data[key])});if(JSON.stringify(data[last])===JSON.stringify(value)){return}
data[last]=value;if(silent)return;fire('metadata-update',{key:root,value:metadata[root]})};var getMetadata=function getMetadata(key){return deepCloneObject(key?metadata[key]:metadata)};var api=Object.assign({id:{get:function get(){return id}},origin:{get:function get(){return origin}},serverId:{get:function get(){return state.serverFileReference}},status:{get:function get(){return state.status}},filename:{get:function get(){return state.file.name}},filenameWithoutExtension:{get:function get(){return getFilenameWithoutExtension(state.file.name)}},fileExtension:{get:getFileExtension},fileType:{get:getFileType},fileSize:{get:getFileSize},file:{get:getFile},source:{get:function get(){return state.source}},getMetadata:getMetadata,setMetadata:function setMetadata(key,value,silent){if(isObject(key)){var data=key;Object.keys(data).forEach(function(key){_setMetadata(key,data[key],value)});return key}
_setMetadata(key,value,silent);return value},extend:function extend(name,handler){return(itemAPI[name]=handler)},abortLoad:abortLoad,retryLoad:retryLoad,requestProcessing:requestProcessing,abortProcessing:abortProcessing,load:load,process:process,revert:revert},on(),{freeze:function freeze(){return(state.frozen=!0)},release:function release(){return(state.released=!0)},released:{get:function get(){return state.released}},archive:function archive(){return(state.archived=!0)},archived:{get:function get(){return state.archived}}});var itemAPI=createObject(api);return itemAPI};var getItemIndexByQuery=function getItemIndexByQuery(items,query){if(isEmpty(query)){return 0}
if(!isString(query)){return-1}
return items.findIndex(function(item){return item.id===query})};var getItemById=function getItemById(items,itemId){var index=getItemIndexByQuery(items,itemId);if(index<0){return}
return items[index]||null};var fetchLocal=function fetchLocal(url,load,error,progress,abort,headers){var request=sendRequest(null,url,{method:'GET',responseType:'blob'});request.onload=function(xhr){var headers=xhr.getAllResponseHeaders();var filename=getFileInfoFromHeaders(headers).name||getFilenameFromURL(url);load(createResponse('load',xhr.status,getFileFromBlob(xhr.response,filename),headers))};request.onerror=function(xhr){error(createResponse('error',xhr.status,xhr.statusText,xhr.getAllResponseHeaders()))};request.onheaders=function(xhr){headers(createResponse('headers',xhr.status,null,xhr.getAllResponseHeaders()))};request.ontimeout=createTimeoutResponse(error);request.onprogress=progress;request.onabort=abort;return request};var getDomainFromURL=function getDomainFromURL(url){if(url.indexOf('//')===0){url=location.protocol+url}
return url.toLowerCase().replace('blob:','').replace(/([a-z])?:\/\//,'$1').split('/')[0]};var isExternalURL=function isExternalURL(url){return((url.indexOf(':')>-1||url.indexOf('//')>-1)&&getDomainFromURL(location.href)!==getDomainFromURL(url))};var dynamicLabel=function dynamicLabel(label){return function(){return isFunction(label)?label.apply(void 0,arguments):label}};var isMockItem=function isMockItem(item){return!isFile(item.file)};var listUpdated=function listUpdated(dispatch,state){clearTimeout(state.listUpdateTimeout);state.listUpdateTimeout=setTimeout(function(){dispatch('DID_UPDATE_ITEMS',{items:getActiveItems(state.items)})},0)};var optionalPromise=function optionalPromise(fn){for(var _len=arguments.length,params=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){params[_key-1]=arguments[_key]}
return new Promise(function(resolve){if(!fn){return resolve(!0)}
var result=fn.apply(void 0,params);if(result==null){return resolve(!0)}
if(typeof result==='boolean'){return resolve(result)}
if(typeof result.then==='function'){result.then(resolve)}})};var sortItems=function sortItems(state,compare){state.items.sort(function(a,b){return compare(createItemAPI(a),createItemAPI(b))})};var getItemByQueryFromState=function getItemByQueryFromState(state,itemHandler){return function(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},query=_ref.query,_ref$success=_ref.success,success=_ref$success===void 0?function(){}:_ref$success,_ref$failure=_ref.failure,failure=_ref$failure===void 0?function(){}:_ref$failure;var item=getItemByQuery(state.items,query);if(!item){failure({error:createResponse('error',0,'Item not found'),file:null});return}
itemHandler(item,success,failure)}};var actions=function actions(dispatch,query,state){return{ABORT_ALL:function ABORT_ALL(){getActiveItems(state.items).forEach(function(item){item.freeze();item.abortLoad();item.abortProcessing()})},DID_SET_FILES:function DID_SET_FILES(_ref2){var _ref2$value=_ref2.value,value=_ref2$value===void 0?[]:_ref2$value;var files=value.map(function(file){return{source:file.source?file.source:file,options:file.options}});var activeItems=getActiveItems(state.items);activeItems.forEach(function(item){if(!files.find(function(file){return file.source===item.source||file.source===item.file})){dispatch('REMOVE_ITEM',{query:item})}});activeItems=getActiveItems(state.items);files.forEach(function(file,index){if(activeItems.find(function(item){return item.source===file.source||item.file===file.source}))
return;dispatch('ADD_ITEM',Object.assign({},file,{interactionMethod:InteractionMethod.NONE,index:index}))})},DID_UPDATE_ITEM_METADATA:function DID_UPDATE_ITEM_METADATA(_ref3){var id=_ref3.id,change=_ref3.change;var item=getItemById(state.items,id);if(!query('IS_ASYNC')){applyFilterChain('SHOULD_PREPARE_OUTPUT',!1,{item:item,query:query}).then(function(shouldPrepareOutput){if(!shouldPrepareOutput){return}
dispatch('REQUEST_PREPARE_OUTPUT',{query:id,item:item,ready:function ready(file){dispatch('DID_PREPARE_OUTPUT',{id:id,file:file})}},!0)});return}
var upload=function upload(){setTimeout(function(){dispatch('REQUEST_ITEM_PROCESSING',{query:id})},32)};var revert=function revert(doUpload){item.revert(createRevertFunction(state.options.server.url,state.options.server.revert),query('GET_FORCE_REVERT')).then(doUpload?upload:function(){}).catch(function(){})};var abort=function abort(doUpload){item.abortProcessing().then(doUpload?upload:function(){})};if(item.status===ItemStatus.PROCESSING_COMPLETE){return revert(state.options.instantUpload)}
if(item.status===ItemStatus.PROCESSING){return abort(state.options.instantUpload)}
if(state.options.instantUpload){upload()}},SORT:function SORT(_ref4){var compare=_ref4.compare;sortItems(state,compare)},ADD_ITEMS:function ADD_ITEMS(_ref5){var items=_ref5.items,index=_ref5.index,interactionMethod=_ref5.interactionMethod,_ref5$success=_ref5.success,success=_ref5$success===void 0?function(){}:_ref5$success,_ref5$failure=_ref5.failure,failure=_ref5$failure===void 0?function(){}:_ref5$failure;var currentIndex=index;if(index===-1||typeof index==='undefined'){var insertLocation=query('GET_ITEM_INSERT_LOCATION');var totalItems=query('GET_TOTAL_ITEMS');currentIndex=insertLocation==='before'?0:totalItems}
var ignoredFiles=query('GET_IGNORED_FILES');var isValidFile=function isValidFile(source){return isFile(source)?!ignoredFiles.includes(source.name.toLowerCase()):!isEmpty(source)};var validItems=items.filter(isValidFile);var promises=validItems.map(function(source){return new Promise(function(resolve,reject){dispatch('ADD_ITEM',{interactionMethod:interactionMethod,source:source.source||source,success:resolve,failure:reject,index:currentIndex++,options:source.options||{}})})});Promise.all(promises).then(success).catch(failure)},ADD_ITEM:function ADD_ITEM(_ref6){var source=_ref6.source,_ref6$index=_ref6.index,index=_ref6$index===void 0?-1:_ref6$index,interactionMethod=_ref6.interactionMethod,_ref6$success=_ref6.success,success=_ref6$success===void 0?function(){}:_ref6$success,_ref6$failure=_ref6.failure,failure=_ref6$failure===void 0?function(){}:_ref6$failure,_ref6$options=_ref6.options,options=_ref6$options===void 0?{}:_ref6$options;if(isEmpty(source)){failure({error:createResponse('error',0,'No source'),file:null});return}
if(isFile(source)&&state.options.ignoredFiles.includes(source.name.toLowerCase())){return}
if(!hasRoomForItem(state)){if(state.options.allowMultiple||(!state.options.allowMultiple&&!state.options.allowReplace)){var error=createResponse('warning',0,'Max files');dispatch('DID_THROW_MAX_FILES',{source:source,error:error});failure({error:error,file:null});return}
var _item=getActiveItems(state.items)[0];if(_item.status===ItemStatus.PROCESSING_COMPLETE||_item.status===ItemStatus.PROCESSING_REVERT_ERROR){var forceRevert=query('GET_FORCE_REVERT');_item.revert(createRevertFunction(state.options.server.url,state.options.server.revert),forceRevert).then(function(){if(!forceRevert)return;dispatch('ADD_ITEM',{source:source,index:index,interactionMethod:interactionMethod,success:success,failure:failure,options:options})}).catch(function(){});if(forceRevert)return}
dispatch('REMOVE_ITEM',{query:_item.id})}
var origin=options.type==='local'?FileOrigin.LOCAL:options.type==='limbo'?FileOrigin.LIMBO:FileOrigin.INPUT;var item=createItem(origin,origin===FileOrigin.INPUT?null:source,options.file);Object.keys(options.metadata||{}).forEach(function(key){item.setMetadata(key,options.metadata[key])});applyFilters('DID_CREATE_ITEM',item,{query:query,dispatch:dispatch});var itemInsertLocation=query('GET_ITEM_INSERT_LOCATION');if(!state.options.itemInsertLocationFreedom){index=itemInsertLocation==='before'?-1:state.items.length}
insertItem(state.items,item,index);if(isFunction(itemInsertLocation)&&source){sortItems(state,itemInsertLocation)}
var id=item.id;item.on('load-init',function(){dispatch('DID_START_ITEM_LOAD',{id:id})});item.on('load-meta',function(){dispatch('DID_UPDATE_ITEM_META',{id:id})});item.on('load-progress',function(progress){dispatch('DID_UPDATE_ITEM_LOAD_PROGRESS',{id:id,progress:progress})});item.on('load-request-error',function(error){var mainStatus=dynamicLabel(state.options.labelFileLoadError)(error);if(error.code>=400&&error.code<500){dispatch('DID_THROW_ITEM_INVALID',{id:id,error:error,status:{main:mainStatus,sub:error.code+' ('+error.body+')'}});failure({error:error,file:createItemAPI(item)});return}
dispatch('DID_THROW_ITEM_LOAD_ERROR',{id:id,error:error,status:{main:mainStatus,sub:state.options.labelTapToRetry}})});item.on('load-file-error',function(error){dispatch('DID_THROW_ITEM_INVALID',{id:id,error:error.status,status:error.status})});item.on('load-abort',function(){dispatch('REMOVE_ITEM',{query:id})});item.on('load-skip',function(){dispatch('COMPLETE_LOAD_ITEM',{query:id,item:item,data:{source:source,success:success}})});item.on('load',function(){var handleAdd=function handleAdd(shouldAdd){if(!shouldAdd){dispatch('REMOVE_ITEM',{query:id});return}
item.on('metadata-update',function(change){dispatch('DID_UPDATE_ITEM_METADATA',{id:id,change:change})});applyFilterChain('SHOULD_PREPARE_OUTPUT',!1,{item:item,query:query}).then(function(shouldPrepareOutput){var loadComplete=function loadComplete(){dispatch('COMPLETE_LOAD_ITEM',{query:id,item:item,data:{source:source,success:success}});listUpdated(dispatch,state)};if(shouldPrepareOutput){dispatch('REQUEST_PREPARE_OUTPUT',{query:id,item:item,ready:function ready(file){dispatch('DID_PREPARE_OUTPUT',{id:id,file:file});loadComplete()}},!0);return}
loadComplete()})};applyFilterChain('DID_LOAD_ITEM',item,{query:query,dispatch:dispatch}).then(function(){optionalPromise(query('GET_BEFORE_ADD_FILE'),createItemAPI(item)).then(handleAdd)}).catch(function(){handleAdd(!1)})});item.on('process-start',function(){dispatch('DID_START_ITEM_PROCESSING',{id:id})});item.on('process-progress',function(progress){dispatch('DID_UPDATE_ITEM_PROCESS_PROGRESS',{id:id,progress:progress})});item.on('process-error',function(error){dispatch('DID_THROW_ITEM_PROCESSING_ERROR',{id:id,error:error,status:{main:dynamicLabel(state.options.labelFileProcessingError)(error),sub:state.options.labelTapToRetry}})});item.on('process-revert-error',function(error){dispatch('DID_THROW_ITEM_PROCESSING_REVERT_ERROR',{id:id,error:error,status:{main:dynamicLabel(state.options.labelFileProcessingRevertError)(error),sub:state.options.labelTapToRetry}})});item.on('process-complete',function(serverFileReference){dispatch('DID_COMPLETE_ITEM_PROCESSING',{id:id,error:null,serverFileReference:serverFileReference})});item.on('process-abort',function(){dispatch('DID_ABORT_ITEM_PROCESSING',{id:id})});item.on('process-revert',function(){dispatch('DID_REVERT_ITEM_PROCESSING',{id:id})});dispatch('DID_ADD_ITEM',{id:id,index:index,interactionMethod:interactionMethod});listUpdated(dispatch,state);var _ref7=state.options.server||{},url=_ref7.url,load=_ref7.load,restore=_ref7.restore,fetch=_ref7.fetch;item.load(source,createFileLoader(origin===FileOrigin.INPUT?isString(source)&&isExternalURL(source)?createFetchFunction(url,fetch):fetchLocal:origin===FileOrigin.LIMBO?createFetchFunction(url,restore):createFetchFunction(url,load)),function(file,success,error){applyFilterChain('LOAD_FILE',file,{query:query}).then(success).catch(error)})},REQUEST_PREPARE_OUTPUT:function REQUEST_PREPARE_OUTPUT(_ref8){var item=_ref8.item,ready=_ref8.ready;if(item.archived)return;applyFilterChain('PREPARE_OUTPUT',item.file,{query:query,item:item}).then(function(result){applyFilterChain('COMPLETE_PREPARE_OUTPUT',result,{query:query,item:item}).then(function(result){if(item.archived)return;ready(result)})})},COMPLETE_LOAD_ITEM:function COMPLETE_LOAD_ITEM(_ref9){var item=_ref9.item,data=_ref9.data;var success=data.success,source=data.source;var itemInsertLocation=query('GET_ITEM_INSERT_LOCATION');if(isFunction(itemInsertLocation)&&source){sortItems(state,itemInsertLocation)}
dispatch('DID_LOAD_ITEM',{id:item.id,error:null,serverFileReference:item.origin===FileOrigin.INPUT?null:source});success(createItemAPI(item));if(item.origin===FileOrigin.LOCAL){dispatch('DID_LOAD_LOCAL_ITEM',{id:item.id});return}
if(item.origin===FileOrigin.LIMBO){dispatch('DID_COMPLETE_ITEM_PROCESSING',{id:item.id,error:null,serverFileReference:source});return}
if(query('IS_ASYNC')&&state.options.instantUpload){dispatch('REQUEST_ITEM_PROCESSING',{query:item.id})}},RETRY_ITEM_LOAD:getItemByQueryFromState(state,function(item){item.retryLoad()}),REQUEST_ITEM_PROCESSING:getItemByQueryFromState(state,function(item,success,failure){var itemCanBeQueuedForProcessing=item.status===ItemStatus.IDLE||item.status===ItemStatus.PROCESSING_ERROR;if(!itemCanBeQueuedForProcessing){var process=function process(){setTimeout(function(){dispatch('REQUEST_ITEM_PROCESSING',{query:item,success:success,failure:failure})},32)};if(item.status===ItemStatus.PROCESSING_COMPLETE||item.status===ItemStatus.PROCESSING_REVERT_ERROR){item.revert(createRevertFunction(state.options.server.url,state.options.server.revert),query('GET_FORCE_REVERT')).then(process).catch(function(){})}else if(item.status===ItemStatus.PROCESSING){item.abortProcessing().then(process)}
return}
if(item.status===ItemStatus.PROCESSING_QUEUED)return;item.requestProcessing();dispatch('DID_REQUEST_ITEM_PROCESSING',{id:item.id});dispatch('PROCESS_ITEM',{query:item,success:success,failure:failure},!0)}),PROCESS_ITEM:getItemByQueryFromState(state,function(item,success,failure){var maxParallelUploads=query('GET_MAX_PARALLEL_UPLOADS');var totalCurrentUploads=query('GET_ITEMS_BY_STATUS',ItemStatus.PROCESSING).length;if(totalCurrentUploads===maxParallelUploads){state.processingQueue.push({id:item.id,success:success,failure:failure});return}
if(item.status===ItemStatus.PROCESSING)return;var processNext=function processNext(){var queueEntry=state.processingQueue.shift();if(!queueEntry)return;var id=queueEntry.id,success=queueEntry.success,failure=queueEntry.failure;var itemReference=getItemByQuery(state.items,id);if(!itemReference||itemReference.archived){processNext();return}
dispatch('PROCESS_ITEM',{query:id,success:success,failure:failure},!0)};item.onOnce('process-complete',function(){success(createItemAPI(item));processNext();var allItemsProcessed=query('GET_ITEMS_BY_STATUS',ItemStatus.PROCESSING_COMPLETE).length===state.items.length;if(allItemsProcessed){dispatch('DID_COMPLETE_ITEM_PROCESSING_ALL')}});item.onOnce('process-error',function(error){failure({error:error,file:createItemAPI(item)});processNext()});item.process(createFileProcessor(createProcessorFunction(state.options.server.url,state.options.server.process,state.options.name)),function(file,success,error){applyFilterChain('PREPARE_OUTPUT',file,{query:query,item:item}).then(function(file){dispatch('DID_PREPARE_OUTPUT',{id:item.id,file:file});success(file)}).catch(error)})}),RETRY_ITEM_PROCESSING:getItemByQueryFromState(state,function(item){dispatch('REQUEST_ITEM_PROCESSING',{query:item})}),REQUEST_REMOVE_ITEM:getItemByQueryFromState(state,function(item){optionalPromise(query('GET_BEFORE_REMOVE_FILE'),createItemAPI(item)).then(function(shouldRemove){if(!shouldRemove){return}
dispatch('REMOVE_ITEM',{query:item})})}),RELEASE_ITEM:getItemByQueryFromState(state,function(item){item.release()}),REMOVE_ITEM:getItemByQueryFromState(state,function(item,success){var removeFromView=function removeFromView(){var id=item.id;getItemById(state.items,id).archive();dispatch('DID_REMOVE_ITEM',{error:null,id:id,item:item});listUpdated(dispatch,state);success(createItemAPI(item))};var server=state.options.server;if(item.origin===FileOrigin.LOCAL&&server&&isFunction(server.remove)){dispatch('DID_START_ITEM_REMOVE',{id:item.id});server.remove(item.source,function(){return removeFromView()},function(status){dispatch('DID_THROW_ITEM_REMOVE_ERROR',{id:item.id,error:createResponse('error',0,status,null),status:{main:dynamicLabel(state.options.labelFileRemoveError)(status),sub:state.options.labelTapToRetry}})})}else{removeFromView()}}),ABORT_ITEM_LOAD:getItemByQueryFromState(state,function(item){item.abortLoad()}),ABORT_ITEM_PROCESSING:getItemByQueryFromState(state,function(item){if(item.serverId){dispatch('REVERT_ITEM_PROCESSING',{id:item.id});return}
item.abortProcessing().then(function(){var shouldRemove=state.options.instantUpload;if(shouldRemove){dispatch('REMOVE_ITEM',{query:item.id})}})}),REQUEST_REVERT_ITEM_PROCESSING:getItemByQueryFromState(state,function(item){if(!state.options.instantUpload){dispatch('REVERT_ITEM_PROCESSING',{query:item});return}
var handleRevert=function handleRevert(shouldRevert){if(!shouldRevert)return;dispatch('REVERT_ITEM_PROCESSING',{query:item})};var fn=query('GET_BEFORE_REMOVE_FILE');if(!fn){return handleRevert(!0)}
var requestRemoveResult=fn(createItemAPI(item));if(requestRemoveResult==null){return handleRevert(!0)}
if(typeof requestRemoveResult==='boolean'){return handleRevert(requestRemoveResult)}
if(typeof requestRemoveResult.then==='function'){requestRemoveResult.then(handleRevert)}}),REVERT_ITEM_PROCESSING:getItemByQueryFromState(state,function(item){item.revert(createRevertFunction(state.options.server.url,state.options.server.revert),query('GET_FORCE_REVERT')).then(function(){var shouldRemove=state.options.instantUpload||isMockItem(item);if(shouldRemove){dispatch('REMOVE_ITEM',{query:item.id})}}).catch(function(){})}),SET_OPTIONS:function SET_OPTIONS(_ref10){var options=_ref10.options;forin(options,function(key,value){dispatch('SET_'+fromCamels(key,'_').toUpperCase(),{value:value})})}}};var formatFilename=function formatFilename(name){return name};var createElement$1=function createElement(tagName){return document.createElement(tagName)};var text=function text(node,value){var textNode=node.childNodes[0];if(!textNode){textNode=document.createTextNode(value);node.appendChild(textNode)}else if(value!==textNode.nodeValue){textNode.nodeValue=value}};var polarToCartesian=function polarToCartesian(centerX,centerY,radius,angleInDegrees){var angleInRadians=(((angleInDegrees%360)-90)*Math.PI)/180.0;return{x:centerX+radius*Math.cos(angleInRadians),y:centerY+radius*Math.sin(angleInRadians)}};var describeArc=function describeArc(x,y,radius,startAngle,endAngle,arcSweep){var start=polarToCartesian(x,y,radius,endAngle);var end=polarToCartesian(x,y,radius,startAngle);return['M',start.x,start.y,'A',radius,radius,0,arcSweep,0,end.x,end.y].join(' ')};var percentageArc=function percentageArc(x,y,radius,from,to){var arcSweep=1;if(to>from&&to-from<=0.5){arcSweep=0}
if(from>to&&from-to>=0.5){arcSweep=0}
return describeArc(x,y,radius,Math.min(0.9999,from)*360,Math.min(0.9999,to)*360,arcSweep)};var create=function create(_ref){var root=_ref.root,props=_ref.props;props.spin=!1;props.progress=0;props.opacity=0;var svg=createElement('svg');root.ref.path=createElement('path',{'stroke-width':2,'stroke-linecap':'round'});svg.appendChild(root.ref.path);root.ref.svg=svg;root.appendChild(svg)};var write=function write(_ref2){var root=_ref2.root,props=_ref2.props;if(props.opacity===0){return}
if(props.align){root.element.dataset.align=props.align}
var ringStrokeWidth=parseInt(attr(root.ref.path,'stroke-width'),10);var size=root.rect.element.width*0.5;var ringFrom=0;var ringTo=0;if(props.spin){ringFrom=0;ringTo=0.5}else{ringFrom=0;ringTo=props.progress}
var coordinates=percentageArc(size,size,size-ringStrokeWidth,ringFrom,ringTo);attr(root.ref.path,'d',coordinates);attr(root.ref.path,'stroke-opacity',props.spin||props.progress>0?1:0)};var progressIndicator=createView({tag:'div',name:'progress-indicator',ignoreRectUpdate:!0,ignoreRect:!0,create:create,write:write,mixins:{apis:['progress','spin','align'],styles:['opacity'],animations:{opacity:{type:'tween',duration:500},progress:{type:'spring',stiffness:0.95,damping:0.65,mass:10}}}});var create$1=function create(_ref){var root=_ref.root,props=_ref.props;root.element.innerHTML=(props.icon||'')+('<span>'+props.label+'</span>');props.isDisabled=!1};var write$1=function write(_ref2){var root=_ref2.root,props=_ref2.props;var isDisabled=props.isDisabled;var shouldDisable=root.query('GET_DISABLED')||props.opacity===0;if(shouldDisable&&!isDisabled){props.isDisabled=!0;attr(root.element,'disabled','disabled')}else if(!shouldDisable&&isDisabled){props.isDisabled=!1;root.element.removeAttribute('disabled')}};var fileActionButton=createView({tag:'button',attributes:{type:'button'},ignoreRect:!0,ignoreRectUpdate:!0,name:'file-action-button',mixins:{apis:['label'],styles:['translateX','translateY','scaleX','scaleY','opacity'],animations:{scaleX:'spring',scaleY:'spring',translateX:'spring',translateY:'spring',opacity:{type:'tween',duration:250}},listeners:!0},create:create$1,write:write$1});var toNaturalFileSize=function toNaturalFileSize(bytes){var decimalSeparator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'.';bytes=Math.round(Math.abs(bytes));if(bytes<1000){return bytes+' bytes'}
if(bytes<MB){return Math.floor(bytes/KB)+' KB'}
if(bytes<GB){return removeDecimalsWhenZero(bytes/MB,1,decimalSeparator)+' MB'}
return removeDecimalsWhenZero(bytes/GB,2,decimalSeparator)+' GB'};var KB=1000;var MB=1000000;var GB=1000000000;var removeDecimalsWhenZero=function removeDecimalsWhenZero(value,decimalCount,separator){return value.toFixed(decimalCount).split('.').filter(function(part){return part!=='0'}).join(separator)};var create$2=function create(_ref){var root=_ref.root,props=_ref.props;var fileName=createElement$1('span');fileName.className='filepond--file-info-main';attr(fileName,'aria-hidden','true');root.appendChild(fileName);root.ref.fileName=fileName;var fileSize=createElement$1('span');fileSize.className='filepond--file-info-sub';root.appendChild(fileSize);root.ref.fileSize=fileSize;text(fileSize,root.query('GET_LABEL_FILE_WAITING_FOR_SIZE'));text(fileName,formatFilename(root.query('GET_ITEM_NAME',props.id)))};var updateFile=function updateFile(_ref2){var root=_ref2.root,props=_ref2.props;text(root.ref.fileSize,toNaturalFileSize(root.query('GET_ITEM_SIZE',props.id)));text(root.ref.fileName,formatFilename(root.query('GET_ITEM_NAME',props.id)))};var updateFileSizeOnError=function updateFileSizeOnError(_ref3){var root=_ref3.root,props=_ref3.props;if(isInt(root.query('GET_ITEM_SIZE',props.id))){return}
text(root.ref.fileSize,root.query('GET_LABEL_FILE_SIZE_NOT_AVAILABLE'))};var fileInfo=createView({name:'file-info',ignoreRect:!0,ignoreRectUpdate:!0,write:createRoute({DID_LOAD_ITEM:updateFile,DID_UPDATE_ITEM_META:updateFile,DID_THROW_ITEM_LOAD_ERROR:updateFileSizeOnError,DID_THROW_ITEM_INVALID:updateFileSizeOnError}),didCreateView:function didCreateView(root){applyFilters('CREATE_VIEW',Object.assign({},root,{view:root}))},create:create$2,mixins:{styles:['translateX','translateY'],animations:{translateX:'spring',translateY:'spring'}}});var toPercentage=function toPercentage(value){return Math.round(value*100)};var create$3=function create(_ref){var root=_ref.root,props=_ref.props;var main=createElement$1('span');main.className='filepond--file-status-main';root.appendChild(main);root.ref.main=main;var sub=createElement$1('span');sub.className='filepond--file-status-sub';root.appendChild(sub);root.ref.sub=sub;didSetItemLoadProgress({root:root,action:{progress:null}})};var didSetItemLoadProgress=function didSetItemLoadProgress(_ref2){var root=_ref2.root,action=_ref2.action;var title=action.progress===null?root.query('GET_LABEL_FILE_LOADING'):root.query('GET_LABEL_FILE_LOADING')+' '+toPercentage(action.progress)+'%';text(root.ref.main,title);text(root.ref.sub,root.query('GET_LABEL_TAP_TO_CANCEL'))};var didSetItemProcessProgress=function didSetItemProcessProgress(_ref3){var root=_ref3.root,action=_ref3.action;var title=action.progress===null?root.query('GET_LABEL_FILE_PROCESSING'):root.query('GET_LABEL_FILE_PROCESSING')+' '+toPercentage(action.progress)+'%';text(root.ref.main,title);text(root.ref.sub,root.query('GET_LABEL_TAP_TO_CANCEL'))};var didRequestItemProcessing=function didRequestItemProcessing(_ref4){var root=_ref4.root;text(root.ref.main,root.query('GET_LABEL_FILE_PROCESSING'));text(root.ref.sub,root.query('GET_LABEL_TAP_TO_CANCEL'))};var didAbortItemProcessing=function didAbortItemProcessing(_ref5){var root=_ref5.root;text(root.ref.main,root.query('GET_LABEL_FILE_PROCESSING_ABORTED'));text(root.ref.sub,root.query('GET_LABEL_TAP_TO_RETRY'))};var didCompleteItemProcessing=function didCompleteItemProcessing(_ref6){var root=_ref6.root;text(root.ref.main,root.query('GET_LABEL_FILE_PROCESSING_COMPLETE'));text(root.ref.sub,root.query('GET_LABEL_TAP_TO_UNDO'))};var clear=function clear(_ref7){var root=_ref7.root;text(root.ref.main,'');text(root.ref.sub,'')};var error=function error(_ref8){var root=_ref8.root,action=_ref8.action;text(root.ref.main,action.status.main);text(root.ref.sub,action.status.sub)};var fileStatus=createView({name:'file-status',ignoreRect:!0,ignoreRectUpdate:!0,write:createRoute({DID_LOAD_ITEM:clear,DID_REVERT_ITEM_PROCESSING:clear,DID_REQUEST_ITEM_PROCESSING:didRequestItemProcessing,DID_ABORT_ITEM_PROCESSING:didAbortItemProcessing,DID_COMPLETE_ITEM_PROCESSING:didCompleteItemProcessing,DID_UPDATE_ITEM_PROCESS_PROGRESS:didSetItemProcessProgress,DID_UPDATE_ITEM_LOAD_PROGRESS:didSetItemLoadProgress,DID_THROW_ITEM_LOAD_ERROR:error,DID_THROW_ITEM_INVALID:error,DID_THROW_ITEM_PROCESSING_ERROR:error,DID_THROW_ITEM_PROCESSING_REVERT_ERROR:error,DID_THROW_ITEM_REMOVE_ERROR:error}),didCreateView:function didCreateView(root){applyFilters('CREATE_VIEW',Object.assign({},root,{view:root}))},create:create$3,mixins:{styles:['translateX','translateY','opacity'],animations:{opacity:{type:'tween',duration:250},translateX:'spring',translateY:'spring'}}});var Buttons={AbortItemLoad:{label:'GET_LABEL_BUTTON_ABORT_ITEM_LOAD',action:'ABORT_ITEM_LOAD',className:'filepond--action-abort-item-load',align:'LOAD_INDICATOR_POSITION'},RetryItemLoad:{label:'GET_LABEL_BUTTON_RETRY_ITEM_LOAD',action:'RETRY_ITEM_LOAD',icon:'GET_ICON_RETRY',className:'filepond--action-retry-item-load',align:'BUTTON_PROCESS_ITEM_POSITION'},RemoveItem:{label:'GET_LABEL_BUTTON_REMOVE_ITEM',action:'REQUEST_REMOVE_ITEM',icon:'GET_ICON_REMOVE',className:'filepond--action-remove-item',align:'BUTTON_REMOVE_ITEM_POSITION'},ProcessItem:{label:'GET_LABEL_BUTTON_PROCESS_ITEM',action:'REQUEST_ITEM_PROCESSING',icon:'GET_ICON_PROCESS',className:'filepond--action-process-item',align:'BUTTON_PROCESS_ITEM_POSITION'},AbortItemProcessing:{label:'GET_LABEL_BUTTON_ABORT_ITEM_PROCESSING',action:'ABORT_ITEM_PROCESSING',className:'filepond--action-abort-item-processing',align:'BUTTON_PROCESS_ITEM_POSITION'},RetryItemProcessing:{label:'GET_LABEL_BUTTON_RETRY_ITEM_PROCESSING',action:'RETRY_ITEM_PROCESSING',icon:'GET_ICON_RETRY',className:'filepond--action-retry-item-processing',align:'BUTTON_PROCESS_ITEM_POSITION'},RevertItemProcessing:{label:'GET_LABEL_BUTTON_UNDO_ITEM_PROCESSING',action:'REQUEST_REVERT_ITEM_PROCESSING',icon:'GET_ICON_UNDO',className:'filepond--action-revert-item-processing',align:'BUTTON_PROCESS_ITEM_POSITION'}};var ButtonKeys=[];forin(Buttons,function(key){ButtonKeys.push(key)});var calculateFileInfoOffset=function calculateFileInfoOffset(root){var buttonRect=root.ref.buttonRemoveItem.rect.element;return buttonRect.hidden?null:buttonRect.width+buttonRect.left};var calculateFileVerticalCenterOffset=function calculateFileVerticalCenterOffset(root){return Math.floor(root.ref.buttonRemoveItem.rect.element.height/4)};var calculateFileHorizontalCenterOffset=function calculateFileHorizontalCenterOffset(root){return Math.floor(root.ref.buttonRemoveItem.rect.element.left/2)};var getLoadIndicatorAlignment=function getLoadIndicatorAlignment(root){return root.query('GET_STYLE_LOAD_INDICATOR_POSITION')};var getProcessIndicatorAlignment=function getProcessIndicatorAlignment(root){return root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION')};var getRemoveIndicatorAligment=function getRemoveIndicatorAligment(root){return root.query('GET_STYLE_BUTTON_REMOVE_ITEM_POSITION')};var DefaultStyle={buttonAbortItemLoad:{opacity:0},buttonRetryItemLoad:{opacity:0},buttonRemoveItem:{opacity:0},buttonProcessItem:{opacity:0},buttonAbortItemProcessing:{opacity:0},buttonRetryItemProcessing:{opacity:0},buttonRevertItemProcessing:{opacity:0},loadProgressIndicator:{opacity:0,align:getLoadIndicatorAlignment},processProgressIndicator:{opacity:0,align:getProcessIndicatorAlignment},processingCompleteIndicator:{opacity:0,scaleX:0.75,scaleY:0.75},info:{translateX:0,translateY:0,opacity:0},status:{translateX:0,translateY:0,opacity:0}};var IdleStyle={buttonRemoveItem:{opacity:1},buttonProcessItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{translateX:calculateFileInfoOffset}};var ProcessingStyle={buttonAbortItemProcessing:{opacity:1},processProgressIndicator:{opacity:1},status:{opacity:1}};var StyleMap={DID_THROW_ITEM_INVALID:{buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{translateX:calculateFileInfoOffset,opacity:1}},DID_START_ITEM_LOAD:{buttonAbortItemLoad:{opacity:1},loadProgressIndicator:{opacity:1},status:{opacity:1}},DID_THROW_ITEM_LOAD_ERROR:{buttonRetryItemLoad:{opacity:1},buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{opacity:1}},DID_START_ITEM_REMOVE:{processProgressIndicator:{opacity:1,align:getRemoveIndicatorAligment},info:{translateX:calculateFileInfoOffset},status:{opacity:0}},DID_THROW_ITEM_REMOVE_ERROR:{processProgressIndicator:{opacity:0,align:getRemoveIndicatorAligment},buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{opacity:1,translateX:calculateFileInfoOffset}},DID_LOAD_ITEM:IdleStyle,DID_LOAD_LOCAL_ITEM:{buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{translateX:calculateFileInfoOffset}},DID_START_ITEM_PROCESSING:ProcessingStyle,DID_REQUEST_ITEM_PROCESSING:ProcessingStyle,DID_UPDATE_ITEM_PROCESS_PROGRESS:ProcessingStyle,DID_COMPLETE_ITEM_PROCESSING:{buttonRevertItemProcessing:{opacity:1},info:{opacity:1},status:{opacity:1}},DID_THROW_ITEM_PROCESSING_ERROR:{buttonRemoveItem:{opacity:1},buttonRetryItemProcessing:{opacity:1},status:{opacity:1},info:{translateX:calculateFileInfoOffset}},DID_THROW_ITEM_PROCESSING_REVERT_ERROR:{buttonRevertItemProcessing:{opacity:1},status:{opacity:1},info:{opacity:1}},DID_ABORT_ITEM_PROCESSING:{buttonRemoveItem:{opacity:1},buttonProcessItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{opacity:1}},DID_REVERT_ITEM_PROCESSING:IdleStyle};var processingCompleteIndicatorView=createView({create:function create(_ref){var root=_ref.root;root.element.innerHTML=root.query('GET_ICON_DONE')},name:'processing-complete-indicator',ignoreRect:!0,mixins:{styles:['scaleX','scaleY','opacity'],animations:{scaleX:'spring',scaleY:'spring',opacity:{type:'tween',duration:250}}}});var create$4=function create(_ref2){var root=_ref2.root,props=_ref2.props;var id=props.id;var allowRevert=root.query('GET_ALLOW_REVERT');var instantUpload=root.query('GET_INSTANT_UPLOAD');var isAsync=root.query('IS_ASYNC');var enabledButtons=isAsync?ButtonKeys.concat():ButtonKeys.filter(function(key){return!/Process/.test(key)});if(isAsync&&!allowRevert){enabledButtons.splice(-1,1);var map=StyleMap.DID_COMPLETE_ITEM_PROCESSING;map.info.translateX=calculateFileHorizontalCenterOffset;map.info.translateY=calculateFileVerticalCenterOffset;map.status.translateY=calculateFileVerticalCenterOffset;map.processingCompleteIndicator={opacity:1,scaleX:1,scaleY:1}}
if(instantUpload&&allowRevert){Buttons.RevertItemProcessing.label='GET_LABEL_BUTTON_REMOVE_ITEM';Buttons.RevertItemProcessing.icon='GET_ICON_REMOVE'}
forin(Buttons,function(key,definition){var buttonView=root.createChildView(fileActionButton,{label:root.query(definition.label),icon:root.query(definition.icon),opacity:0});if(enabledButtons.includes(key)){root.appendChildView(buttonView)}
buttonView.element.dataset.align=root.query('GET_STYLE_'+definition.align);buttonView.element.classList.add(definition.className);buttonView.on('click',function(e){e.stopPropagation();root.dispatch(definition.action,{query:id})});root.ref['button'+key]=buttonView});root.ref.info=root.appendChildView(root.createChildView(fileInfo,{id:id}));root.ref.status=root.appendChildView(root.createChildView(fileStatus,{id:id}));root.ref.processingCompleteIndicator=root.appendChildView(root.createChildView(processingCompleteIndicatorView));root.ref.processingCompleteIndicator.element.dataset.align=root.query('GET_STYLE_BUTTON_PROCESS_ITEM_POSITION');var loadIndicatorView=root.appendChildView(root.createChildView(progressIndicator,{opacity:0,align:root.query('GET_STYLE_LOAD_INDICATOR_POSITION')}));loadIndicatorView.element.classList.add('filepond--load-indicator');root.ref.loadProgressIndicator=loadIndicatorView;var progressIndicatorView=root.appendChildView(root.createChildView(progressIndicator,{opacity:0,align:root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION')}));progressIndicatorView.element.classList.add('filepond--process-indicator');root.ref.processProgressIndicator=progressIndicatorView;root.ref.activeStyles=[]};var write$2=function write(_ref3){var root=_ref3.root,actions=_ref3.actions,props=_ref3.props;route({root:root,actions:actions,props:props});var action=actions.concat().filter(function(action){return/^DID_/.test(action.type)}).reverse().find(function(action){return StyleMap[action.type]});if(action){root.ref.activeStyles=[];var stylesToApply=StyleMap[action.type];forin(DefaultStyle,function(name,defaultStyles){var control=root.ref[name];forin(defaultStyles,function(key,defaultValue){var value=stylesToApply[name]&&typeof stylesToApply[name][key]!=='undefined'?stylesToApply[name][key]:defaultValue;root.ref.activeStyles.push({control:control,key:key,value:value})})})}
root.ref.activeStyles.forEach(function(_ref4){var control=_ref4.control,key=_ref4.key,value=_ref4.value;control[key]=typeof value==='function'?value(root):value})};var route=createRoute({DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING:function DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING(_ref5){var root=_ref5.root,action=_ref5.action;root.ref.buttonAbortItemProcessing.label=action.value},DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD:function DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD(_ref6){var root=_ref6.root,action=_ref6.action;root.ref.buttonAbortItemLoad.label=action.value},DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL:function DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL(_ref7){var root=_ref7.root,action=_ref7.action;root.ref.buttonAbortItemRemoval.label=action.value},DID_REQUEST_ITEM_PROCESSING:function DID_REQUEST_ITEM_PROCESSING(_ref8){var root=_ref8.root;root.ref.processProgressIndicator.spin=!0;root.ref.processProgressIndicator.progress=0},DID_START_ITEM_LOAD:function DID_START_ITEM_LOAD(_ref9){var root=_ref9.root;root.ref.loadProgressIndicator.spin=!0;root.ref.loadProgressIndicator.progress=0},DID_START_ITEM_REMOVE:function DID_START_ITEM_REMOVE(_ref10){var root=_ref10.root;root.ref.processProgressIndicator.spin=!0;root.ref.processProgressIndicator.progress=0},DID_UPDATE_ITEM_LOAD_PROGRESS:function DID_UPDATE_ITEM_LOAD_PROGRESS(_ref11){var root=_ref11.root,action=_ref11.action;root.ref.loadProgressIndicator.spin=!1;root.ref.loadProgressIndicator.progress=action.progress},DID_UPDATE_ITEM_PROCESS_PROGRESS:function DID_UPDATE_ITEM_PROCESS_PROGRESS(_ref12){var root=_ref12.root,action=_ref12.action;root.ref.processProgressIndicator.spin=!1;root.ref.processProgressIndicator.progress=action.progress}});var file=createView({create:create$4,write:write$2,didCreateView:function didCreateView(root){applyFilters('CREATE_VIEW',Object.assign({},root,{view:root}))},name:'file'});var create$5=function create(_ref){var root=_ref.root,props=_ref.props;root.ref.fileName=createElement$1('legend');root.appendChild(root.ref.fileName);root.ref.file=root.appendChildView(root.createChildView(file,{id:props.id}));var dataContainer=createElement$1('input');dataContainer.type='hidden';dataContainer.name=root.query('GET_NAME');dataContainer.disabled=root.query('GET_DISABLED');root.ref.data=dataContainer;root.appendChild(dataContainer)};var didSetDisabled=function didSetDisabled(_ref2){var root=_ref2.root;root.ref.data.disabled=root.query('GET_DISABLED')};var didLoadItem=function didLoadItem(_ref3){var root=_ref3.root,action=_ref3.action,props=_ref3.props;root.ref.data.value=action.serverFileReference;text(root.ref.fileName,formatFilename(root.query('GET_ITEM_NAME',props.id)))};var didRemoveItem=function didRemoveItem(_ref4){var root=_ref4.root;root.ref.data.removeAttribute('value')};var didCompleteItemProcessing$1=function didCompleteItemProcessing(_ref5){var root=_ref5.root,action=_ref5.action;root.ref.data.value=action.serverFileReference};var didRevertItemProcessing=function didRevertItemProcessing(_ref6){var root=_ref6.root;root.ref.data.removeAttribute('value')};var fileWrapper=createView({create:create$5,ignoreRect:!0,write:createRoute({DID_SET_DISABLED:didSetDisabled,DID_LOAD_ITEM:didLoadItem,DID_REMOVE_ITEM:didRemoveItem,DID_COMPLETE_ITEM_PROCESSING:didCompleteItemProcessing$1,DID_REVERT_ITEM_PROCESSING:didRevertItemProcessing}),didCreateView:function didCreateView(root){applyFilters('CREATE_VIEW',Object.assign({},root,{view:root}))},tag:'fieldset',name:'file-wrapper'});var PANEL_SPRING_PROPS={type:'spring',damping:0.6,mass:7};var create$6=function create(_ref){var root=_ref.root,props=_ref.props;[{name:'top'},{name:'center',props:{translateY:null,scaleY:null},mixins:{animations:{scaleY:PANEL_SPRING_PROPS},styles:['translateY','scaleY']}},{name:'bottom',props:{translateY:null},mixins:{animations:{translateY:PANEL_SPRING_PROPS},styles:['translateY']}}].forEach(function(section){createSection(root,section,props.name)});root.element.classList.add('filepond--'+props.name);root.ref.scalable=null};var createSection=function createSection(root,section,className){var viewConstructor=createView({name:'panel-'+section.name+' filepond--'+className,mixins:section.mixins,ignoreRectUpdate:!0});var view=root.createChildView(viewConstructor,section.props);root.ref[section.name]=root.appendChildView(view)};var write$3=function write(_ref2){var root=_ref2.root,props=_ref2.props;if(root.ref.scalable===null||props.scalable!==root.ref.scalable){root.ref.scalable=isBoolean(props.scalable)?props.scalable:!0;root.element.dataset.scalable=root.ref.scalable}
if(!props.height)return;var topRect=root.ref.top.rect.element;var bottomRect=root.ref.bottom.rect.element;var height=Math.max(topRect.height+bottomRect.height,props.height);root.ref.center.translateY=topRect.height;root.ref.center.scaleY=(height-topRect.height-bottomRect.height)/100;root.ref.bottom.translateY=height-bottomRect.height};var panel=createView({name:'panel',write:write$3,create:create$6,ignoreRect:!0,mixins:{apis:['height','scalable']}});var ITEM_TRANSLATE_SPRING={type:'spring',stiffness:0.75,damping:0.45,mass:10};var ITEM_SCALE_SPRING='spring';var create$7=function create(_ref){var root=_ref.root,props=_ref.props;root.ref.handleClick=function(){return root.dispatch('DID_ACTIVATE_ITEM',{id:props.id})};root.element.id='filepond--item-'+props.id;root.element.addEventListener('click',root.ref.handleClick);root.ref.container=root.appendChildView(root.createChildView(fileWrapper,{id:props.id}));root.ref.panel=root.appendChildView(root.createChildView(panel,{name:'item-panel'}));root.ref.panel.height=null;props.markedForRemoval=!1};var StateMap={DID_START_ITEM_LOAD:'busy',DID_UPDATE_ITEM_LOAD_PROGRESS:'loading',DID_THROW_ITEM_INVALID:'load-invalid',DID_THROW_ITEM_LOAD_ERROR:'load-error',DID_LOAD_ITEM:'idle',DID_THROW_ITEM_REMOVE_ERROR:'remove-error',DID_START_ITEM_REMOVE:'busy',DID_START_ITEM_PROCESSING:'busy',DID_REQUEST_ITEM_PROCESSING:'busy',DID_UPDATE_ITEM_PROCESS_PROGRESS:'processing',DID_COMPLETE_ITEM_PROCESSING:'processing-complete',DID_THROW_ITEM_PROCESSING_ERROR:'processing-error',DID_THROW_ITEM_PROCESSING_REVERT_ERROR:'processing-revert-error',DID_ABORT_ITEM_PROCESSING:'cancelled',DID_REVERT_ITEM_PROCESSING:'idle'};var route$1=createRoute({DID_UPDATE_PANEL_HEIGHT:function DID_UPDATE_PANEL_HEIGHT(_ref2){var root=_ref2.root,action=_ref2.action;var height=action.height;root.height=height}});var write$4=function write(_ref3){var root=_ref3.root,actions=_ref3.actions,props=_ref3.props,shouldOptimize=_ref3.shouldOptimize;var action=actions.concat().filter(function(action){return/^DID_/.test(action.type)}).reverse().find(function(action){return StateMap[action.type]});if(action&&action.type!==props.currentState){props.currentState=action.type;root.element.dataset.filepondItemState=StateMap[props.currentState]||''}
var aspectRatio=root.query('GET_ITEM_PANEL_ASPECT_RATIO')||root.query('GET_PANEL_ASPECT_RATIO');if(!aspectRatio){route$1({root:root,actions:actions,props:props});if(!root.height&&root.ref.container.rect.element.height>0){root.height=root.ref.container.rect.element.height}}else if(!shouldOptimize){root.height=root.rect.element.width*aspectRatio}
if(shouldOptimize){root.ref.panel.height=null}
root.ref.panel.height=root.height};var item=createView({create:create$7,write:write$4,destroy:function destroy(_ref4){var root=_ref4.root,props=_ref4.props;root.element.removeEventListener('click',root.ref.handleClick);root.dispatch('RELEASE_ITEM',{query:props.id})},tag:'li',name:'item',mixins:{apis:['id','interactionMethod','markedForRemoval','spawnDate'],styles:['translateX','translateY','scaleX','scaleY','opacity','height'],animations:{scaleX:ITEM_SCALE_SPRING,scaleY:ITEM_SCALE_SPRING,translateX:ITEM_TRANSLATE_SPRING,translateY:ITEM_TRANSLATE_SPRING,opacity:{type:'tween',duration:150}}}});var getItemIndexByPosition=function getItemIndexByPosition(view,positionInView){if(!positionInView)return;var horizontalSpace=view.rect.element.width;var children=view.childViews;var l=children.length;var last=null;if(l===0||positionInView.top<children[0].rect.element.top)return-1;var item=children[0];var itemRect=item.rect.element;var itemHorizontalMargin=itemRect.marginLeft+itemRect.marginRight;var itemWidth=itemRect.width+itemHorizontalMargin;var itemsPerRow=Math.round(horizontalSpace/itemWidth);if(itemsPerRow===1){for(var index=0;index<l;index++){var child=children[index];var childMid=child.rect.outer.top+child.rect.element.height*0.5;if(positionInView.top<childMid){return index}}
return l}
var itemVerticalMargin=itemRect.marginTop+itemRect.marginBottom;var itemHeight=itemRect.height+itemVerticalMargin;for(var _index=0;_index<l;_index++){var indexX=_index%itemsPerRow;var indexY=Math.floor(_index/itemsPerRow);var offsetX=indexX*itemWidth;var offsetY=indexY*itemHeight;var itemTop=offsetY-itemRect.marginTop;var itemRight=offsetX+itemWidth;var itemBottom=offsetY+itemHeight+itemRect.marginBottom;if(positionInView.top<itemBottom&&positionInView.top>itemTop){if(positionInView.left<itemRight){return _index}else if(_index!==l-1){last=_index}else{last=null}}}
if(last!==null){return last}
return l};var create$8=function create(_ref){var root=_ref.root;attr(root.element,'role','list');root.ref.lastItemSpanwDate=Date.now()};var addItemView=function addItemView(_ref2){var root=_ref2.root,action=_ref2.action;var id=action.id,index=action.index,interactionMethod=action.interactionMethod;root.ref.addIndex=index;var now=Date.now();var spawnDate=now;var opacity=1;if(interactionMethod!==InteractionMethod.NONE){opacity=0;var cooldown=root.query('GET_ITEM_INSERT_INTERVAL');var dist=now-root.ref.lastItemSpanwDate;spawnDate=dist<cooldown?now+(cooldown-dist):now}
root.ref.lastItemSpanwDate=spawnDate;root.appendChildView(root.createChildView(item,{spawnDate:spawnDate,id:id,opacity:opacity,interactionMethod:interactionMethod}),index)};var moveItem=function moveItem(item,x,y){var vx=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var vy=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;item.translateX=x;item.translateY=y;if(Date.now()>item.spawnDate){if(item.opacity===0){introItemView(item,x,y,vx,vy)}
item.scaleX=1;item.scaleY=1;item.opacity=1}};var introItemView=function introItemView(item,x,y,vx,vy){if(item.interactionMethod===InteractionMethod.NONE){item.translateX=null;item.translateX=x;item.translateY=null;item.translateY=y}else if(item.interactionMethod===InteractionMethod.DROP){item.translateX=null;item.translateX=x-vx*20;item.translateY=null;item.translateY=y-vy*10;item.scaleX=0.8;item.scaleY=0.8}else if(item.interactionMethod===InteractionMethod.BROWSE){item.translateY=null;item.translateY=y-30}else if(item.interactionMethod===InteractionMethod.API){item.translateX=null;item.translateX=x-30;item.translateY=null}};var removeItemView=function removeItemView(_ref3){var root=_ref3.root,action=_ref3.action;var id=action.id;var view=root.childViews.find(function(child){return child.id===id});if(!view){return}
view.scaleX=0.9;view.scaleY=0.9;view.opacity=0;view.markedForRemoval=!0};var route$2=createRoute({DID_ADD_ITEM:addItemView,DID_REMOVE_ITEM:removeItemView});var write$5=function write(_ref4){var root=_ref4.root,props=_ref4.props,actions=_ref4.actions,shouldOptimize=_ref4.shouldOptimize;route$2({root:root,props:props,actions:actions});var dragCoordinates=props.dragCoordinates;var dragIndex=dragCoordinates?getItemIndexByPosition(root,dragCoordinates):null;var horizontalSpace=root.rect.element.width;var visibleChildren=root.childViews.filter(function(child){return child.rect.element.height});var children=root.query('GET_ACTIVE_ITEMS').map(function(item){return visibleChildren.find(function(child){return child.id===item.id})}).filter(function(item){return item});var addIndex=root.ref.addIndex||null;root.ref.addIndex=null;var dragIndexOffset=0;var removeIndexOffset=0;var addIndexOffset=0;if(children.length===0)return;var childRect=children[0].rect.element;var itemVerticalMargin=childRect.marginTop+childRect.marginBottom;var itemHorizontalMargin=childRect.marginLeft+childRect.marginRight;var itemWidth=childRect.width+itemHorizontalMargin;var itemHeight=childRect.height+itemVerticalMargin;var itemsPerRow=Math.round(horizontalSpace/itemWidth);if(itemsPerRow===1){var offsetY=0;var dragOffset=0;children.forEach(function(child,index){if(dragIndex){var dist=index-dragIndex;if(dist===-2){dragOffset=-itemVerticalMargin*0.25}else if(dist===-1){dragOffset=-itemVerticalMargin*0.75}else if(dist===0){dragOffset=itemVerticalMargin*0.75}else if(dist===1){dragOffset=itemVerticalMargin*0.25}else{dragOffset=0}}
if(shouldOptimize){child.translateX=null;child.translateY=null}
if(!child.markedForRemoval){moveItem(child,0,offsetY+dragOffset)}
var itemHeight=child.rect.element.height+itemVerticalMargin;var visualHeight=itemHeight*(child.markedForRemoval?child.opacity:1);offsetY+=visualHeight})}
else{var prevX=0;var prevY=0;children.forEach(function(child,index){if(index===dragIndex){dragIndexOffset=1}
if(index===addIndex){addIndexOffset+=1}
if(child.markedForRemoval&&child.opacity<0.5){removeIndexOffset-=1}
var visualIndex=index+addIndexOffset+dragIndexOffset+removeIndexOffset;var indexX=visualIndex%itemsPerRow;var indexY=Math.floor(visualIndex/itemsPerRow);var offsetX=indexX*itemWidth;var offsetY=indexY*itemHeight;var vectorX=Math.sign(offsetX-prevX);var vectorY=Math.sign(offsetY-prevY);prevX=offsetX;prevY=offsetY;if(child.markedForRemoval)return;if(shouldOptimize){child.translateX=null;child.translateY=null}
moveItem(child,offsetX,offsetY,vectorX,vectorY)})}};var filterSetItemActions=function filterSetItemActions(child,actions){return actions.filter(function(action){if(action.data&&action.data.id){return child.id===action.data.id}
return!0})};var list=createView({create:create$8,write:write$5,tag:'ul',name:'list',didWriteView:function didWriteView(_ref5){var root=_ref5.root;root.childViews.filter(function(view){return view.markedForRemoval&&view.opacity===0&&view.resting}).forEach(function(view){view._destroy();root.removeChildView(view)})},filterFrameActionsForChild:filterSetItemActions,mixins:{apis:['dragCoordinates']}});var create$9=function create(_ref){var root=_ref.root,props=_ref.props;root.ref.list=root.appendChildView(root.createChildView(list));props.dragCoordinates=null;props.overflowing=!1};var storeDragCoordinates=function storeDragCoordinates(_ref2){var root=_ref2.root,props=_ref2.props,action=_ref2.action;if(!root.query('GET_ITEM_INSERT_LOCATION_FREEDOM'))return;props.dragCoordinates={left:action.position.scopeLeft-root.ref.list.rect.element.left,top:action.position.scopeTop-(root.rect.outer.top+root.rect.element.marginTop+root.rect.element.scrollTop)}};var clearDragCoordinates=function clearDragCoordinates(_ref3){var props=_ref3.props;props.dragCoordinates=null};var route$3=createRoute({DID_DRAG:storeDragCoordinates,DID_END_DRAG:clearDragCoordinates});var write$6=function write(_ref4){var root=_ref4.root,props=_ref4.props,actions=_ref4.actions;route$3({root:root,props:props,actions:actions});root.ref.list.dragCoordinates=props.dragCoordinates;if(props.overflowing&&!props.overflow){props.overflowing=!1;root.element.dataset.state='';root.height=null}
if(props.overflow){var newHeight=Math.round(props.overflow);if(newHeight!==root.height){props.overflowing=!0;root.element.dataset.state='overflow';root.height=newHeight}}};var listScroller=createView({create:create$9,write:write$6,name:'list-scroller',mixins:{apis:['overflow','dragCoordinates'],styles:['height','translateY'],animations:{translateY:'spring'}}});var attrToggle=function attrToggle(element,name,state){var enabledValue=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'';if(state){attr(element,name,enabledValue)}else{element.removeAttribute(name)}};var resetFileInput=function resetFileInput(input){if(!input||input.value===''){return}
try{input.value=''}catch(err){}
if(input.value){var form=createElement$1('form');var parentNode=input.parentNode;var ref=input.nextSibling;form.appendChild(input);form.reset();if(ref){parentNode.insertBefore(input,ref)}else{parentNode.appendChild(input)}}};var create$a=function create(_ref){var root=_ref.root,props=_ref.props;root.element.id='filepond--browser-'+props.id;attr(root.element,'name',root.query('GET_NAME'));attr(root.element,'aria-controls','filepond--assistant-'+props.id);attr(root.element,'aria-labelledby','filepond--drop-label-'+props.id);root.ref.handleChange=function(e){if(!root.element.value){return}
var files=Array.from(root.element.files);setTimeout(function(){props.onload(files);resetFileInput(root.element)},250)};root.element.addEventListener('change',root.ref.handleChange)};var setAcceptedFileTypes=function setAcceptedFileTypes(_ref2){var root=_ref2.root,action=_ref2.action;attrToggle(root.element,'accept',!!action.value,action.value?action.value.join(','):'')};var toggleAllowMultiple=function toggleAllowMultiple(_ref3){var root=_ref3.root,action=_ref3.action;attrToggle(root.element,'multiple',action.value)};var toggleDisabled=function toggleDisabled(_ref4){var root=_ref4.root,action=_ref4.action;var isDisabled=root.query('GET_DISABLED');var doesAllowBrowse=root.query('GET_ALLOW_BROWSE');var disableField=isDisabled||!doesAllowBrowse;attrToggle(root.element,'disabled',disableField)};var toggleRequired=function toggleRequired(_ref5){var root=_ref5.root,action=_ref5.action;if(!action.value){attrToggle(root.element,'required',!1)}
else if(root.query('GET_TOTAL_ITEMS')===0){attrToggle(root.element,'required',!0)}};var setCaptureMethod=function setCaptureMethod(_ref6){var root=_ref6.root,action=_ref6.action;attrToggle(root.element,'capture',!!action.value,action.value===!0?'':action.value)};var updateRequiredStatus=function updateRequiredStatus(_ref7){var root=_ref7.root;var element=root.element;if(root.query('GET_TOTAL_ITEMS')>0){attrToggle(element,'required',!1);attrToggle(element,'name',!1)}else{attrToggle(element,'name',!0,root.query('GET_NAME'));var shouldCheckValidity=root.query('GET_CHECK_VALIDITY');if(shouldCheckValidity){element.setCustomValidity('')}
if(root.query('GET_REQUIRED')){attrToggle(element,'required',!0)}}};var updateFieldValidityStatus=function updateFieldValidityStatus(_ref8){var root=_ref8.root;var shouldCheckValidity=root.query('GET_CHECK_VALIDITY');if(!shouldCheckValidity)return;root.element.setCustomValidity(root.query('GET_LABEL_INVALID_FIELD'))};var browser=createView({tag:'input',name:'browser',ignoreRect:!0,ignoreRectUpdate:!0,attributes:{type:'file'},create:create$a,destroy:function destroy(_ref9){var root=_ref9.root;root.element.removeEventListener('change',root.ref.handleChange)},write:createRoute({DID_LOAD_ITEM:updateRequiredStatus,DID_REMOVE_ITEM:updateRequiredStatus,DID_THROW_ITEM_INVALID:updateFieldValidityStatus,DID_SET_DISABLED:toggleDisabled,DID_SET_ALLOW_BROWSE:toggleDisabled,DID_SET_ALLOW_MULTIPLE:toggleAllowMultiple,DID_SET_ACCEPTED_FILE_TYPES:setAcceptedFileTypes,DID_SET_CAPTURE_METHOD:setCaptureMethod,DID_SET_REQUIRED:toggleRequired})});var Key={ENTER:13,SPACE:32};var create$b=function create(_ref){var root=_ref.root,props=_ref.props;var label=createElement$1('label');attr(label,'for','filepond--browser-'+props.id);attr(label,'id','filepond--drop-label-'+props.id);attr(label,'aria-hidden','true');label.addEventListener('keydown',function(e){var isActivationKey=e.keyCode===Key.ENTER||e.keyCode===Key.SPACE;if(!isActivationKey)return;e.preventDefault();root.ref.label.click()});root.element.addEventListener('click',function(e){var isLabelClick=e.target===label||label.contains(e.target);if(isLabelClick)return;root.ref.label.click()});updateLabelValue(label,props.caption);root.appendChild(label);root.ref.label=label};var updateLabelValue=function updateLabelValue(label,value){label.innerHTML=value;var clickable=label.querySelector('.filepond--label-action');if(clickable){attr(clickable,'tabindex','0')}
return value};var dropLabel=createView({name:'drop-label',ignoreRect:!0,create:create$b,write:createRoute({DID_SET_LABEL_IDLE:function DID_SET_LABEL_IDLE(_ref2){var root=_ref2.root,action=_ref2.action;updateLabelValue(root.ref.label,action.value)}}),mixins:{styles:['opacity','translateX','translateY'],animations:{opacity:{type:'tween',duration:150},translateX:'spring',translateY:'spring'}}});var blob=createView({name:'drip-blob',ignoreRect:!0,mixins:{styles:['translateX','translateY','scaleX','scaleY','opacity'],animations:{scaleX:'spring',scaleY:'spring',translateX:'spring',translateY:'spring',opacity:{type:'tween',duration:250}}}});var addBlob=function addBlob(_ref){var root=_ref.root;var centerX=root.rect.element.width*0.5;var centerY=root.rect.element.height*0.5;root.ref.blob=root.appendChildView(root.createChildView(blob,{opacity:0,scaleX:2.5,scaleY:2.5,translateX:centerX,translateY:centerY}))};var moveBlob=function moveBlob(_ref2){var root=_ref2.root,action=_ref2.action;if(!root.ref.blob){addBlob({root:root});return}
root.ref.blob.translateX=action.position.scopeLeft;root.ref.blob.translateY=action.position.scopeTop;root.ref.blob.scaleX=1;root.ref.blob.scaleY=1;root.ref.blob.opacity=1};var hideBlob=function hideBlob(_ref3){var root=_ref3.root;if(!root.ref.blob){return}
root.ref.blob.opacity=0};var explodeBlob=function explodeBlob(_ref4){var root=_ref4.root;if(!root.ref.blob){return}
root.ref.blob.scaleX=2.5;root.ref.blob.scaleY=2.5;root.ref.blob.opacity=0};var write$7=function write(_ref5){var root=_ref5.root,props=_ref5.props,actions=_ref5.actions;route$4({root:root,props:props,actions:actions});var blob=root.ref.blob;if(actions.length===0&&blob&&blob.opacity===0){root.removeChildView(blob);root.ref.blob=null}};var route$4=createRoute({DID_DRAG:moveBlob,DID_DROP:explodeBlob,DID_END_DRAG:hideBlob});var drip=createView({ignoreRect:!0,ignoreRectUpdate:!0,name:'drip',write:write$7});var getRootNode=function getRootNode(element){return'getRootNode' in element?element.getRootNode():document};var images=['jpg','jpeg','png','gif','bmp','webp','svg','tiff'];var text$1=['css','csv','html','txt'];var apps=['rtf','pdf','json'];var map={zip:'zip|compressed',epub:'application/epub+zip'};var guesstimateMimeType=function guesstimateMimeType(){var extension=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';extension=extension.toLowerCase();if(images.includes(extension)){return('image/'+(extension==='jpg'?'jpeg':extension==='svg'?'svg+xml':extension))}
if(text$1.includes(extension)){return'text/'+extension}
return map[extension]||null};var requestDataTransferItems=function requestDataTransferItems(dataTransfer){return new Promise(function(resolve,reject){var links=getLinks(dataTransfer);if(links.length){resolve(links);return}
getFiles(dataTransfer).then(resolve)})};var getFiles=function getFiles(dataTransfer){return new Promise(function(resolve,reject){var promisedFiles=(dataTransfer.items?Array.from(dataTransfer.items):[]).filter(function(item){return isFileSystemItem(item)}).map(function(item){return getFilesFromItem(item)});if(!promisedFiles.length){resolve(dataTransfer.files?Array.from(dataTransfer.files):[]);return}
Promise.all(promisedFiles).then(function(returendFileGroups){var files=[];returendFileGroups.forEach(function(group){files.push.apply(files,group)});resolve(files.filter(function(file){return file}))})})};var isFileSystemItem=function isFileSystemItem(item){if(isEntry(item)){var entry=getAsEntry(item);if(entry){return entry.isFile||entry.isDirectory}}
return item.kind==='file'};var getFilesFromItem=function getFilesFromItem(item){return new Promise(function(resolve,reject){if(isDirectoryEntry(item)){getFilesInDirectory(getAsEntry(item)).then(resolve);return}
resolve([item.getAsFile()])})};var getFilesInDirectory=function getFilesInDirectory(entry){return new Promise(function(resolve,reject){var files=[];var totalFilesFound=0;var readEntries=function readEntries(dirEntry){var directoryReader=dirEntry.createReader();directoryReader.readEntries(function(entries){entries.forEach(function(entry){if(entry.isDirectory){readEntries(entry)}else{totalFilesFound++;entry.file(function(file){files.push(correctMissingFileType(file));if(totalFilesFound===files.length){resolve(files)}})}})})};readEntries(entry)})};var correctMissingFileType=function correctMissingFileType(file){if(file.type.length)return file;var date=file.lastModifiedDate;var name=file.name;file=file.slice(0,file.size,guesstimateMimeType(getExtensionFromFilename(file.name)));file.name=name;file.lastModifiedDate=date;return file};var isDirectoryEntry=function isDirectoryEntry(item){return isEntry(item)&&(getAsEntry(item)||{}).isDirectory};var isEntry=function isEntry(item){return'webkitGetAsEntry' in item};var getAsEntry=function getAsEntry(item){return item.webkitGetAsEntry()};var getLinks=function getLinks(dataTransfer){var links=[];try{links=getLinksFromTransferMetaData(dataTransfer);if(links.length){return links}
links=getLinksFromTransferURLData(dataTransfer)}catch(e){}
return links};var getLinksFromTransferURLData=function getLinksFromTransferURLData(dataTransfer){var data=dataTransfer.getData('url');if(typeof data==='string'&&data.length){return[data]}
return[]};var getLinksFromTransferMetaData=function getLinksFromTransferMetaData(dataTransfer){var data=dataTransfer.getData('text/html');if(typeof data==='string'&&data.length){var matches=data.match(/src\s*=\s*"(.+?)"/);if(matches){return[matches[1]]}}
return[]};var dragNDropObservers=[];var eventPosition=function eventPosition(e){return{pageLeft:e.pageX,pageTop:e.pageY,scopeLeft:e.offsetX||e.layerX,scopeTop:e.offsetY||e.layerY}};var createDragNDropClient=function createDragNDropClient(element,scopeToObserve,filterElement){var observer=getDragNDropObserver(scopeToObserve);var client={element:element,filterElement:filterElement,state:null,ondrop:function ondrop(){},onenter:function onenter(){},ondrag:function ondrag(){},onexit:function onexit(){},onload:function onload(){},allowdrop:function allowdrop(){}};client.destroy=observer.addListener(client);return client};var getDragNDropObserver=function getDragNDropObserver(element){var observer=dragNDropObservers.find(function(item){return item.element===element});if(observer){return observer}
var newObserver=createDragNDropObserver(element);dragNDropObservers.push(newObserver);return newObserver};var createDragNDropObserver=function createDragNDropObserver(element){var clients=[];var routes={dragenter:dragenter,dragover:dragover,dragleave:dragleave,drop:drop};var handlers={};forin(routes,function(event,createHandler){handlers[event]=createHandler(element,clients);element.addEventListener(event,handlers[event],!1)});var observer={element:element,addListener:function addListener(client){clients.push(client);return function(){clients.splice(clients.indexOf(client),1);if(clients.length===0){dragNDropObservers.splice(dragNDropObservers.indexOf(observer),1);forin(routes,function(event){element.removeEventListener(event,handlers[event],!1)})}}}};return observer};var elementFromPoint=function elementFromPoint(root,point){if(!('elementFromPoint' in root)){root=document}
return root.elementFromPoint(point.x,point.y)};var isEventTarget=function isEventTarget(e,target){var root=getRootNode(target);var elementAtPosition=elementFromPoint(root,{x:e.pageX-window.pageXOffset,y:e.pageY-window.pageYOffset});return elementAtPosition===target||target.contains(elementAtPosition)};var initialTarget=null;var setDropEffect=function setDropEffect(dataTransfer,effect){try{dataTransfer.dropEffect=effect}catch(e){}};var dragenter=function dragenter(root,clients){return function(e){e.preventDefault();initialTarget=e.target;clients.forEach(function(client){var element=client.element,onenter=client.onenter;if(isEventTarget(e,element)){client.state='enter';onenter(eventPosition(e))}})}};var dragover=function dragover(root,clients){return function(e){e.preventDefault();var dataTransfer=e.dataTransfer;requestDataTransferItems(dataTransfer).then(function(items){var overDropTarget=!1;clients.some(function(client){var filterElement=client.filterElement,element=client.element,onenter=client.onenter,onexit=client.onexit,ondrag=client.ondrag,allowdrop=client.allowdrop;setDropEffect(dataTransfer,'copy');var allowsTransfer=allowdrop(items);if(!allowsTransfer){setDropEffect(dataTransfer,'none');return}
if(isEventTarget(e,element)){overDropTarget=!0;if(client.state===null){client.state='enter';onenter(eventPosition(e));return}
client.state='over';if(filterElement&&!allowsTransfer){setDropEffect(dataTransfer,'none');return}
ondrag(eventPosition(e))}else{if(filterElement&&!overDropTarget){setDropEffect(dataTransfer,'none')}
if(client.state){client.state=null;onexit(eventPosition(e))}}})})}};var drop=function drop(root,clients){return function(e){e.preventDefault();var dataTransfer=e.dataTransfer;requestDataTransferItems(dataTransfer).then(function(items){clients.forEach(function(client){var filterElement=client.filterElement,element=client.element,ondrop=client.ondrop,onexit=client.onexit,allowdrop=client.allowdrop;client.state=null;var allowsTransfer=allowdrop(items);if(!allowsTransfer){onexit(eventPosition(e));return}
if(filterElement&&!isEventTarget(e,element)){return}
ondrop(eventPosition(e),items)})})}};var dragleave=function dragleave(root,clients){return function(e){if(initialTarget!==e.target){return}
clients.forEach(function(client){var onexit=client.onexit;client.state=null;onexit(eventPosition(e))})}};var createHopper=function createHopper(scope,validateItems,options){scope.classList.add('filepond--hopper');var catchesDropsOnPage=options.catchesDropsOnPage,requiresDropOnElement=options.requiresDropOnElement,_options$filterItems=options.filterItems,filterItems=_options$filterItems===void 0?function(items){return items}:_options$filterItems;var client=createDragNDropClient(scope,catchesDropsOnPage?document.documentElement:scope,requiresDropOnElement);var lastState='';var currentState='';client.allowdrop=function(items){return validateItems(filterItems(items))};client.ondrop=function(position,items){var filteredItems=filterItems(items);if(!validateItems(filteredItems)){api.ondragend(position);return}
currentState='drag-drop';api.onload(filteredItems,position)};client.ondrag=function(position){api.ondrag(position)};client.onenter=function(position){currentState='drag-over';api.ondragstart(position)};client.onexit=function(position){currentState='drag-exit';api.ondragend(position)};var api={updateHopperState:function updateHopperState(){if(lastState!==currentState){scope.dataset.hopperState=currentState;lastState=currentState}},onload:function onload(){},ondragstart:function ondragstart(){},ondrag:function ondrag(){},ondragend:function ondragend(){},destroy:function destroy(){client.destroy()}};return api};var listening=!1;var listeners$1=[];var handlePaste=function handlePaste(e){requestDataTransferItems(e.clipboardData).then(function(files){if(!files.length){return}
listeners$1.forEach(function(listener){return listener(files)})})};var listen=function listen(cb){if(listeners$1.includes(cb)){return}
listeners$1.push(cb);if(listening){return}
listening=!0;document.addEventListener('paste',handlePaste)};var unlisten=function unlisten(listener){arrayRemove(listeners$1,listeners$1.indexOf(listener));if(listeners$1.length===0){document.removeEventListener('paste',handlePaste);listening=!1}};var createPaster=function createPaster(){var cb=function cb(files){api.onload(files)};var api={destroy:function destroy(){unlisten(cb)},onload:function onload(){}};listen(cb);return api};var create$c=function create(_ref){var root=_ref.root,props=_ref.props;root.element.id='filepond--assistant-'+props.id;attr(root.element,'role','status');attr(root.element,'aria-live','polite');attr(root.element,'aria-relevant','additions')};var addFilesNotificationTimeout=null;var notificationClearTimeout=null;var filenames=[];var assist=function assist(root,message){root.element.textContent=message};var clear$1=function clear(root){root.element.textContent=''};var listModified=function listModified(root,filename,label){var total=root.query('GET_TOTAL_ITEMS');assist(root,label+' '+filename+', '+total+' '+(total===1?root.query('GET_LABEL_FILE_COUNT_SINGULAR'):root.query('GET_LABEL_FILE_COUNT_PLURAL')));clearTimeout(notificationClearTimeout);notificationClearTimeout=setTimeout(function(){clear$1(root)},1500)};var isUsingFilePond=function isUsingFilePond(root){return root.element.parentNode.contains(document.activeElement)};var itemAdded=function itemAdded(_ref2){var root=_ref2.root,action=_ref2.action;if(!isUsingFilePond(root)){return}
root.element.textContent='';var item=root.query('GET_ITEM',action.id);filenames.push(item.filename);clearTimeout(addFilesNotificationTimeout);addFilesNotificationTimeout=setTimeout(function(){listModified(root,filenames.join(', '),root.query('GET_LABEL_FILE_ADDED'));filenames.length=0},750)};var itemRemoved=function itemRemoved(_ref3){var root=_ref3.root,action=_ref3.action;if(!isUsingFilePond(root)){return}
var item=action.item;listModified(root,item.filename,root.query('GET_LABEL_FILE_REMOVED'))};var itemProcessed=function itemProcessed(_ref4){var root=_ref4.root,action=_ref4.action;var item=root.query('GET_ITEM',action.id);var filename=item.filename;var label=root.query('GET_LABEL_FILE_PROCESSING_COMPLETE');assist(root,filename+' '+label)};var itemProcessedUndo=function itemProcessedUndo(_ref5){var root=_ref5.root,action=_ref5.action;var item=root.query('GET_ITEM',action.id);var filename=item.filename;var label=root.query('GET_LABEL_FILE_PROCESSING_ABORTED');assist(root,filename+' '+label)};var itemError=function itemError(_ref6){var root=_ref6.root,action=_ref6.action;var item=root.query('GET_ITEM',action.id);var filename=item.filename;assist(root,action.status.main+' '+filename+' '+action.status.sub)};var assistant=createView({create:create$c,ignoreRect:!0,ignoreRectUpdate:!0,write:createRoute({DID_LOAD_ITEM:itemAdded,DID_REMOVE_ITEM:itemRemoved,DID_COMPLETE_ITEM_PROCESSING:itemProcessed,DID_ABORT_ITEM_PROCESSING:itemProcessedUndo,DID_REVERT_ITEM_PROCESSING:itemProcessedUndo,DID_THROW_ITEM_REMOVE_ERROR:itemError,DID_THROW_ITEM_LOAD_ERROR:itemError,DID_THROW_ITEM_INVALID:itemError,DID_THROW_ITEM_PROCESSING_ERROR:itemError}),tag:'span',name:'assistant'});var toCamels=function toCamels(string){var separator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'-';return string.replace(new RegExp(separator+'.','g'),function(sub){return sub.charAt(1).toUpperCase()})};var debounce=function debounce(func){var interval=arguments.length>1&&arguments[1]!==undefined?arguments[1]:16;var immidiateOnly=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;var last=Date.now();var timeout=null;return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}
clearTimeout(timeout);var dist=Date.now()-last;var fn=function fn(){last=Date.now();func.apply(void 0,args)};if(dist<interval){if(!immidiateOnly){timeout=setTimeout(fn,interval-dist)}}else{fn()}}};var MAX_FILES_LIMIT=1000000;var create$d=function create(_ref){var root=_ref.root,props=_ref.props;var id=root.query('GET_ID');if(id){root.element.id=id}
var className=root.query('GET_CLASS_NAME');if(className){className.split(' ').forEach(function(name){root.element.classList.add(name)})}
root.ref.label=root.appendChildView(root.createChildView(dropLabel,Object.assign({},props,{translateY:null,caption:root.query('GET_LABEL_IDLE')})));root.ref.list=root.appendChildView(root.createChildView(listScroller,{translateY:null}));root.ref.panel=root.appendChildView(root.createChildView(panel,{name:'panel-root'}));root.ref.assistant=root.appendChildView(root.createChildView(assistant,Object.assign({},props)));root.ref.measure=createElement$1('div');root.ref.measure.style.height='100%';root.element.appendChild(root.ref.measure);root.ref.bounds=null;root.query('GET_STYLES').filter(function(style){return!isEmpty(style.value)}).map(function(_ref2){var name=_ref2.name,value=_ref2.value;root.element.dataset[name]=value});root.ref.widthPrevious=null;root.ref.widthUpdated=debounce(function(){root.dispatch('DID_RESIZE_ROOT')},250);root.ref.previousAspectRatio=null;root.ref.updateHistory=[]};var write$8=function write(_ref3){var root=_ref3.root,props=_ref3.props,actions=_ref3.actions;route$5({root:root,props:props,actions:actions});actions.filter(function(action){return/^DID_SET_STYLE_/.test(action.type)}).filter(function(action){return!isEmpty(action.data.value)}).map(function(_ref4){var type=_ref4.type,data=_ref4.data;var name=toCamels(type.substr(8).toLowerCase(),'_');root.element.dataset[name]=data.value;root.invalidateLayout()});if(root.rect.element.hidden)return;if(root.rect.element.width!==root.ref.widthPrevious){root.ref.widthPrevious=root.rect.element.width;root.ref.widthUpdated()}
var bounds=root.ref.bounds;if(!bounds){bounds=root.ref.bounds=calculateRootBoundingBoxHeight(root);root.element.removeChild(root.ref.measure);root.ref.measure=null}
var _root$ref=root.ref,hopper=_root$ref.hopper,label=_root$ref.label,list=_root$ref.list,panel=_root$ref.panel;if(hopper){hopper.updateHopperState()}
var aspectRatio=root.query('GET_PANEL_ASPECT_RATIO');var isMultiItem=root.query('GET_ALLOW_MULTIPLE');var totalItems=root.query('GET_TOTAL_ITEMS');var maxItems=isMultiItem?root.query('GET_MAX_FILES')||MAX_FILES_LIMIT:1;var atMaxCapacity=totalItems===maxItems;var addAction=actions.find(function(action){return action.type==='DID_ADD_ITEM'});if(atMaxCapacity&&addAction){var interactionMethod=addAction.data.interactionMethod;label.opacity=0;if(isMultiItem){label.translateY=-40}else{if(interactionMethod===InteractionMethod.API){label.translateX=40}else if(interactionMethod===InteractionMethod.BROWSE){label.translateY=40}else{label.translateY=30}}}else if(!atMaxCapacity){label.opacity=1;label.translateX=0;label.translateY=0}
var listItemMargin=calculateListItemMargin(root);var listHeight=calculateListHeight(root);var labelHeight=label.rect.element.height;var currentLabelHeight=!isMultiItem||atMaxCapacity?0:labelHeight;var listMarginTop=atMaxCapacity?list.rect.element.marginTop:0;var listMarginBottom=totalItems===0?0:list.rect.element.marginBottom;var visualHeight=currentLabelHeight+listMarginTop+listHeight.visual+listMarginBottom;var boundsHeight=currentLabelHeight+listMarginTop+listHeight.bounds+listMarginBottom;list.translateY=Math.max(0,currentLabelHeight-list.rect.element.marginTop)-listItemMargin.top;if(aspectRatio){var width=root.rect.element.width;var height=width*aspectRatio;if(aspectRatio!==root.ref.previousAspectRatio){root.ref.previousAspectRatio=aspectRatio;root.ref.updateHistory=[]}
var history=root.ref.updateHistory;history.push(width);var MAX_BOUNCES=2;if(history.length>MAX_BOUNCES*2){var l=history.length;var bottom=l-10;var bounces=0;for(var i=l;i>=bottom;i--){if(history[i]===history[i-2]){bounces++}
if(bounces>=MAX_BOUNCES){return}}}
panel.scalable=!1;panel.height=height;var listAvailableHeight=height-currentLabelHeight-(listMarginBottom-listItemMargin.bottom)-(atMaxCapacity?listMarginTop:0);if(listHeight.visual>listAvailableHeight){list.overflow=listAvailableHeight}else{list.overflow=null}
root.height=height}else if(bounds.fixedHeight){panel.scalable=!1;var _listAvailableHeight=bounds.fixedHeight-currentLabelHeight-(listMarginBottom-listItemMargin.bottom)-(atMaxCapacity?listMarginTop:0);if(listHeight.visual>_listAvailableHeight){list.overflow=_listAvailableHeight}else{list.overflow=null}}else if(bounds.cappedHeight){var isCappedHeight=visualHeight>=bounds.cappedHeight;var panelHeight=Math.min(bounds.cappedHeight,visualHeight);panel.scalable=!0;panel.height=isCappedHeight?panelHeight:panelHeight-listItemMargin.top-listItemMargin.bottom;var _listAvailableHeight2=panelHeight-currentLabelHeight-(listMarginBottom-listItemMargin.bottom)-(atMaxCapacity?listMarginTop:0);if(visualHeight>bounds.cappedHeight&&listHeight.visual>_listAvailableHeight2){list.overflow=_listAvailableHeight2}else{list.overflow=null}
root.height=Math.min(bounds.cappedHeight,boundsHeight-listItemMargin.top-listItemMargin.bottom)}else{var itemMargin=totalItems>0?listItemMargin.top+listItemMargin.bottom:0;panel.scalable=!0;panel.height=Math.max(labelHeight,visualHeight-itemMargin);root.height=Math.max(labelHeight,boundsHeight-itemMargin)}};var calculateListItemMargin=function calculateListItemMargin(root){var item=root.ref.list.childViews[0].childViews[0];return item?{top:item.rect.element.marginTop,bottom:item.rect.element.marginBottom}:{top:0,bottom:0}};var calculateListHeight=function calculateListHeight(root){var visual=0;var bounds=0;var scrollList=root.ref.list;var itemList=scrollList.childViews[0];var children=itemList.childViews;if(children.length===0)return{visual:visual,bounds:bounds};var horizontalSpace=itemList.rect.element.width;var dragIndex=getItemIndexByPosition(itemList,scrollList.dragCoordinates);var childRect=children[0].rect.element;var itemVerticalMargin=childRect.marginTop+childRect.marginBottom;var itemHorizontalMargin=childRect.marginLeft+childRect.marginRight;var itemWidth=childRect.width+itemHorizontalMargin;var itemHeight=childRect.height+itemVerticalMargin;var newItem=typeof dragIndex!=='undefined'&&dragIndex>=0?1:0;var removedItem=children.find(function(child){return child.markedForRemoval&&child.opacity<0.45})?-1:0;var verticalItemCount=children.length+newItem+removedItem;var itemsPerRow=Math.round(horizontalSpace/itemWidth);if(itemsPerRow===1){children.forEach(function(item){var height=item.rect.element.height+itemVerticalMargin;bounds+=height;visual+=height*item.opacity})}
else{bounds=Math.ceil(verticalItemCount/itemsPerRow)*itemHeight;visual=bounds}
return{visual:visual,bounds:bounds}};var calculateRootBoundingBoxHeight=function calculateRootBoundingBoxHeight(root){var height=root.ref.measureHeight||null;var cappedHeight=parseInt(root.style.maxHeight,10)||null;var fixedHeight=height===0?null:height;return{cappedHeight:cappedHeight,fixedHeight:fixedHeight}};var exceedsMaxFiles=function exceedsMaxFiles(root,items){var allowReplace=root.query('GET_ALLOW_REPLACE');var allowMultiple=root.query('GET_ALLOW_MULTIPLE');var totalItems=root.query('GET_TOTAL_ITEMS');var maxItems=root.query('GET_MAX_FILES');var totalBrowseItems=items.length;if(!allowMultiple&&totalBrowseItems>1){return!0}
maxItems=allowMultiple?maxItems:allowReplace?maxItems:1;var hasMaxItems=isInt(maxItems);if(hasMaxItems&&totalItems+totalBrowseItems>maxItems){root.dispatch('DID_THROW_MAX_FILES',{source:items,error:createResponse('warning',0,'Max files')});return!0}
return!1};var getDragIndex=function getDragIndex(list,position){var itemList=list.childViews[0];return getItemIndexByPosition(itemList,{left:position.scopeLeft-itemList.rect.element.left,top:position.scopeTop-(list.rect.outer.top+list.rect.element.marginTop+list.rect.element.scrollTop)})};var toggleDrop=function toggleDrop(root){var isAllowed=root.query('GET_ALLOW_DROP');var isDisabled=root.query('GET_DISABLED');var enabled=isAllowed&&!isDisabled;if(enabled&&!root.ref.hopper){var hopper=createHopper(root.element,function(items){if(exceedsMaxFiles(root,items))return!1;var beforeDropFile=root.query('GET_BEFORE_DROP_FILE')||function(){return!0};var dropValidation=root.query('GET_DROP_VALIDATION');return dropValidation?items.every(function(item){return(applyFilters('ALLOW_HOPPER_ITEM',item,{query:root.query}).every(function(result){return result===!0})&&beforeDropFile(item))}):!0},{filterItems:function filterItems(items){var ignoredFiles=root.query('GET_IGNORED_FILES');return items.filter(function(item){if(isFile(item)){return!ignoredFiles.includes(item.name.toLowerCase())}
return!0})},catchesDropsOnPage:root.query('GET_DROP_ON_PAGE'),requiresDropOnElement:root.query('GET_DROP_ON_ELEMENT')});hopper.onload=function(items,position){root.dispatch('ADD_ITEMS',{items:items,index:getDragIndex(root.ref.list,position),interactionMethod:InteractionMethod.DROP});root.dispatch('DID_DROP',{position:position});root.dispatch('DID_END_DRAG',{position:position})};hopper.ondragstart=function(position){root.dispatch('DID_START_DRAG',{position:position})};hopper.ondrag=debounce(function(position){root.dispatch('DID_DRAG',{position:position})});hopper.ondragend=function(position){root.dispatch('DID_END_DRAG',{position:position})};root.ref.hopper=hopper;root.ref.drip=root.appendChildView(root.createChildView(drip))}else if(!enabled&&root.ref.hopper){root.ref.hopper.destroy();root.ref.hopper=null;root.removeChildView(root.ref.drip)}};var toggleBrowse=function toggleBrowse(root,props){var isAllowed=root.query('GET_ALLOW_BROWSE');var isDisabled=root.query('GET_DISABLED');var enabled=isAllowed&&!isDisabled;if(enabled&&!root.ref.browser){root.ref.browser=root.appendChildView(root.createChildView(browser,Object.assign({},props,{onload:function onload(items){if(exceedsMaxFiles(root,items))return!1;root.dispatch('ADD_ITEMS',{items:items,index:-1,interactionMethod:InteractionMethod.BROWSE})}})),0)}else if(!enabled&&root.ref.browser){root.removeChildView(root.ref.browser);root.ref.browser=null}};var togglePaste=function togglePaste(root){var isAllowed=root.query('GET_ALLOW_PASTE');var isDisabled=root.query('GET_DISABLED');var enabled=isAllowed&&!isDisabled;if(enabled&&!root.ref.paster){root.ref.paster=createPaster();root.ref.paster.onload=function(items){root.dispatch('ADD_ITEMS',{items:items,index:-1,interactionMethod:InteractionMethod.PASTE})}}else if(!enabled&&root.ref.paster){root.ref.paster.destroy();root.ref.paster=null}};var route$5=createRoute({DID_SET_ALLOW_BROWSE:function DID_SET_ALLOW_BROWSE(_ref5){var root=_ref5.root,props=_ref5.props;toggleBrowse(root,props)},DID_SET_ALLOW_DROP:function DID_SET_ALLOW_DROP(_ref6){var root=_ref6.root;toggleDrop(root)},DID_SET_ALLOW_PASTE:function DID_SET_ALLOW_PASTE(_ref7){var root=_ref7.root;togglePaste(root)},DID_SET_DISABLED:function DID_SET_DISABLED(_ref8){var root=_ref8.root,props=_ref8.props;toggleDrop(root);togglePaste(root);toggleBrowse(root,props);var isDisabled=root.query('GET_DISABLED');if(isDisabled){root.element.dataset.disabled='disabled'}else{delete root.element.dataset.disabled}}});var root=createView({name:'root',read:function read(_ref9){var root=_ref9.root;if(root.ref.measure){root.ref.measureHeight=root.ref.measure.offsetHeight}},create:create$d,write:write$8,destroy:function destroy(_ref10){var root=_ref10.root;if(root.ref.paster){root.ref.paster.destroy()}
if(root.ref.hopper){root.ref.hopper.destroy()}},mixins:{styles:['height']}});var createApp=function createApp(){var initialOptions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var originalElement=null;var defaultOptions=getOptions();var store=createStore(createInitialState(defaultOptions),[queries,createOptionQueries(defaultOptions)],[actions,createOptionActions(defaultOptions)]);store.dispatch('SET_OPTIONS',{options:initialOptions});var visibilityHandler=function visibilityHandler(){if(document.hidden)return;store.dispatch('KICK')};document.addEventListener('visibilitychange',visibilityHandler);var resizeDoneTimer=null;var isResizing=!1;var isResizingHorizontally=!1;var initialWindowWidth=null;var currentWindowWidth=null;var resizeHandler=function resizeHandler(){if(!isResizing){isResizing=!0}
clearTimeout(resizeDoneTimer);resizeDoneTimer=setTimeout(function(){isResizing=!1;initialWindowWidth=null;currentWindowWidth=null;if(isResizingHorizontally){isResizingHorizontally=!1;store.dispatch('DID_STOP_RESIZE')}},500)};window.addEventListener('resize',resizeHandler);var view=root(store,{id:getUniqueId()});var isResting=!1;var isHidden=!1;var readWriteApi={_read:function _read(){if(isResizing){currentWindowWidth=window.innerWidth;if(!initialWindowWidth){initialWindowWidth=currentWindowWidth}
if(!isResizingHorizontally&&currentWindowWidth!==initialWindowWidth){store.dispatch('DID_START_RESIZE');isResizingHorizontally=!0}}
if(isHidden&&isResting){isResting=view.element.offsetParent===null}
if(isResting)return;view._read();isHidden=view.rect.element.hidden},_write:function _write(ts){var actions=store.processActionQueue().filter(function(action){return!/^SET_/.test(action.type)});if(isResting&&!actions.length)return;routeActionsToEvents(actions);isResting=view._write(ts,actions,isResizingHorizontally);removeReleasedItems(store.query('GET_ITEMS'));if(isResting){store.processDispatchQueue()}}};var createEvent=function createEvent(name){return function(data){var event={type:name};if(!data){return event}
if(data.hasOwnProperty('error')){event.error=data.error?Object.assign({},data.error):null}
if(data.status){event.status=Object.assign({},data.status)}
if(data.file){event.output=data.file}
if(data.source){event.file=data.source}else if(data.item||data.id){var item=data.item?data.item:store.query('GET_ITEM',data.id);event.file=item?createItemAPI(item):null}
if(data.items){event.items=data.items.map(createItemAPI)}
if(/progress/.test(name)){event.progress=data.progress}
return event}};var eventRoutes={DID_DESTROY:createEvent('destroy'),DID_INIT:createEvent('init'),DID_THROW_MAX_FILES:createEvent('warning'),DID_START_ITEM_LOAD:createEvent('addfilestart'),DID_UPDATE_ITEM_LOAD_PROGRESS:createEvent('addfileprogress'),DID_LOAD_ITEM:createEvent('addfile'),DID_THROW_ITEM_INVALID:[createEvent('error'),createEvent('addfile')],DID_THROW_ITEM_LOAD_ERROR:[createEvent('error'),createEvent('addfile')],DID_THROW_ITEM_REMOVE_ERROR:[createEvent('error'),createEvent('removefile')],DID_PREPARE_OUTPUT:createEvent('preparefile'),DID_START_ITEM_PROCESSING:createEvent('processfilestart'),DID_UPDATE_ITEM_PROCESS_PROGRESS:createEvent('processfileprogress'),DID_ABORT_ITEM_PROCESSING:createEvent('processfileabort'),DID_COMPLETE_ITEM_PROCESSING:createEvent('processfile'),DID_COMPLETE_ITEM_PROCESSING_ALL:createEvent('processfiles'),DID_REVERT_ITEM_PROCESSING:createEvent('processfilerevert'),DID_THROW_ITEM_PROCESSING_ERROR:[createEvent('error'),createEvent('processfile')],DID_REMOVE_ITEM:createEvent('removefile'),DID_UPDATE_ITEMS:createEvent('updatefiles'),DID_ACTIVATE_ITEM:createEvent('activatefile')};var exposeEvent=function exposeEvent(event){var detail=Object.assign({pond:exports},event);delete detail.type;view.element.dispatchEvent(new CustomEvent('FilePond:'+event.type,{detail:detail,bubbles:!0,cancelable:!0,composed:!0}));var params=[];if(event.hasOwnProperty('error')){params.push(event.error)}
if(event.hasOwnProperty('file')){params.push(event.file)}
var filtered=['type','error','file'];Object.keys(event).filter(function(key){return!filtered.includes(key)}).forEach(function(key){return params.push(event[key])});exports.fire.apply(exports,[event.type].concat(params));var handler=store.query('GET_ON'+event.type.toUpperCase());if(handler){handler.apply(void 0,params)}};var routeActionsToEvents=function routeActionsToEvents(actions){if(!actions.length){return}
actions.forEach(function(action){if(!eventRoutes[action.type]){return}
var routes=eventRoutes[action.type];(Array.isArray(routes)?routes:[routes]).forEach(function(route){setTimeout(function(){exposeEvent(route(action.data))},0)})})};var setOptions=function setOptions(options){return store.dispatch('SET_OPTIONS',{options:options})};var getFile=function getFile(query){return store.query('GET_ACTIVE_ITEM',query)};var addFile=function addFile(source){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return new Promise(function(resolve,reject){addFiles([{source:source,options:options}],{index:options.index}).then(function(items){return resolve(items&&items[0])}).catch(reject)})};var removeFile=function removeFile(query){store.dispatch('REMOVE_ITEM',{query:query});return store.query('GET_ACTIVE_ITEM',query)===null};var addFiles=function addFiles(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}
return new Promise(function(resolve,reject){var sources=[];var options={};if(isArray(args[0])){sources.push.apply(sources,args[0]);Object.assign(options,args[1]||{})}else{var lastArgument=args[args.length-1];if(typeof lastArgument==='object'&&!(lastArgument instanceof Blob)){Object.assign(options,args.pop())}
sources.push.apply(sources,args)}
store.dispatch('ADD_ITEMS',{items:sources,index:options.index,interactionMethod:InteractionMethod.API,success:resolve,failure:reject})})};var getFiles=function getFiles(){return store.query('GET_ACTIVE_ITEMS')};var processFile=function processFile(query){return new Promise(function(resolve,reject){store.dispatch('REQUEST_ITEM_PROCESSING',{query:query,success:function success(item){resolve(item)},failure:function failure(error){reject(error)}})})};var processFiles=function processFiles(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}
var queries=Array.isArray(args[0])?args[0]:args;if(!queries.length){var files=getFiles().filter(function(item){return(!(item.status===ItemStatus.IDLE&&item.origin===FileOrigin.LOCAL)&&item.status!==ItemStatus.PROCESSING&&item.status!==ItemStatus.PROCESSING_COMPLETE&&item.status!==ItemStatus.PROCESSING_REVERT_ERROR)});return Promise.all(files.map(processFile))}
return Promise.all(queries.map(processFile))};var removeFiles=function removeFiles(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}
var queries=Array.isArray(args[0])?args[0]:args;var files=getFiles();if(!queries.length){return Promise.all(files.map(removeFile))}
var mappedQueries=queries.map(function(query){return isNumber(query)?files[query]?files[query].id:null:query}).filter(function(query){return query});return mappedQueries.map(removeFile)};var exports=Object.assign({},on(),readWriteApi,createOptionAPI(store,defaultOptions),{setOptions:setOptions,addFile:addFile,addFiles:addFiles,getFile:getFile,processFile:processFile,removeFile:removeFile,getFiles:getFiles,processFiles:processFiles,removeFiles:removeFiles,sort:function sort(compare){return store.dispatch('SORT',{compare:compare})},browse:function browse(){var input=view.element.querySelector('input[type=file]');if(input){input.click()}},destroy:function destroy(){exports.fire('destroy',view.element);store.dispatch('ABORT_ALL');view._destroy();window.removeEventListener('resize',resizeHandler);document.addEventListener('visibilitychange',visibilityHandler);store.dispatch('DID_DESTROY')},insertBefore:function insertBefore$1(element){return insertBefore(view.element,element)},insertAfter:function insertAfter$1(element){return insertAfter(view.element,element)},appendTo:function appendTo(element){return element.appendChild(view.element)},replaceElement:function replaceElement(element){insertBefore(view.element,element);element.parentNode.removeChild(element);originalElement=element},restoreElement:function restoreElement(){if(!originalElement){return}
insertAfter(originalElement,view.element);view.element.parentNode.removeChild(view.element);originalElement=null},isAttachedTo:function isAttachedTo(element){return view.element===element||originalElement===element},element:{get:function get(){return view.element}},status:{get:function get(){return store.query('GET_STATUS')}}});store.dispatch('DID_INIT');return createObject(exports)};var createAppObject=function createAppObject(){var customOptions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var defaultOptions={};forin(getOptions(),function(key,value){defaultOptions[key]=value[0]});var app=createApp(Object.assign({},defaultOptions,customOptions));return app};var lowerCaseFirstLetter=function lowerCaseFirstLetter(string){return string.charAt(0).toLowerCase()+string.slice(1)};var attributeNameToPropertyName=function attributeNameToPropertyName(attributeName){return toCamels(attributeName.replace(/^data-/,''))};var mapObject=function mapObject(object,propertyMap){forin(propertyMap,function(selector,mapping){forin(object,function(property,value){var selectorRegExp=new RegExp(selector);var matches=selectorRegExp.test(property);if(!matches){return}
delete object[property];if(mapping===!1){return}
if(isString(mapping)){object[mapping]=value;return}
var group=mapping.group;if(isObject(mapping)&&!object[group]){object[group]={}}
object[group][lowerCaseFirstLetter(property.replace(selectorRegExp,''))]=value});if(mapping.mapping){mapObject(object[mapping.group],mapping.mapping)}})};var getAttributesAsObject=function getAttributesAsObject(node){var attributeMapping=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var attributes=[];forin(node.attributes,function(index){attributes.push(node.attributes[index])});var output=attributes.filter(function(attribute){return attribute.name}).reduce(function(obj,attribute){var value=attr(node,attribute.name);obj[attributeNameToPropertyName(attribute.name)]=value===attribute.name?!0:value;return obj},{});mapObject(output,attributeMapping);return output};var createAppAtElement=function createAppAtElement(element){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var attributeMapping={'^class$':'className','^multiple$':'allowMultiple','^capture$':'captureMethod','^server':{group:'server',mapping:{'^process':{group:'process'},'^revert':{group:'revert'},'^fetch':{group:'fetch'},'^restore':{group:'restore'},'^load':{group:'load'}}},'^type$':!1,'^files$':!1};applyFilters('SET_ATTRIBUTE_TO_OPTION_MAP',attributeMapping);var mergedOptions=Object.assign({},options);var attributeOptions=getAttributesAsObject(element.nodeName==='FIELDSET'?element.querySelector('input[type=file]'):element,attributeMapping);Object.keys(attributeOptions).forEach(function(key){if(isObject(attributeOptions[key])){if(!isObject(mergedOptions[key])){mergedOptions[key]={}}
Object.assign(mergedOptions[key],attributeOptions[key])}else{mergedOptions[key]=attributeOptions[key]}});mergedOptions.files=(options.files||[]).concat(Array.from(element.querySelectorAll('input:not([type=file])')).map(function(input){return{source:input.value,options:{type:input.dataset.type}}}));var app=createAppObject(mergedOptions);if(element.files){Array.from(element.files).forEach(function(file){app.addFile(file)})}
app.replaceElement(element);return app};var createApp$1=function createApp(){return isNode(arguments.length<=0?undefined:arguments[0])?createAppAtElement.apply(void 0,arguments):createAppObject.apply(void 0,arguments)};var PRIVATE_METHODS=['fire','_read','_write'];var createAppAPI=function createAppAPI(app){var api={};copyObjectPropertiesToObject(app,api,PRIVATE_METHODS);return api};var replaceInString=function replaceInString(string,replacements){return string.replace(/(?:{([a-zA-Z]+)})/g,function(match,group){return replacements[group]})};var createWorker=function createWorker(fn){var workerBlob=new Blob(['(',fn.toString(),')()'],{type:'application/javascript'});var workerURL=URL.createObjectURL(workerBlob);var worker=new Worker(workerURL);return{transfer:function transfer(message,cb){},post:function post(message,cb,transferList){var id=getUniqueId();worker.onmessage=function(e){if(e.data.id===id){cb(e.data.message)}};worker.postMessage({id:id,message:message},transferList)},terminate:function terminate(){worker.terminate();URL.revokeObjectURL(workerURL)}}};var loadImage=function loadImage(url){return new Promise(function(resolve,reject){var img=new Image();img.onload=function(){resolve(img)};img.onerror=function(e){reject(e)};img.src=url})};var renameFile=function renameFile(file,name){var renamedFile=file.slice(0,file.size,file.type);renamedFile.lastModifiedDate=file.lastModifiedDate;renamedFile.name=name;return renamedFile};var copyFile=function copyFile(file){return renameFile(file,file.name)};var registeredPlugins=[];var createAppPlugin=function createAppPlugin(plugin){if(registeredPlugins.includes(plugin)){return}
registeredPlugins.push(plugin);var pluginOutline=plugin({addFilter:addFilter,utils:{Type:Type,forin:forin,isString:isString,isFile:isFile,toNaturalFileSize:toNaturalFileSize,replaceInString:replaceInString,getExtensionFromFilename:getExtensionFromFilename,getFilenameWithoutExtension:getFilenameWithoutExtension,guesstimateMimeType:guesstimateMimeType,getFileFromBlob:getFileFromBlob,getFilenameFromURL:getFilenameFromURL,createRoute:createRoute,createWorker:createWorker,createView:createView,createItemAPI:createItemAPI,loadImage:loadImage,copyFile:copyFile,renameFile:renameFile,createBlob:createBlob,applyFilterChain:applyFilterChain,text:text,getNumericAspectRatioFromString:getNumericAspectRatioFromString},views:{fileActionButton:fileActionButton}});extendDefaultOptions(pluginOutline.options)};var isOperaMini=function isOperaMini(){return(Object.prototype.toString.call(window.operamini)==='[object OperaMini]')};var hasPromises=function hasPromises(){return'Promise' in window};var hasBlobSlice=function hasBlobSlice(){return'slice' in Blob.prototype};var hasCreateObjectURL=function hasCreateObjectURL(){return'URL' in window&&'createObjectURL' in window.URL};var hasVisibility=function hasVisibility(){return'visibilityState' in document};var hasTiming=function hasTiming(){return'performance' in window};var isBrowser=function isBrowser(){return(typeof window!=='undefined'&&typeof window.document!=='undefined')};var supported=(function(){var isSupported=isBrowser()&&!isOperaMini()&&hasVisibility()&&hasPromises()&&hasBlobSlice()&&hasCreateObjectURL()&&hasTiming();return function(){return isSupported}})();var state={apps:[]};var name='filepond';var fn=function fn(){};exports.Status={};exports.FileStatus={};exports.FileOrigin={};exports.OptionTypes={};exports.create=fn;exports.destroy=fn;exports.parse=fn;exports.find=fn;exports.registerPlugin=fn;exports.getOptions=fn;exports.setOptions=fn;if(supported()){createPainter(function(){state.apps.forEach(function(app){return app._read()})},function(ts){state.apps.forEach(function(app){return app._write(ts)})});var dispatch=function dispatch(){document.dispatchEvent(new CustomEvent('FilePond:loaded',{detail:{supported:supported,create:exports.create,destroy:exports.destroy,parse:exports.parse,find:exports.find,registerPlugin:exports.registerPlugin,setOptions:exports.setOptions}}));document.removeEventListener('DOMContentLoaded',dispatch)};if(document.readyState!=='loading'){setTimeout(function(){return dispatch()},0)}else{document.addEventListener('DOMContentLoaded',dispatch)}
var updateOptionTypes=function updateOptionTypes(){return forin(getOptions(),function(key,value){exports.OptionTypes[key]=value[1]})};exports.Status=Object.assign({},Status);exports.FileOrigin=Object.assign({},FileOrigin);exports.FileStatus=Object.assign({},ItemStatus);exports.OptionTypes={};updateOptionTypes();exports.create=function create(){var app=createApp$1.apply(void 0,arguments);app.on('destroy',exports.destroy);state.apps.push(app);return createAppAPI(app)};exports.destroy=function destroy(hook){var indexToRemove=state.apps.findIndex(function(app){return app.isAttachedTo(hook)});if(indexToRemove>=0){var app=state.apps.splice(indexToRemove,1)[0];app.restoreElement();return!0}
return!1};exports.parse=function parse(context){var matchedHooks=Array.from(context.querySelectorAll('.'+name));var newHooks=matchedHooks.filter(function(newHook){return!state.apps.find(function(app){return app.isAttachedTo(newHook)})});return newHooks.map(function(hook){return exports.create(hook)})};exports.find=function find(hook){var app=state.apps.find(function(app){return app.isAttachedTo(hook)});if(!app){return null}
return createAppAPI(app)};exports.registerPlugin=function registerPlugin(){for(var _len=arguments.length,plugins=new Array(_len),_key=0;_key<_len;_key++){plugins[_key]=arguments[_key]}
plugins.forEach(createAppPlugin);updateOptionTypes()};exports.getOptions=function getOptions$1(){var opts={};forin(getOptions(),function(key,value){opts[key]=value[0]});return opts};exports.setOptions=function setOptions$1(opts){if(isObject(opts)){state.apps.forEach(function(app){app.setOptions(opts)});setOptions(opts)}
return exports.getOptions()}}
exports.supported=supported;Object.defineProperty(exports,'__esModule',{value:!0})});(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?(module.exports=factory()):typeof define==='function'&&define.amd?define(factory):((global=global||self),(global.FilePondPluginImagePreview=factory()))})(this,function(){'use strict';var isPreviewableImage=function isPreviewableImage(file){return/^image/.test(file.type)};var IMAGE_SCALE_SPRING_PROPS={type:'spring',stiffness:0.5,damping:0.45,mass:10};var createVector=function createVector(x,y){return{x:x,y:y}};var vectorDot=function vectorDot(a,b){return a.x*b.x+a.y*b.y};var vectorSubtract=function vectorSubtract(a,b){return createVector(a.x-b.x,a.y-b.y)};var vectorDistanceSquared=function vectorDistanceSquared(a,b){return vectorDot(vectorSubtract(a,b),vectorSubtract(a,b))};var vectorDistance=function vectorDistance(a,b){return Math.sqrt(vectorDistanceSquared(a,b))};var getOffsetPointOnEdge=function getOffsetPointOnEdge(length,rotation){var a=length;var A=1.5707963267948966;var B=rotation;var C=1.5707963267948966-rotation;var sinA=Math.sin(A);var sinB=Math.sin(B);var sinC=Math.sin(C);var cosC=Math.cos(C);var ratio=a/sinA;var b=ratio*sinB;var c=ratio*sinC;return createVector(cosC*b,cosC*c)};var getRotatedRectSize=function getRotatedRectSize(rect,rotation){var w=rect.width;var h=rect.height;var hor=getOffsetPointOnEdge(w,rotation);var ver=getOffsetPointOnEdge(h,rotation);var tl=createVector(rect.x+Math.abs(hor.x),rect.y-Math.abs(hor.y));var tr=createVector(rect.x+rect.width+Math.abs(ver.y),rect.y+Math.abs(ver.x));var bl=createVector(rect.x-Math.abs(ver.y),rect.y+rect.height-Math.abs(ver.x));return{width:vectorDistance(tl,tr),height:vectorDistance(tl,bl)}};var getImageRectZoomFactor=function getImageRectZoomFactor(imageRect,cropRect,rotation,center){var cx=center.x>0.5?1-center.x:center.x;var cy=center.y>0.5?1-center.y:center.y;var imageWidth=cx*2*imageRect.width;var imageHeight=cy*2*imageRect.height;var rotatedCropSize=getRotatedRectSize(cropRect,rotation);return Math.max(rotatedCropSize.width/imageWidth,rotatedCropSize.height/imageHeight)};var getCenteredCropRect=function getCenteredCropRect(container,aspectRatio){var width=container.width;var height=width*aspectRatio;if(height>container.height){height=container.height;width=height/aspectRatio}
var x=(container.width-width)*0.5;var y=(container.height-height)*0.5;return{x:x,y:y,width:width,height:height}};var createBitmapView=function createBitmapView(_){return _.utils.createView({name:'image-bitmap',ignoreRect:!0,mixins:{styles:['scaleX','scaleY']},create:function create(_ref){var root=_ref.root,props=_ref.props;root.appendChild(props.image)}})};var createImageCanvasWrapper=function createImageCanvasWrapper(_){return _.utils.createView({name:'image-canvas-wrapper',tag:'div',ignoreRect:!0,mixins:{apis:['crop','width','height'],styles:['originX','originY','translateX','translateY','scaleX','scaleY','rotateZ'],animations:{originX:IMAGE_SCALE_SPRING_PROPS,originY:IMAGE_SCALE_SPRING_PROPS,scaleX:IMAGE_SCALE_SPRING_PROPS,scaleY:IMAGE_SCALE_SPRING_PROPS,translateX:IMAGE_SCALE_SPRING_PROPS,translateY:IMAGE_SCALE_SPRING_PROPS,rotateZ:IMAGE_SCALE_SPRING_PROPS}},create:function create(_ref2){var root=_ref2.root,props=_ref2.props;props.width=props.image.width;props.height=props.image.height;root.ref.bitmap=root.appendChildView(root.createChildView(createBitmapView(_),{image:props.image}))},write:function write(_ref3){var root=_ref3.root,props=_ref3.props;var flip=props.crop.flip;var bitmap=root.ref.bitmap;bitmap.scaleX=flip.horizontal?-1:1;bitmap.scaleY=flip.vertical?-1:1}})};var createClipView=function createClipView(_){return _.utils.createView({name:'image-clip',tag:'div',ignoreRect:!0,mixins:{apis:['crop','width','height'],styles:['width','height','opacity'],animations:{opacity:{type:'tween',duration:250}}},create:function create(_ref4){var root=_ref4.root,props=_ref4.props;root.ref.image=root.appendChildView(root.createChildView(createImageCanvasWrapper(_),Object.assign({},props)));var transparencyIndicator=root.query('GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR');if(transparencyIndicator===null){return}
if(transparencyIndicator==='grid'){root.element.dataset.transparencyIndicator=transparencyIndicator}
else{root.element.dataset.transparencyIndicator='color'}},write:function write(_ref5){var root=_ref5.root,props=_ref5.props,shouldOptimize=_ref5.shouldOptimize;var crop=props.crop,width=props.width,height=props.height;root.ref.image.crop=crop;var stage={x:0,y:0,width:width,height:height,center:{x:width*0.5,y:height*0.5}};var image={width:root.ref.image.width,height:root.ref.image.height};var origin={x:crop.center.x*image.width,y:crop.center.y*image.height};var translation={x:stage.center.x-image.width*crop.center.x,y:stage.center.y-image.height*crop.center.y};var rotation=Math.PI*2+(crop.rotation%(Math.PI*2));var cropAspectRatio=crop.aspectRatio||image.height/image.width;var stageZoomFactor=getImageRectZoomFactor(image,getCenteredCropRect(stage,cropAspectRatio),rotation,crop.center);var scale=crop.zoom*stageZoomFactor;var imageView=root.ref.image;if(shouldOptimize){imageView.originX=null;imageView.originY=null;imageView.translateX=null;imageView.translateY=null;imageView.rotateZ=null;imageView.scaleX=null;imageView.scaleY=null;return}
imageView.originX=origin.x;imageView.originY=origin.y;imageView.translateX=translation.x;imageView.translateY=translation.y;imageView.rotateZ=rotation;imageView.scaleX=scale;imageView.scaleY=scale}})};var createImageView=function createImageView(_){return _.utils.createView({name:'image-preview',tag:'div',ignoreRect:!0,mixins:{apis:['crop','image'],styles:['translateY','scaleX','scaleY','opacity'],animations:{scaleX:IMAGE_SCALE_SPRING_PROPS,scaleY:IMAGE_SCALE_SPRING_PROPS,translateY:IMAGE_SCALE_SPRING_PROPS,opacity:{type:'tween',duration:400}}},create:function create(_ref6){var root=_ref6.root,props=_ref6.props;root.ref.clip=root.appendChildView(root.createChildView(createClipView(_),{image:props.image,crop:props.crop}))},write:function write(_ref7){var root=_ref7.root,props=_ref7.props,shouldOptimize=_ref7.shouldOptimize;var clip=root.ref.clip;var crop=props.crop,image=props.image;clip.crop=crop;clip.opacity=shouldOptimize?0:1;if(shouldOptimize||root.rect.element.hidden)return;var imageAspectRatio=image.height/image.width;var aspectRatio=crop.aspectRatio||imageAspectRatio;var containerWidth=root.rect.inner.width;var containerHeight=root.rect.inner.height;var fixedPreviewHeight=root.query('GET_IMAGE_PREVIEW_HEIGHT');var minPreviewHeight=root.query('GET_IMAGE_PREVIEW_MIN_HEIGHT');var maxPreviewHeight=root.query('GET_IMAGE_PREVIEW_MAX_HEIGHT');var panelAspectRatio=root.query('GET_PANEL_ASPECT_RATIO');var allowMultiple=root.query('GET_ALLOW_MULTIPLE');if(panelAspectRatio&&!allowMultiple){fixedPreviewHeight=containerWidth*panelAspectRatio;aspectRatio=panelAspectRatio}
var clipHeight=fixedPreviewHeight!==null?fixedPreviewHeight:Math.max(minPreviewHeight,Math.min(containerWidth*aspectRatio,maxPreviewHeight));var clipWidth=clipHeight/aspectRatio;if(clipWidth>containerWidth){clipWidth=containerWidth;clipHeight=clipWidth*aspectRatio}
if(clipHeight>containerHeight){clipHeight=containerHeight;clipWidth=containerHeight/aspectRatio}
clip.width=clipWidth;clip.height=clipHeight}})};var SVG_MASK='<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n    <defs>\n        <radialGradient id="gradient-__UID__" cx=".5" cy="1.25" r="1.15">\n            <stop offset=\'50%\' stop-color=\'#000000\'/>\n            <stop offset=\'56%\' stop-color=\'#0a0a0a\'/>\n            <stop offset=\'63%\' stop-color=\'#262626\'/>\n            <stop offset=\'69%\' stop-color=\'#4f4f4f\'/>\n            <stop offset=\'75%\' stop-color=\'#808080\'/>\n            <stop offset=\'81%\' stop-color=\'#b1b1b1\'/>\n            <stop offset=\'88%\' stop-color=\'#dadada\'/>\n            <stop offset=\'94%\' stop-color=\'#f6f6f6\'/>\n            <stop offset=\'100%\' stop-color=\'#ffffff\'/>\n        </radialGradient>\n        <mask id="mask-__UID__">\n            <rect x="0" y="0" width="500" height="200" fill="url(#gradient-__UID__)"></rect>\n        </mask>\n    </defs>\n    <rect x="0" width="500" height="200" fill="currentColor" mask="url(#mask-__UID__)"></rect>\n</svg>';var checkedMyBases=!1;var SVGMaskUniqueId=0;var createImageOverlayView=function createImageOverlayView(fpAPI){return fpAPI.utils.createView({name:'image-preview-overlay',tag:'div',ignoreRect:!0,create:function create(_ref){var root=_ref.root,props=_ref.props;if(!checkedMyBases&&document.querySelector('base')){SVG_MASK=SVG_MASK.replace(/url\(\#/g,'url('+window.location.href.replace(window.location.hash,'')+'#');checkedMyBases=!0}
SVGMaskUniqueId++;root.element.classList.add('filepond--image-preview-overlay-'.concat(props.status));root.element.innerHTML=SVG_MASK.replace(/__UID__/g,SVGMaskUniqueId)},mixins:{styles:['opacity'],animations:{opacity:{type:'spring',mass:25}}}})};var BitmapWorker=function BitmapWorker(){self.onmessage=function(e){createImageBitmap(e.data.message.file).then(function(bitmap){self.postMessage({id:e.data.id,message:bitmap},[bitmap])})}};var ColorMatrixWorker=function ColorMatrixWorker(){self.onmessage=function(e){var imageData=e.data.message.imageData;var matrix=e.data.message.colorMatrix;var data=imageData.data;var l=data.length;var m11=matrix[0];var m12=matrix[1];var m13=matrix[2];var m14=matrix[3];var m15=matrix[4];var m21=matrix[5];var m22=matrix[6];var m23=matrix[7];var m24=matrix[8];var m25=matrix[9];var m31=matrix[10];var m32=matrix[11];var m33=matrix[12];var m34=matrix[13];var m35=matrix[14];var m41=matrix[15];var m42=matrix[16];var m43=matrix[17];var m44=matrix[18];var m45=matrix[19];var index=0,r=0.0,g=0.0,b=0.0,a=0.0;for(;index<l;index+=4){r=data[index]/255;g=data[index+1]/255;b=data[index+2]/255;a=data[index+3]/255;data[index]=Math.max(0,Math.min((r*m11+g*m12+b*m13+a*m14+m15)*255,255));data[index+1]=Math.max(0,Math.min((r*m21+g*m22+b*m23+a*m24+m25)*255,255));data[index+2]=Math.max(0,Math.min((r*m31+g*m32+b*m33+a*m34+m35)*255,255));data[index+3]=Math.max(0,Math.min((r*m41+g*m42+b*m43+a*m44+m45)*255,255))}
self.postMessage({id:e.data.id,message:imageData},[imageData.data.buffer])}};var getImageSize=function getImageSize(url,cb){var image=new Image();image.onload=function(){var width=image.naturalWidth;var height=image.naturalHeight;image=null;cb(width,height)};image.src=url};var transforms={1:function _(){return[1,0,0,1,0,0]},2:function _(width){return[-1,0,0,1,width,0]},3:function _(width,height){return[-1,0,0,-1,width,height]},4:function _(width,height){return[1,0,0,-1,0,height]},5:function _(){return[0,1,1,0,0,0]},6:function _(width,height){return[0,1,-1,0,height,0]},7:function _(width,height){return[0,-1,-1,0,height,width]},8:function _(width){return[0,-1,1,0,0,width]}};var fixImageOrientation=function fixImageOrientation(ctx,width,height,orientation){if(orientation===-1){return}
ctx.transform.apply(ctx,transforms[orientation](width,height))};var createPreviewImage=function createPreviewImage(data,width,height,orientation){width=Math.round(width);height=Math.round(height);var canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;var ctx=canvas.getContext('2d');if(orientation>=5&&orientation<=8){var _ref=[height,width];width=_ref[0];height=_ref[1]}
fixImageOrientation(ctx,width,height,orientation);ctx.drawImage(data,0,0,width,height);return canvas};var isBitmap=function isBitmap(file){return/^image/.test(file.type)&&!/svg/.test(file.type)};var MAX_WIDTH=10;var MAX_HEIGHT=10;var calculateAverageColor=function calculateAverageColor(image){var scalar=Math.min(MAX_WIDTH/image.width,MAX_HEIGHT/image.height);var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');var width=(canvas.width=Math.ceil(image.width*scalar));var height=(canvas.height=Math.ceil(image.height*scalar));ctx.drawImage(image,0,0,width,height);var data=null;try{data=ctx.getImageData(0,0,width,height).data}catch(e){return null}
var l=data.length;var r=0;var g=0;var b=0;var i=0;for(;i<l;i+=4){r+=data[i]*data[i];g+=data[i+1]*data[i+1];b+=data[i+2]*data[i+2]}
r=averageColor(r,l);g=averageColor(g,l);b=averageColor(b,l);return{r:r,g:g,b:b}};var averageColor=function averageColor(c,l){return Math.floor(Math.sqrt(c/(l/4)))};var cloneCanvas=function cloneCanvas(origin,target){target=target||document.createElement('canvas');target.width=origin.width;target.height=origin.height;var ctx=target.getContext('2d');ctx.drawImage(origin,0,0);return target};var cloneImageData=function cloneImageData(imageData){var id;try{id=new ImageData(imageData.width,imageData.height)}catch(e){var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');id=ctx.createImageData(imageData.width,imageData.height)}
id.data.set(new Uint8ClampedArray(imageData.data));return id};var loadImage=function loadImage(url){return new Promise(function(resolve,reject){var img=new Image();img.crossOrigin='Anonymous';img.onload=function(){resolve(img)};img.onerror=function(e){reject(e)};img.src=url})};var createImageWrapperView=function createImageWrapperView(_){var OverlayView=createImageOverlayView(_);var ImageView=createImageView(_);var createWorker=_.utils.createWorker;var applyFilter=function applyFilter(root,filter,target){return new Promise(function(resolve){if(!root.ref.imageData){root.ref.imageData=target.getContext('2d').getImageData(0,0,target.width,target.height)}
var imageData=cloneImageData(root.ref.imageData);if(!filter||filter.length!==20){target.getContext('2d').putImageData(imageData,0,0);return resolve()}
var worker=createWorker(ColorMatrixWorker);worker.post({imageData:imageData,colorMatrix:filter},function(response){target.getContext('2d').putImageData(response,0,0);worker.terminate();resolve()},[imageData.data.buffer])})};var removeImageView=function removeImageView(root,imageView){root.removeChildView(imageView);imageView.image.width=1;imageView.image.height=1;imageView._destroy()};var shiftImage=function shiftImage(_ref){var root=_ref.root;var imageView=root.ref.images.shift();imageView.opacity=0;imageView.translateY=-15;root.ref.imageViewBin.push(imageView);return imageView};var pushImage=function pushImage(_ref2){var root=_ref2.root,props=_ref2.props,image=_ref2.image;var id=props.id;var item=root.query('GET_ITEM',{id:id});if(!item)return;var crop=item.getMetadata('crop')||{center:{x:0.5,y:0.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null};var imageView=root.appendChildView(root.createChildView(ImageView,{image:image,crop:crop,opacity:0,scaleX:1.15,scaleY:1.15,translateY:15}),root.childViews.length);root.ref.images.push(imageView);imageView.opacity=1;imageView.scaleX=1;imageView.scaleY=1;imageView.translateY=0;setTimeout(function(){root.dispatch('DID_IMAGE_PREVIEW_SHOW',{id:id})},250)};var updateImage=function updateImage(_ref3){var root=_ref3.root,props=_ref3.props;var item=root.query('GET_ITEM',{id:props.id});if(!item)return;var imageView=root.ref.images[root.ref.images.length-1];imageView.crop=item.getMetadata('crop')};var didUpdateItemMetadata=function didUpdateItemMetadata(_ref4){var root=_ref4.root,props=_ref4.props,action=_ref4.action;if(!/crop|filter/.test(action.change.key))return;if(!root.ref.images.length)return;var item=root.query('GET_ITEM',{id:props.id});if(!item)return;if(/filter/.test(action.change.key)){var imageView=root.ref.images[root.ref.images.length-1];applyFilter(root,action.change.value,imageView.image);return}
if(/crop/.test(action.change.key)){var crop=item.getMetadata('crop');var image=root.ref.images[root.ref.images.length-1];if(Math.abs(crop.aspectRatio-image.crop.aspectRatio)>0.00001){var _imageView=shiftImage({root:root});pushImage({root:root,props:props,image:cloneCanvas(_imageView.image)})}
else{updateImage({root:root,props:props})}}};var canCreateImageBitmap=function canCreateImageBitmap(file){return'createImageBitmap' in window&&isBitmap(file)};var didCreatePreviewContainer=function didCreatePreviewContainer(_ref5){var root=_ref5.root,props=_ref5.props;var id=props.id;var item=root.query('GET_ITEM',id);if(!item)return;var fileURL=URL.createObjectURL(item.file);getImageSize(fileURL,function(width,height){root.dispatch('DID_IMAGE_PREVIEW_CALCULATE_SIZE',{id:id,width:width,height:height})})};var drawPreview=function drawPreview(_ref6){var root=_ref6.root,props=_ref6.props;var id=props.id;var item=root.query('GET_ITEM',id);if(!item)return;var fileURL=URL.createObjectURL(item.file);var loadPreviewFallback=function loadPreviewFallback(){loadImage(fileURL).then(previewImageLoaded)};var previewImageLoaded=function previewImageLoaded(imageData){URL.revokeObjectURL(fileURL);var exif=item.getMetadata('exif')||{};var orientation=exif.orientation||-1;var width=imageData.width,height=imageData.height;if(orientation>=5&&orientation<=8){var _ref7=[height,width];width=_ref7[0];height=_ref7[1]}
var pixelDensityFactor=Math.max(1,window.devicePixelRatio*0.75);var zoomFactor=root.query('GET_IMAGE_PREVIEW_ZOOM_FACTOR');var scaleFactor=zoomFactor*pixelDensityFactor;var previewImageRatio=height/width;var previewContainerWidth=root.rect.element.width;var previewContainerHeight=root.rect.element.height;var imageWidth=previewContainerWidth;var imageHeight=imageWidth*previewImageRatio;if(previewImageRatio>1){imageWidth=Math.min(width,previewContainerWidth*scaleFactor);imageHeight=imageWidth*previewImageRatio}else{imageHeight=Math.min(height,previewContainerHeight*scaleFactor);imageWidth=imageHeight/previewImageRatio}
var previewImage=createPreviewImage(imageData,imageWidth,imageHeight,orientation);var done=function done(){var averageColor=root.query('GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR')?calculateAverageColor(data):null;item.setMetadata('color',averageColor,!0);if('close' in imageData){imageData.close()}
root.ref.overlayShadow.opacity=1;pushImage({root:root,props:props,image:previewImage})};var filter=item.getMetadata('filter');if(filter){applyFilter(root,filter,previewImage).then(done)}else{done()}};if(canCreateImageBitmap(item.file)){var worker=createWorker(BitmapWorker);worker.post({file:item.file},function(imageBitmap){worker.terminate();if(!imageBitmap){loadPreviewFallback();return}
previewImageLoaded(imageBitmap)})}else{loadPreviewFallback()}};var didDrawPreview=function didDrawPreview(_ref8){var root=_ref8.root;var image=root.ref.images[root.ref.images.length-1];image.translateY=0;image.scaleX=1.0;image.scaleY=1.0;image.opacity=1};var restoreOverlay=function restoreOverlay(_ref9){var root=_ref9.root;root.ref.overlayShadow.opacity=1;root.ref.overlayError.opacity=0;root.ref.overlaySuccess.opacity=0};var didThrowError=function didThrowError(_ref10){var root=_ref10.root;root.ref.overlayShadow.opacity=0.25;root.ref.overlayError.opacity=1};var didCompleteProcessing=function didCompleteProcessing(_ref11){var root=_ref11.root;root.ref.overlayShadow.opacity=0.25;root.ref.overlaySuccess.opacity=1};var create=function create(_ref12){var root=_ref12.root;root.ref.images=[];root.ref.imageData=null;root.ref.imageViewBin=[];root.ref.overlayShadow=root.appendChildView(root.createChildView(OverlayView,{opacity:0,status:'idle'}));root.ref.overlaySuccess=root.appendChildView(root.createChildView(OverlayView,{opacity:0,status:'success'}));root.ref.overlayError=root.appendChildView(root.createChildView(OverlayView,{opacity:0,status:'failure'}))};return _.utils.createView({name:'image-preview-wrapper',create:create,styles:['height'],apis:['height'],destroy:function destroy(_ref13){var root=_ref13.root;root.ref.images.forEach(function(imageView){imageView.image.width=1;imageView.image.height=1})},write:_.utils.createRoute({DID_IMAGE_PREVIEW_DRAW:didDrawPreview,DID_IMAGE_PREVIEW_CONTAINER_CREATE:didCreatePreviewContainer,DID_FINISH_CALCULATE_PREVIEWSIZE:drawPreview,DID_UPDATE_ITEM_METADATA:didUpdateItemMetadata,DID_THROW_ITEM_LOAD_ERROR:didThrowError,DID_THROW_ITEM_PROCESSING_ERROR:didThrowError,DID_THROW_ITEM_INVALID:didThrowError,DID_COMPLETE_ITEM_PROCESSING:didCompleteProcessing,DID_START_ITEM_PROCESSING:restoreOverlay,DID_REVERT_ITEM_PROCESSING:restoreOverlay},function(_ref14){var root=_ref14.root;var viewsToRemove=root.ref.imageViewBin.filter(function(imageView){return imageView.opacity===0});root.ref.imageViewBin=root.ref.imageViewBin.filter(function(imageView){return imageView.opacity>0});viewsToRemove.forEach(function(imageView){return removeImageView(root,imageView)});viewsToRemove.length=0})})};var plugin=function plugin(fpAPI){var addFilter=fpAPI.addFilter,utils=fpAPI.utils;var Type=utils.Type,createRoute=utils.createRoute,isFile=utils.isFile;var imagePreviewView=createImageWrapperView(fpAPI);addFilter('CREATE_VIEW',function(viewAPI){var is=viewAPI.is,view=viewAPI.view,query=viewAPI.query;if(!is('file')||!query('GET_ALLOW_IMAGE_PREVIEW')){return}
var didLoadItem=function didLoadItem(_ref){var root=_ref.root,props=_ref.props;var id=props.id;var item=query('GET_ITEM',id);if(!item||!isFile(item.file)||item.archived)return;var file=item.file;if(!isPreviewableImage(file))return;var supportsCreateImageBitmap='createImageBitmap' in(window||{});var maxPreviewFileSize=query('GET_IMAGE_PREVIEW_MAX_FILE_SIZE');if(!supportsCreateImageBitmap&&maxPreviewFileSize&&file.size>maxPreviewFileSize)
return;root.ref.imagePreview=view.appendChildView(view.createChildView(imagePreviewView,{id:id}));var fixedPreviewHeight=root.query('GET_IMAGE_PREVIEW_HEIGHT');if(fixedPreviewHeight){root.dispatch('DID_UPDATE_PANEL_HEIGHT',{id:item.id,height:fixedPreviewHeight})}
var queue=!supportsCreateImageBitmap&&file.size>query('GET_IMAGE_PREVIEW_MAX_INSTANT_PREVIEW_FILE_SIZE');root.dispatch('DID_IMAGE_PREVIEW_CONTAINER_CREATE',{id:id},queue)};var rescaleItem=function rescaleItem(root,props){if(!root.ref.imagePreview)return;var id=props.id;var item=root.query('GET_ITEM',{id:id});if(!item)return;var panelAspectRatio=root.query('GET_PANEL_ASPECT_RATIO');var itemPanelAspectRatio=root.query('GET_ITEM_PANEL_ASPECT_RATIO');var fixedHeight=root.query('GET_IMAGE_PREVIEW_HEIGHT');if(panelAspectRatio||itemPanelAspectRatio||fixedHeight)return;var _root$ref=root.ref,imageWidth=_root$ref.imageWidth,imageHeight=_root$ref.imageHeight;if(!imageWidth||!imageHeight)return;var minPreviewHeight=root.query('GET_IMAGE_PREVIEW_MIN_HEIGHT');var maxPreviewHeight=root.query('GET_IMAGE_PREVIEW_MAX_HEIGHT');var exif=item.getMetadata('exif')||{};var orientation=exif.orientation||-1;if(orientation>=5&&orientation<=8){var _ref2=[imageHeight,imageWidth];imageWidth=_ref2[0];imageHeight=_ref2[1]}
if(!isBitmap(item.file)||root.query('GET_IMAGE_PREVIEW_UPSCALE')){var scalar=2048/imageWidth;imageWidth*=scalar;imageHeight*=scalar}
var imageAspectRatio=imageHeight/imageWidth;var previewAspectRatio=(item.getMetadata('crop')||{}).aspectRatio||imageAspectRatio;var previewHeightMax=Math.max(minPreviewHeight,Math.min(imageHeight,maxPreviewHeight));var itemWidth=root.rect.element.width;var previewHeight=Math.min(itemWidth*previewAspectRatio,previewHeightMax);root.dispatch('DID_UPDATE_PANEL_HEIGHT',{id:item.id,height:previewHeight})};var didResizeView=function didResizeView(_ref3){var root=_ref3.root;root.ref.shouldRescale=!0};var didUpdateItemMetadata=function didUpdateItemMetadata(_ref4){var root=_ref4.root,action=_ref4.action;if(action.change.key!=='crop')return;root.ref.shouldRescale=!0};var didCalculatePreviewSize=function didCalculatePreviewSize(_ref5){var root=_ref5.root,action=_ref5.action;root.ref.imageWidth=action.width;root.ref.imageHeight=action.height;root.ref.shouldRescale=!0;root.ref.shouldDrawPreview=!0;root.dispatch('KICK')};view.registerWriter(createRoute({DID_RESIZE_ROOT:didResizeView,DID_STOP_RESIZE:didResizeView,DID_LOAD_ITEM:didLoadItem,DID_IMAGE_PREVIEW_CALCULATE_SIZE:didCalculatePreviewSize,DID_UPDATE_ITEM_METADATA:didUpdateItemMetadata},function(_ref6){var root=_ref6.root,props=_ref6.props;if(root.rect.element.hidden)return;if(root.ref.shouldRescale){rescaleItem(root,props);root.ref.shouldRescale=!1}
if(root.ref.shouldDrawPreview){requestAnimationFrame(function(){root.dispatch('DID_FINISH_CALCULATE_PREVIEWSIZE',{id:props.id})});root.ref.shouldDrawPreview=!1}}))});return{options:{allowImagePreview:[!0,Type.BOOLEAN],imagePreviewHeight:[null,Type.INT],imagePreviewMinHeight:[44,Type.INT],imagePreviewMaxHeight:[256,Type.INT],imagePreviewMaxFileSize:[null,Type.INT],imagePreviewZoomFactor:[2,Type.INT],imagePreviewUpscale:[!1,Type.BOOLEAN],imagePreviewMaxInstantPreviewFileSize:[1000000,Type.INT],imagePreviewTransparencyIndicator:[null,Type.STRING],imagePreviewCalculateAverageImageColor:[!1,Type.BOOLEAN]}}};var isBrowser=typeof window!=='undefined'&&typeof window.document!=='undefined';if(isBrowser){document.dispatchEvent(new CustomEvent('FilePond:pluginloaded',{detail:plugin}))}
return plugin})